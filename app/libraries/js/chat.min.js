var curr_request;var socket=io.connect("http://localhost:3000/");var stop_scroll=0;var color_arr=new Array("#228d49","#f52103","#2532f2","#f94f06","#5a24d9","#f8b92d","#38cedb","#000");var serial_tracker=$("#serial_tracker").text();var user_tracker=$("#user_tracker").text();$("#login_form").submit(function(){var d=1;var e=$("#username").val();var c=$("#pass").val();var a=$("#pass2").val();$(".form-group").attr("class","form-group");if(e.length<3||e.length>20){$("#user_group").attr("class","form-group has-error");$("#username").attr("data-original-title","Username must be longer than 2 characters but less than 15");$("#username").tooltip("show");d=0}else{if(a!=""){var b=$.ajax({type:"GET",data:{username:e},url:"//mutualcog.com/profile/checkuser",async:false,}).responseText;console.log(e);console.log(b);if(b==1){var b=$.ajax({type:"GET",data:{username:e},url:"//mutualcog.com/profile/checkalpha",async:false,}).responseText;if(b==1){}else{$("#user_group").attr("class","form-group has-error");$("#username").attr("data-original-title","Your username must contain at least one character");$("#username").tooltip("show");d=0}}else{$("#user_group").attr("class","form-group has-error");$("#username").attr("data-original-title","That username already exists");$("#username").tooltip("show");d=0}}else{var b=$.ajax({type:"GET",data:{username:e,pass:c},url:"//mutualcog.com/profile/checkcredentials",async:false,}).responseText;if(b==1){}else{$("#user_group").attr("class","form-group has-error");$("#pass1_group").attr("class","form-group has-error");$("#username").attr("data-original-title","Your username or password is incorrect");$("#username").tooltip("show");d=0}}}if(c.length<6||c.length>30){$("#pass1_group").attr("class","form-group has-error");$("#pass2_group").attr("class","form-group has-error");$("#pass").tooltip("show");d=0}if(c!=a&&a!=""){$("#pass1_group").attr("class","form-group has-error");$("#pass2_group").attr("class","form-group has-error");$("#pass2").tooltip("show");d=0}if(d){return true}else{return false}});$("#tag_dropdown").on("click",function(a){a.stopPropagation()});$("#search_input").on("focus",function(a){a.stopPropagation();if($("#search_input").val()==""){$("#tag_dropdown").html("")}$(this).dropdown();$("#tag_dropdown").show()});$(window).on("click",function(a){$("#tag_dropdown").hide()});var selected_term=-1;$("#search_input").on("keydown",function(a){if(a.keyCode==13){if(selected_term==-1){}else{location.assign($("li#search_"+selected_term).children("a").attr("href"))}return false}else{if(a.keyCode==38){if(selected_term!=0){selected_term--;$(".tag_results").css("background-color","");$("li#search_"+selected_term).css("background-color","#f5f5f5")}return false}else{if(a.keyCode==40){if(selected_term!=$("#tag_dropdown").length){selected_term++;$(".tag_results").css("background-color","");$("li#search_"+selected_term).css("background-color","#f5f5f5")}return false}}}});$("#search_input").on("keyup",function(b){var a=$(this).val();if(b.keyCode==13){return false}else{if(b.keyCode==38||b.keyCode==40){}else{if(a.length>2){$.ajax({type:"GET",data:{tag:a},url:"//mutualcog.com/tags/similar-tag",success:function(d){var c="";$.each(d,function(e,f){c+='<li id="search_'+e+'" class="tag_results"><a href="//mutualcog.com/tags/tag/'+f.name+'">'+f.name+"</a></li>"});if(c){$("#tag_dropdown").show();if($("#tag_dropdown").html()!=c){$("#tag_dropdown").html(c);selected_term=-1}}else{$("#tag_dropdown").hide();selected_term=-1}},error:function(){}})}else{$("#tag_dropdown").html("")}}}});updateChatTimes=function(){$.each($(".chat_time"),function(a,b){$(this).text(moment.utc($(this).attr("id")).fromNow())})};updateTimes=function(){$.each($(".time"),function(a,b){$(this).text(moment.utc($(this).attr("id")).fromNow())})};removeSmallElements=function(){if($(this).width()<1200){$("#members_box").css("display","none");$(this).off("resize");$(this).on("resize",addSmallElements)}};addSmallElements=function(){if($(this).width()>=1200){$("#members_box").css("display","");$(this).off("resize");$(this).on("resize",removeSmallElements)}};$(document).ready(function(){updateChatTimes();setInterval(updateTimes,60000);setInterval(updateChatTimes,60000);if($(window).width()<1200){$("#members_box").css("display","none");$(window).on("resize",addSmallElements)}else{$(window).on("resize",removeSmallElements)}$("#chat_messages").click(function(){$("#message").attr("class","global");$(".chat_mssg").css("background-color","");$("#response_display").html("");socket.emit("leave_last_room");if($("#message").text()!=""){$("#message").text("Press enter to send a message to all")}else{$("#message").val("Press enter to send a message to all");$("#message").on("click",function(){$(this).val("");$(this).off("click")})}});$(".go_back").click(function(a){a.stopPropagation();socket.emit("go_back",$(".chat_mssg").eq(0).attr("id"))})});deleteMessage=function(a){socket.emit("delete_message",a)};deleteIt=function(a){a.stopPropagation();if($("#logged_in").text()==1){deleteMessage({id:$(this).attr("id"),user:$("#user_tracker").text(),responses:$(this).parent().children(".mssg_op").children(".response_count").text()})}else{deleteMessage({id:$(this).attr("id"),user:$("#serial_tracker").text(),responses:$(this).parent().children(".mssg_op").children(".response_count").text()})}};getResponse=function(a){a.stopPropagation();socket.emit("show_responses",$(this).attr("id"));$(".chat_mssg").css("background-color","");$(this).css("background-color","#eee");$("#message").attr("class",$(this).attr("id"));if($("#message").text()!=""){$("#message").text("Press enter to respond to "+$(this).children().eq(0).children(".mssg_op").attr("id")+"'s message")}else{$("#message").val("Press enter to respond to "+$(this).children().eq(0).children(".mssg_op").attr("id")+"'s message");$("#message").on("click",function(){$(this).val("");$(this).off("click")})}};getNestedResponse=function(a){a.stopPropagation();socket.emit("show_nested_responses",{id:$(this).attr("id"),parent:$("#message").attr("class")});$("#chat_messages").hover(function(){$(".go_back").show(400)},function(){$(".go_back").hide(400)});$(".chat_resp").css("background-color","");$(this).css("background-color","#eee");$("#message").attr("class",$(this).attr("id"));if($("#message").text()!=""){$("#message").text("Press enter to respond to "+$(this).children().eq(0).children(".mssg_op").attr("id")+"'s message")}else{$("#message").val("Press enter to respond to "+$(this).children().eq(0).children(".mssg_op").attr("id")+"'s message");$("#message").on("click",function(){$(this).val("");$(this).off("click")})}};scroll_mod=function(){stop_scroll=1;window.setTimeout(function(){stop_scroll=0},10000)};blinkRed=function(a){if(a.css("background-color")=="rgb(255, 255, 255)"){a.animate({backgroundColor:"#F5A9A9"},"slow")}else{a.animate({backgroundColor:"#fff"},"slow")}if(a.data("continue")=="1"){a.off("click");a.on("click",function(b){b.stopPropagation();$(this).data("continue","0");$(this).off("click");$(this).on("click",getResponse);a.trigger("click")})}setTimeout(function(){if(a.data("continue")=="1"){blinkRed(a)}else{a.off("click");a.on("click",getResponse);a.css("background-color","#eee")}},1000)};blinkRedv2=function(a){if(a.css("background-color")=="rgb(255, 255, 255)"){a.animate({backgroundColor:"#F5A9A9"},"slow")}else{a.animate({backgroundColor:"#fff"},"slow")}if(a.data("continue")=="1"){a.off("click");a.on("click",function(b){b.stopPropagation();$(this).data("continue","0");$(this).off("click");$(this).on("click",getNestedResponse);a.trigger("click")})}setTimeout(function(){if(a.data("continue")=="1"){blinkRedv2(a)}else{a.off("click");a.on("click",getNestedResponse);a.css("background-color","#eee")}},1000)};socket.on("connect",function(){socket.emit("room",$(".chat_id").attr("id"));if($("#logged_in").text()==1){socket.emit("add_member",{new_member:user_tracker,serial:serial_tracker,logged_in:1})}else{socket.emit("add_member",{new_member:serial_tracker,logged_in:0})}});socket.on("alertUserToResponse",function(a){if(!$("#"+a.resp_id+".chat_resp").length){if($("#"+a.mssg_id+".chat_mssg").length){$("#"+a.mssg_id+".chat_mssg").data("continue","1");blinkRed($("#"+a.mssg_id+".chat_mssg"))}else{if($("#"+a.mssg_id+".chat_resp").length){$("#"+a.mssg_id+".chat_resp").data("continue","1");blinkRedv2($("#"+a.mssg_id+".chat_resp"))}}}});socket.on("updateResponseCount",function(a){$("#"+a.id+".response_count").animate({color:"#57bf4b"},"slow");$("#"+a.id+".response_count").animate({color:"black"},"slow");$("#"+a.id+".response_count").text(a.count)});socket.on("displayMembers",function(a){var b=new Array();$.each(a,function(c,d){if(d.is_admin){$("#display_admin").html(d.user)}b.push("<div>"+d.user+"</div>")});$("#display_members").html(b.join(""))});socket.on("openChat",function(a){var b=a.rows;var c=new Array();if(b.length>0){if(b[0].responseto==-1){$(".go_back").css("display","none");$("#chat_messages").off("mouseenter mouseleave")}}$.each(b,function(d,f){if((serial_tracker==f.author||$("#chat_admin").text()==serial_tracker||user_tracker==f.author||$("#chat_admin").text()==user_tracker)&&f.message!="<i>This message has been deleted</i>"){var e="<div class='chat_mssg' id='"+f.id+"'><div><span id='"+f.id+"' class='glyphicon glyphicon-remove mssg_icon'></span><b class='mssg_op' id='"+f.author+"' style='color:"+color_arr[f.serial%7]+";'> "+f.author+"(<span class='response_count' id='"+f.id+"'>"+f.responses+"</span>)</b> : "+f.message+"</div><div class='time' id='"+f.inception+"'>"+moment.utc(f.inception).fromNow()+"</div></div>"}else{var e="<div class='chat_mssg' id='"+f.id+"'><div><b class='mssg_op' id='"+f.author+"' style='color:"+color_arr[f.serial%7]+";'> "+f.author+"(<span class='response_count' id='"+f.id+"'>"+f.responses+"</span>)</b> : "+f.message+"</div><div class='time' id='"+f.inception+"'>"+moment.utc(f.inception).fromNow()+"</div></div>"}c.push(e)});$("#chat_display").html(c.join(""));$(".mssg_icon").on("click",deleteIt);$(".mssg_icon").hover(function(){$(this).css("color","red")},function(){$(this).css("color","black")});if(a.clicked!="-1"){$("#"+a.clicked+".chat_mssg").css("background-color","#eee");$("#message").attr("class",a.clicked)}$(".chat_mssg").on("click",getResponse);$(".chat_link").click(function(d){d.stopPropagation()});if(!stop_scroll){$("#chat_messages").off("scroll",scroll_mod);$("#chat_messages").scrollTop($("#chat_display").height());window.setTimeout(function(){$("#chat_messages").on("scroll",scroll_mod)},100)}});socket.on("openResponses",function(b){var a=new Array();$.each(b,function(c,e){if((serial_tracker==e.author||$("#chat_admin").text()==serial_tracker||user_tracker==e.author||$("#chat_admin").text()==user_tracker)&&e.message!="<i>This message has been deleted</i>"){var d="<div class='chat_resp' id='"+e.id+"'><div><span id='"+e.id+"' class='glyphicon glyphicon-remove resp_icon'></span><b class='mssg_op' id='"+e.author+"' style='color:"+color_arr[e.serial%7]+";'> "+e.author+"(<span class='response_count' id='"+e.id+"'>"+e.responses+"</span>)</b> : "+e.message+"</div><div class='time' id='"+e.inception+"'>"+moment.utc(e.inception).fromNow()+"</div></div>"}else{var d="<div class='chat_resp' id='"+e.id+"'><div><b class='mssg_op' id='"+e.author+"' style='color:"+color_arr[e.serial%7]+";'> "+e.author+"(<span class='response_count' id='"+e.id+"'>"+e.responses+"</span>)</b> : "+e.message+"</div><div class='time' id='"+e.inception+"'>"+moment.utc(e.inception).fromNow()+"</div></div>"}a.push(d)});$("#response_display").html(a.join(""));$(".resp_icon").on("click",deleteIt);$(".resp_icon").hover(function(){$(this).css("color","red")},function(){$(this).css("color","black")});$(".chat_resp").on("click",getNestedResponse);$(".chat_link").click(function(c){c.stopPropagation()});if(!stop_scroll){$("#chat_responses").off("scroll",scroll_mod);$("#chat_responses").scrollTop($("#response_display").height());window.setTimeout(function(){$("#chat_responses").on("scroll",scroll_mod)},100)}});socket.on("softDelete",function(a){if($("#"+a.id+".chat_mssg").length){$("#"+a.id+".chat_mssg").html("<b class='mssg_op' id='"+a.user+"' style='color:"+color_arr[a.user%7]+";'>"+a.user+"(<span class='response_count' id='"+a.id+"'>"+a.responses+"</span>)</b> : <i>This message has been deleted</i>")}else{$("#"+a.id+".chat_resp").html("<b class='mssg_op' id='"+a.user+"' style='color:"+color_arr[a.user%7]+";'>"+a.user+"(<span class='response_count' id='"+a.id+"'>"+a.responses+"</span>)</b> : <i>This message has been deleted</i>")}});socket.on("disconnect",function(){console.log("The client has disconnected!")});function sendMessageToServer(a){socket.emit("message_sent",a)}function sendResponseToServer(a){socket.emit("response_sent",a)}$("#message").click(function(){$(this).text("")});$("#message").keypress(function(a){if(a.which==13){if($("#message").val()!=""){if($("#message").attr("class")=="global"){sendMessageToServer({message:$("#message").val()})}else{sendResponseToServer({message:$("#message").val(),responseto:$("#message").attr("class")})}$("#message").val("")}return false}return true});