function validateLogin(e,t){var n=$.ajax({type:"GET",data:{username:e,pass:t},url:"//mutualcog.com/profile/validate-login",async:!1}).responseText;return n==1?($("#user_group").attr("class","form-group"),$("#pass1_group").attr("class","form-group"),$("#username").tooltip("destroy"),1):($("#user_group").attr("class","form-group has-error"),$("#pass1_group").attr("class","form-group has-error"),$("#username").attr("data-original-title","Your username or password is incorrect"),$("#username").tooltip("show"),0)}function validateUser(e){if(e.length<3||e.length>module.max_user_length)return $("#reg_user_group").attr("class","form-group has-error"),$("#reg_username").attr("data-original-title","Username must be between 3 and "+module.max_user_length+" characters"),$("#reg_username").tooltip("show"),0;var t=$.ajax({type:"GET",data:{username:e},url:"//mutualcog.com/profile/validate-username",async:!1}).responseText;return t==2?($("#reg_user_group").attr("class","form-group has-error"),$("#reg_username").attr("data-original-title","That username already exists"),$("#reg_username").tooltip("show"),0):t==3?($("#reg_user_group").attr("class","form-group has-error"),$("#reg_username").attr("data-original-title","Your username must contain at least one character"),$("#reg_username").tooltip("show"),0):($("#reg_user_group").attr("class","form-group"),$("#reg_username").tooltip("destroy"),1)}function validatePasswords(e,t){return e!=t&&t!=""?($("#reg_pass1_group").attr("class","form-group has-error"),$("#pass2_group").attr("class","form-group has-error"),$("#pass2").tooltip("show"),0):(e.length<6||e.length>30)&&t!=""?($("#reg_pass1_group").attr("class","form-group has-error"),$("#pass2_group").attr("class","form-group has-error"),$("#pass").tooltip("show"),0):($("#reg_pass1_group").attr("class","form-group"),$("#pass2_group").attr("class","form-group"),$("#pass2").tooltip("destroy"),$("#reg_pass").tooltip("destroy"),1)}function validateEmail(e){var t=$.ajax({type:"GET",data:{email:e},url:"//mutualcog.com/profile/validate-email",async:!1}).responseText;return t==0?($("#email_group").attr("class","form-group has-error"),$("#email").tooltip("show"),0):($("#email_group").attr("class","form-group"),$("#email").tooltip("destroy"),1)}module=function(){var e=live=scroll_mod_active=1,t="",n={},r=chat_scroll_timer=typ_cnt=connected=recent=banned=stop_scroll=scroll_button_clicked=scroll_top=0,i=-1;if($(".chat_id").length)var s=$(".chat_id").attr("id").replace("chat_","");else var s="";if($("#up_arr").length)var o=jQuery.parseJSON($("#up_arr").text()),u=jQuery.parseJSON($("#down_arr").text());if(typeof io!="undefined")var a=io.connect("http://localhost:3000/",{query:"sid="+$("#sid").attr("data-sid")+"&serial="+$("#serial_tracker").text()});else var a=$("body");var f=new Array("#228d49","#f52103","#2532f2","#f94f06","#5a24d9","#f8b92d","#38cedb","#050a57"),l=new Array,c=new Array,h=new Array,p=new Array,d=new Array,v=new Array,m=new Array,g=$("#serial_id").text(),y=$("#serial_tracker").text(),b=$("#user_id").text(),w=$("#user_tracker").text(),E=20,S=300,x=1e4,T=2500,N=100,C=1e4;return{chat_scroll_timer:chat_scroll_timer,max_title_length:S,max_user_length:E,max_static_length:x,max_chat_mssg_length:T,max_description_length:N,max_info_length:C,pm_scroll_inactive:n,connected:connected,recent:recent,typ_cnt:typ_cnt,pm_info:t,focused:e,live:live,title_blinking:r,banned:banned,stop_scroll:stop_scroll,scroll_mod_active:scroll_mod_active,scroll_button_clicked:scroll_button_clicked,scroll_top:scroll_top,clicked_on:i,chat_id:s,upvoted:o,downvoted:u,socket:a,color_arr:f,mems:l,mods:c,admin:h,notifications_top_positions:p,notifications_bottom_positions:d,notifications_top_ids:v,notifications_bottom_ids:m,serial_id:g,serial_tracker:y,user_id:b,user_tracker:w}}(),updateChatTimes=function(){$.each($(".chat_time"),function(e,t){$(this).text(moment.utc($(this).attr("id")).fromNow())}),$(".last_login").length&&$(".last_login").html("<strong>Last login: </strong>"+moment.utc($(".last_login").attr("id")).fromNow())}(),updateTimes=function(){$.each($(".time"),function(e,t){$(this).text(moment.utc($(this).attr("id")).fromNow())})}(),$(document).ready(function(){module.user_id.length&&(window.setInterval(function(){module.typ_cnt>1?module.typ_cnt--:module.typ_cnt==1&&(module.typ_cnt--,module.socket.emit("not_typing",{pm_id:module.pm_info[2],friend_id:module.pm_info[1],user_id:module.user_id})),module.recent>120?$.ajax({type:"POST",data:{user_id:module.user_id},url:"//mutualcog.com/profile/update-online-status",success:function(){},error:function(){}}):module.recent++},1e3),$(window).on("mousemove",function(){module.recent>120&&module.socket.emit("seen_chats"),module.recent=0})),$(".pm_body").length&&($(".pm_body").mCustomScrollbar({theme:"light-2",callbacks:{onScroll:function(){var e=$(this),t=e.parent().attr("id"),n=this.mcs.draggerTop+e.find(".mCSB_dragger").height();n==e.height()?module.pm_scroll_inactive[t]=0:module.pm_scroll_inactive[t]=1}}}),$(".pm_body").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$(".pm_visible").css("visibility","")},50)),updateChatTimes,updateTimes,setInterval(updateTimes,6e4),setInterval(updateChatTimes,6e4),$.each($(".pm_message"),function(e,t){$(".pm_message").eq(e).attr("title",moment.utc($(".pm_message").eq(e).attr("title")).local().format("hh:mma"))}),$("#mssg_requests").popover({html:!0}),$("#global_requests").popover({html:!0}),$("#friend_requests").popover({html:!0}),$("#mssg_requests").blur(function(){$(this).popover("hide")}),$("#global_requests").blur(function(){$(this).popover("hide")}),$("#friend_requests").blur(function(){$(this).popover("hide")}),$("body").on("click",".mssg_upvote",upvoteMssg),$("body").on("click",".mssg_downvote",downvoteMssg),$("body").on("click",".accept_request",function(){var e=$(this).attr("id").split("_"),t=e[1],n=e[2];module.socket.emit("request_answered",{type:t,user_id:n,accepted:1})}),$("body").on("click",".decline_request",function(){var e=$(this).attr("id").split("_"),t=e[1],n=e[2];module.socket.emit("request_answered",{type:t,user_id:n,accepted:0})}),$("body").on("click",".pm_remove",function(){$(this).parent().parent().remove();var e=$(this).parent().parent().attr("id").split("_");return module.socket.emit("leave_pm",{pm_id:e[2],friend_id:e[1]}),!1}),$("body").on("click",".friend_box",function(){var e=$(this).attr("id").replace("friend_box_for_",""),t=$(this).attr("data-friend-id"),n=$(this).attr("data-pm-chat-id"),r=$(this).find("#friend_"+t+"_status").attr("class").replace("friend_status","");$("#pm_"+t+"_"+n).length==0&&(module.socket.emit("join_pm",{friend_id:t,friend_name:e,pm_id:n},function(e){$("#pm_"+e.friend_name).attr("id","pm_"+e.friend_id+"_"+e.pm_id)}),$.ajax({type:"GET",data:{pm_id:n},url:"//mutualcog.com/chat/pm-log",success:function(i){var s='<div class="pm_cont" id="pm_'+t+"_"+n+'">';s+='<div class="pm_header"><div class="'+r+' pm_status"></div><div class="glyphicon glyphicon-remove pm_remove"></div><div class="pm_name">'+e+"</div></div>",s+='<div class="pm_body"><div class="pm_body_mssgs">',$.each(i,function(e,t){t.author_id==module.user_id?s+='<div class="pm_mssg_cont"> <div class="pm_message pull-right" style="background-color:#eee;margin-left:30px;margin-right:5px;" title="'+moment.utc(t.created_at).local().format("hh:mma")+'"> '+t.message+" </div> </div>":s+='<div class="pm_mssg_cont"> <div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(t.created_at).local().format("hh:mma")+'"> '+t.message+" </div> </div>"}),s+='</div><div class="pm_body_alerts"> <div class="pm_mssg_alert pm_unseen" style="display:none;">Not seen</div> <div class="pm_mssg_alert pm_typing" style="display:none;">'+e+" is typing...</div> </div></div>",s+='<textarea rows=1 class="pm_text"></textarea>',s+="</div>",$(".pm_bar").prepend(s),$(".pm_cont").resizable({handles:"nw",ghost:!1,maxHeight:450,maxWidth:400,minHeight:330,minWidth:240,resize:function(e,t){var n=t.size.height,r=t.size.width-10;$(this).css("left","0"),$(this).css("top","0"),$(this).find(".pm_header").width(r),$(this).find(".pm_body").height(n-64),$(this).find(".pm_body").width($(this).find(".pm_header").width()+6),$(this).find(".pm_text").width($(this).find(".pm_header").width()-2)}});var o=$("#pm_"+t+"_"+n);if(module.pm_scroll_inactive[o.attr("id")]==0||!(o.attr("id")in module.pm_scroll_inactive)){var u=o.find(".pm_body");window.setTimeout(function(){u.mCustomScrollbar("scrollTo","bottom",{scrollInertia:0})},20)}},error:function(){}}))}),$(".pm_cont").resizable({handles:"nw",ghost:!1,maxHeight:450,maxWidth:400,minHeight:330,minWidth:240,resize:function(e,t){var n=t.size.height,r=t.size.width-10;$(this).css("left","0"),$(this).css("top","0"),$(this).find(".pm_header").width(r),$(this).find(".pm_body").height(n-64),$(this).find(".pm_body").width($(this).find(".pm_header").width()+6),$(this).find(".pm_text").width($(this).find(".pm_header").width()-2)}}),$("body").on("click",".pm_header",function(){var e=$(this).parent().attr("id").split("_");$(this).parent().find(".pm_body").css("display")=="none"?(module.socket.emit("maximize_pm",{friend_id:e[1],pm_id:e[2]}),$(this).parent().resizable("enable"),$(this).parent().find(".pm_body").css("display",""),$(this).parent().find(".pm_text").css("display",""),$(this).parent().find(".pm_body").css("visibility","hidden"),$(".pm_body").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$(".pm_body").css("visibility","")},50)):(module.socket.emit("minimize_pm",{friend_id:e[1],pm_id:e[2]}),$(this).parent().css("height")!=""&&($(this).parent().attr("data-expanded-height",$(this).parent().css("height")),$(this).parent().css("height","")),$(this).parent().resizable("disable"),$(this).parent().find(".pm_body").css("display","none"),$(this).parent().find(".pm_text").css("display","none"))})}),upvoteMssg=function(e){e.stopPropagation();var t=$(this).attr("id").replace("mssg_upvote_",""),n="//mutualcog.com/chat/message-upvote";$.ajax({type:"POST",data:{id:t},url:n,success:function(e){e.status==1||e.status==3?(e.status==1?(module.downvoted.splice(module.downvoted.indexOf(t.toString()),1),module.upvoted.push(t.toString())):module.upvoted.push(t.toString()),$("#mssg_cont_"+t).hasClass("mssg_cont")?module.socket.emit("update_votes",{id:t,response:e,responseto:"global"}):module.socket.emit("update_votes",{id:t,response:e,responseto:$("#message").attr("class")}),$("#mssg_upvote_"+t).css("color","#57bf4b"),$("#mssg_downvote_"+t).css("color","")):e.status==2?(module.upvoted.splice(module.upvoted.indexOf(t.toString()),1),$("#mssg_cont_"+t).hasClass("mssg_cont")?module.socket.emit("update_votes",{id:t,response:e,responseto:"global"}):module.socket.emit("update_votes",{id:t,response:e,responseto:$("#message").attr("class")}),$("#mssg_upvote_"+t).css("color",""),$("#mssg_downvote_"+t).css("color","")):$("#mssg_upvote_"+t).tooltip("show")},error:function(){}})},downvoteMssg=function(e){e.stopPropagation();var t=$(this).attr("id").replace("mssg_downvote_",""),n="//mutualcog.com/chat/message-downvote";$.ajax({type:"POST",data:{id:t},url:n,success:function(e){e.status==1||e.status==3?(e.status==1?(module.upvoted.splice(module.downvoted.indexOf(t.toString()),1),module.downvoted.push(t.toString())):module.downvoted.push(t.toString()),$("#mssg_cont_"+t).hasClass("mssg_cont")?module.socket.emit("update_votes",{id:t,response:e,responseto:"global"}):module.socket.emit("update_votes",{id:t,response:e,responseto:$("#message").attr("class")}),$("#mssg_downvote_"+t).css("color","red"),$("#mssg_upvote_"+t).css("color","")):e.status==2?(module.downvoted.splice(module.downvoted.indexOf(t.toString()),1),$("#mssg_cont_"+t).hasClass("mssg_cont")?module.socket.emit("update_votes",{id:t,response:e,responseto:"global"}):module.socket.emit("update_votes",{id:t,response:e,responseto:$("#message").attr("class")}),$("#mssg_upvote_"+t).css("color",""),$("#mssg_downvote_"+t).css("color","")):$("#mssg_downvote_"+t).tooltip("show")},error:function(){}})},module.socket.on("updateVotes",function(e){$("#mssg_votes_"+e.message_id).text(e.response.upvotes)}),$("#login_form").submit(function(){var e=$("#username").val(),t=$("#pass").val();if(e.length>0&&t.length>0){var n=validateLogin(e,t);if(!n)return!1}return!0}),$("#reg_username").blur(function(){var e=$("#reg_username").val();if(e.length>0)var t=validateUser(e)}),$("#pass2").blur(function(){var e=$("#reg_pass").val(),t=$("#pass2").val();if(e.length>0&&t.length>0)var n=validatePasswords(e,t)}),$("#register_form").submit(function(){var e=$("#reg_username").val(),t=$("#reg_pass").val(),n=$("#pass2").val(),r=$("#email").val();if(e.length>0&&t.length>0&&n.length>0){var i=validateUser(e);if(!i)return!1;var i=validatePasswords(t,n);if(!i)return!1;if(r.length>0){var i=validateEmail(r);if(!i)return!1}return!0}return e.length==0&&$("#reg_user_group").attr("class","form-group has-error"),t.length==0&&$("#reg_pass1_group").attr("class","form-group has-error"),n.length==0&&$("#pass2_group").attr("class","form-group has-error"),$("#reg_username").attr("data-original-title","Please enter both a username and a confirmed password"),$("#reg_username").tooltip("show"),!1}),$(".modal").on("hide.bs.modal",function(){$(".form-control").tooltip("destroy")}),$("#tag_dropdown").on("click",function(e){e.stopPropagation()}),$("#search_input").on("focus",function(e){e.stopPropagation(),$("#search_input").val()==""&&$("#tag_dropdown").html(""),$(this).dropdown(),$("#tag_dropdown").show()});var selected_term=-1;$("#search_input").on("keydown",function(e){console.log(selected_term);if(e.keyCode==13)return selected_term!=-1&&location.assign($("li#search_"+selected_term).children("a").attr("href")),!1;if(e.keyCode==38)return selected_term!=0&&(selected_term--,$(".tag_results").css("background-color",""),$("li#search_"+selected_term).css("background-color","#ddd")),!1;if(e.keyCode==40)return selected_term!=$(".tag_results").length-1&&(selected_term++,$(".tag_results").css("background-color",""),$("li#search_"+selected_term).css("background-color","#ddd")),!1}),$("#search_input").on("keyup",function(e){var t=$(this).val();if(e.keyCode==13)return!1;e.keyCode!=38&&e.keyCode!=40&&(t.length>2?$.ajax({type:"GET",data:{tag:t},url:"//mutualcog.com/tags/similar-entity",success:function(e){var t="",n=0;t+='<div class="search_res_type">Tags</div>',$.each(e,function(e,r){r.type=="tag"?t+='<li id="search_'+e+'" class="tag_results"><a href="//mutualcog.com/t/'+r.name+'">'+r.name+"</a></li>":(n==0&&(t+='<div class="search_res_type">Users</div>',n++),t+='<li id="search_'+e+'" class="tag_results"><a href="//mutualcog.com/u/'+r.name+'">'+r.name+"</a></li>")}),t?($("#tag_dropdown").show(),$("#tag_dropdown").html()!=t&&($("#tag_dropdown").html(t),selected_term=-1)):($("#tag_dropdown").hide(),selected_term=-1)},error:function(){}}):$("#tag_dropdown").html(""))}),$(window).on("blur",function(){module.focused=0,module.user_id.length&&(module.recent+=110)}),$(window).on("focus",function(){module.focused=1,module.user_id.length&&(module.recent>120&&module.socket.emit("seen_chats"),module.recent=0)}),module.socket.on("receive_pm",function(e){var t=$("#pm_"+e.friend_id+"_"+e.pm_id);if(e.state==0){var n=$("#friend_"+e.friend_id+"_status").attr("class").replace("friend_status","");$.ajax({type:"GET",data:{pm_id:e.pm_id},url:"//mutualcog.com/chat/pm-log",success:function(r){var i='<div class="pm_cont" id="pm_'+e.friend_id+"_"+e.pm_id+'">';i+='<div class="pm_header"><div class="'+n+' pm_status"></div><div class="glyphicon glyphicon-remove pm_remove"></div><div class="pm_name">'+e.friend_name+"</div></div>",i+='<div class="pm_body"><div class="pm_body_mssgs">',$.each(r,function(e,t){t.author_id==module.user_id?i+='<div class="pm_mssg_cont"> <div class="pm_message pull-right" style="background-color:#eee;margin-left:30px;margin-right:5px;" title="'+moment.utc(t.created_at).local().format("hh:mma")+'"> '+t.message+" </div> </div>":i+='<div class="pm_mssg_cont"> <div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(t.created_at).local().format("hh:mma")+'"> '+t.message+" </div> </div>"}),i+='</div><div class="pm_body_alerts"> <div class="pm_mssg_alert pm_unseen" style="display:none;">Not seen</div> <div class="pm_mssg_alert pm_typing" style="display:none;">'+e.friend_name+" is typing...</div> </div></div>",i+='<textarea rows=1 class="pm_text"></textarea>',i+="</div>",$(".pm_bar").prepend(i);var s='<div class="pm_mssg_cont">';s+='<div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(e.time).local().format("hh:mma")+'">'+e.message+"</div>",s+="</div>",t=$("#pm_"+e.friend_id+"_"+e.pm_id),t.find(".pm_body_mssgs").append(s);if(module.pm_scroll_inactive[t.attr("id")]==0||!(t.attr("id")in module.pm_scroll_inactive)){var o=t.find(".pm_body");window.setTimeout(function(){o.mCustomScrollbar("scrollTo","bottom",{scrollInertia:0})},20)}},error:function(){}})}else if(e.state==2){t.resizable("enable"),t.parent().find(".pm_body").css("display",""),t.parent().find(".pm_text").css("display","");var r='<div class="pm_mssg_cont">';r+='<div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(e.time).local().format("hh:mma")+'">'+e.message+"</div>",r+="</div>",t.find(".pm_body_mssgs").append(r)}else{var r='<div class="pm_mssg_cont">';r+='<div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(e.time).local().format("hh:mma")+'">'+e.message+"</div>",r+="</div>",t.find(".pm_body_mssgs").append(r)}if(module.pm_scroll_inactive[t.attr("id")]==0||!(t.attr("id")in module.pm_scroll_inactive)){var i=t.find(".pm_body");window.setTimeout(function(){i.mCustomScrollbar("scrollTo","bottom",{scrollInertia:0})},20)}}),module.socket.on("displayFriendRequests",function(e){var t=$("#friend_requests_count");t.text().length>0?t.text(parseInt(t.text())+1):($("#friend_request_glyph").addClass("pull-left"),t.text("1")),$("#friend_requests").attr("data-content").indexOf("No friend requests")>=0?$("#friend_requests").attr("data-content",e.message):$("#friend_requests").attr("data-content",$("#friend_requests").attr("data-content").prepend(e.message))}),module.socket.on("displayGlobalRequests",function(e){var t=$("#global_requests_count");t.text().length>0?t.text(parseInt(t.text())+1):($("#global_request_glyph").addClass("pull-left"),t.text("1")),$("#global_requests").attr("data-content").indexOf("No global requests")>=0?$("#global_requests").attr("data-content",e.message):$("#global_requests").attr("data-content",$("#global_requests").attr("data-content").prepend(e.message))}),module.socket.on("chat_seen",function(e){var t=$("#pm_"+e.friend_id+"_"+e.pm_id);t.find(".pm_unseen").hide()}),module.socket.on("is_typing",function(e){var t=$("#pm_"+e.friend_id+"_"+e.pm_id);t.find(".pm_typing").show()}),module.socket.on("not_typing",function(e){var t=$("#pm_"+e.friend_id+"_"+e.pm_id);t.find(".pm_typing").hide()});var pm_keys=new Array;$("body").on("cut",".pm_text",function(e){var t=$(this),n=this;window.setTimeout(function(){t.height(0),t.height(n.scrollHeight-10)},0)}),$("body").on("paste",".pm_text",function(e){var t=$(this),n=this;window.setTimeout(function(){t.height(0),t.height(n.scrollHeight-10)},0)}),$("body").on("keydown",".pm_text",function(e){pm_keys.push(e.which);var t=$(this),n=this;window.setTimeout(function(){t.height(0),t.height(n.scrollHeight-10)},0)}),$("body").on("keyup",".pm_text",function(e){module.pm_info=$(this).parent().attr("id").split("_");var t=$(this).parents(".pm_cont");module.user_id.length&&(module.recent>120&&module.socket.emit("seen_chats"),module.recent=0);if(e.which==13)if(pm_keys.indexOf(16)==-1){pm_keys.splice(pm_keys.indexOf(e.which),1),module.typ_cnt>0&&module.socket.emit("not_typing",{pm_id:module.pm_info[2],friend_id:module.pm_info[1],user_id:module.user_id});if($(this).val().trim()!=""){module.socket.emit("send_pm",{message:$(this).val(),pm_id:module.pm_info[2],friend_id:module.pm_info[1],user_id:module.user_id},function(e){var t=$("#pm_"+e.friend_id+"_"+e.pm_id),n=t.find(".tmp_message");n.find(".pm_message").html(e.message),n.attr("class",n.attr("class").replace("tmp_message","")),e.unseen&&t.find(".pm_unseen").show()}),$(this).css("height",""),$(this).val("");var n='<div class="pm_mssg_cont tmp_message">';n+='<div class="pm_message pull-right" style="background-color:#eee;margin-left:30px;margin-right:5px;" title="'+moment().format("hh:mma")+'">'+$(this).val()+"</div>",n+="</div>",$("#pm_"+module.pm_info[1]+"_"+module.pm_info[2]).find(".pm_body_mssgs").append(n),console.log(module.pm_scroll_inactive);if(module.pm_scroll_inactive[t.attr("id")]==0||!(t.attr("id")in module.pm_scroll_inactive)){var r=t.find(".pm_body");window.setTimeout(function(){r.mCustomScrollbar("scrollTo","bottom",{scrollInertia:0})},20)}}module.typ_cnt=0}else module.typ_cnt==0&&module.socket.emit("is_typing",{pm_id:module.pm_info[2],friend_id:module.pm_info[1],user_id:module.user_id}),pm_keys.splice(keys.indexOf(e.which),1),module.typ_cnt=4;else module.typ_cnt==0&&module.socket.emit("is_typing",{pm_id:module.pm_info[2],friend_id:module.pm_info[1],user_id:module.user_id}),pm_keys.splice(pm_keys.indexOf(e.which),1),module.typ_cnt=4;return!0}),module.socket.on("softDelete",function(e){$("#message_"+e.id+".chat_mssg").length&&($(".mssg_icon").tooltip("hide"),$(".mssg_icon").tooltip(),$("#message_"+e.id+".chat_mssg").find(".mssg_body").html("<strong class='mssg_op' id='"+e.user+"' style='color:"+module.color_arr[e.mssg_serial%7]+";'>"+e.user+" (<span class='response_count' id='"+e.id+"'>"+e.responses+"</span>)</strong> : <em>This message has been deleted</em>"))}),deleteIt=function(e){e.stopPropagation();var t=$(this).parents(".chat_mssg").first().attr("id").replace("message_","");$("#logged_in").text()==1?module.socket.emit("delete_message",{id:t,user:module.user_tracker,serial:$(this).attr("data-mssg-serial"),responses:$(this).parent().find(".response_count").text()}):module.socket.emit("delete_message",{id:t,user:module.serial_tracker,serial:$(this).attr("data-mssg-serial"),responses:$(this).parent().find(".response_count").text()})},$(".big_upvote").click(function(e){e.stopPropagation();var t=$(this).attr("id"),n="//mutualcog.com/chat/upvote";$.ajax({type:"POST",data:{id:module.chat_id},url:n,success:function(e){e.status==1||e.status==3?($("#votes_"+module.chat_id).text(e.upvotes),$("#upvote_"+module.chat_id).css("color","#57bf4b"),$("#downvote_"+module.chat_id).css("color","")):e.status==2?($("#votes_"+module.chat_id).text(e.upvotes),$("#upvote_"+module.chat_id).css("color",""),$("#downvote_"+module.chat_id).css("color","")):$("#"+t).tooltip("show")},error:function(){}})}),$(".big_downvote").click(function(e){e.stopPropagation();var t=$(this).attr("id"),n="//mutualcog.com/chat/downvote";$.ajax({type:"POST",data:{id:module.chat_id},url:n,success:function(e){e.status==1||e.status==3?($("#votes_"+module.chat_id).text(e.upvotes),$("#downvote_"+module.chat_id).css("color","red"),$("#upvote_"+module.chat_id).css("color","")):e.status==2?($("#votes_"+module.chat_id).text(e.upvotes),$("#upvote_"+module.chat_id).css("color",""),$("#downvote_"+module.chat_id).css("color","")):$("#"+t).tooltip("show")},error:function(){}})}),$(window).on("click",function(e){$("#tag_dropdown").hide(),$("#members_box").hide("blind"),$("#show_members").removeClass("highlighted_dark")}),$(document).ready(function(){$(".chat_main").mCustomScrollbar({theme:"minimal",scrollInertia:100,callbacks:{onScroll:function(){module.scroll_top=this.mcs.draggerTop;var e=this.mcs.draggerTop+$(".chat_main").find(".mCSB_dragger").height();e==$(".chat_main").height()-4?(module.stop_scroll=0,module.scroll_mod_active=1,$("#stop_scroll").removeClass("highlight_red"),$("#stop_scroll").attr("data-original-title","Stop scrollbar")):scroll_mod_active&&(module.stop_scroll=1,module.chat_scroll_timer=10,$("#stop_scroll").hasClass("highlight_red")||($("#stop_scroll").addClass("highlight_red"),$("#stop_scroll").attr("data-original-title","Resume scrolling")))}}}),window.setInterval(function(){module.chat_scroll_timer==0?module.scroll_button_clicked==0&&module.stop_scroll&&($("#stop_scroll").removeClass("highlight_red"),$("#stop_scroll").attr("data-original-title","Stop scrollbar"),module.stop_scroll=0):module.chat_scroll_timer--},1e3),$(".mssg_cont").show(),$("#chat_messages").click(function(){module.scroll_mod_active==0&&(module.stop_scroll==1&&($("#stop_scroll").removeClass("highlight_red"),$("#stop_scroll").attr("data-original-title","Stop scrollbar")),module.scroll_mod_active=1,module.scroll_button_clicked=0,module.stop_scroll=0),$("#message").attr("class","global"),$(".chat_mssg").css("background-color","");var e=$("#permalink").attr("data-page-link");e.split("/").length-1!=5&&(e=e.substring(0,e.lastIndexOf("/")),$("#permalink").attr("data-page-link",e)),module.clicked_on=-1,$("#message").text()!=""?$("#message").text("Press enter to send a message to all"):($("#message").val("Press enter to send a message to all"),$("#message").on("click",function(){$(this).val(""),$(this).off("click")}))}),$("a#continue_description").click(function(e){return $("#continue_modal").modal(),!1}),$("button#save_details").click(function(){$("#description_modal").modal("hide"),$.ajax({type:"POST",data:{details:$("#detail_text").val(),id:module.chat_id},url:"//mutualcog.com/chat/details",success:function(e){$("#curr_details").html(e),module.socket.emit("update_details",e)},error:function(){}})});var e=0,t=0;$("#curr_details").hasClass("edit_details")&&($("#curr_details").tooltip(),$("#curr_details").click(function(){return $("#description_modal").modal(),!1})),$(".caret_tooltip").tooltip(),$("#permalink").tooltip(),$("#show_members").tooltip(),$("#stop_scroll").tooltip(),$("#pause_chat").tooltip(),$("#mod_user").tooltip(),$("#warn_user").tooltip(),$("#kick_user").tooltip(),$("#permalink").click(function(e){window.location.href=$(this).attr("data-page-link")}),$("#show_members").click(function(n){return t==0&&$("#members_box").toggle("blind"),$(this).hasClass("highlighted_dark")?(e=0,$(this).attr("data-original-title","Show chat members"),$(this).removeClass("highlighted_dark")):(e=1,$(this).attr("data-original-title","Hide chat members"),$(this).addClass("highlighted_dark")),!1}),$("#show_members").hover(function(){e==0&&($("#members_box").show("blind"),t=1)},function(){e==0&&($("#members_box").hide("blind"),t=0)}),$("#pause_chat").click(function(){$(this).hasClass("pause")?(module.socket.emit("pause_all"),$(this).removeClass("pause"),$(this).removeClass("glyphicon-pause"),$(this).addClass("glyphicon-play"),$(this).addClass("play"),$(this).attr("data-original-title","Play chat")):(module.socket.emit("play_all"),$(this).removeClass("play"),$(this).removeClass("glyphicon-play"),$(this).addClass("glyphicon-pause"),$(this).addClass("pause"),$(this).attr("data-original-title","Pause chat"))}),$("#mod_user").click(function(){var e=$("#mssg_cont_"+module.clicked_on).find(".mssg_op").attr("data-author");if(e==module.user_tracker||module.clicked_on==-1)return!1;$.ajax({type:"GET",url:"//mutualcog.com/chat/check-mod",data:{user:e,chat_id:module.chat_id},success:function(t){t==0?module.socket.emit("make_mod",{user:e,chat_id:module.chat_id}):module.socket.emit("remove_mod",{user:e,chat_id:module.chat_id})},error:function(){}})}),$("#warn_user").click(function(){var e=$("#mssg_cont_"+module.clicked_on).find(".mssg_op").attr("data-author");if(e==module.user_tracker||module.clicked_on==-1)return!1;module.socket.emit("warn",{member:e})}),$("#kick_user").click(function(){var e=$("#mssg_cont_"+module.clicked_on).find(".mssg_op").attr("data-author");if(e==module.user_tracker||module.clicked_on==-1)return!1;module.socket.emit("kick",{member:e})}),$("#stop_scroll").click(function(){$(this).hasClass("highlight_red")?(module.stop_scroll=0,module.scroll_button_clicked=0,module.scroll_mod_active=1,$(this).removeClass("highlight_red"),$(this).attr("data-original-title","Stop scrollbar")):(module.stop_scroll=1,module.scroll_button_clicked=1,module.scroll_mod_active=0,$(this).addClass("highlight_red"),$(this).attr("data-original-title","Resume scrolling"))})}),setClicked=function(e){e.stopPropagation(),module.clicked_on=$(this).attr("id").replace("message_","");var t=$("#permalink").attr("data-page-link");t.split("/").length-1==5?$("#permalink").attr("data-page-link",t+"/"+module.clicked_on):(t=t.substring(0,t.lastIndexOf("/")),$("#permalink").attr("data-page-link",t+"/"+module.clicked_on)),$(".chat_mssg").css("background-color",""),$(this).css("background-color","#ddd"),$("#message").attr("class",$(this).attr("id").replace("message_","")),module.stop_scroll==0&&($("#stop_scroll").addClass("highlight_red"),$("#stop_scroll").attr("data-original-title","Resume scrolling")),module.scroll_mod_active=0,module.scroll_button_clicked=1,module.stop_scroll=1,$("#message").text()!=""?$("#message").text("Press enter to respond to "+$(this).find(".mssg_op").attr("data-author")+"'s message"):($("#message").val("Press enter to respond to "+$(this).find(".mssg_op").attr("data-author")+"'s message"),$("#message").on("click",function(){$(this).val(""),$(this).off("click")}))},getResponses=function(e){e.stopPropagation();var t=$(this).attr("id").replace("toggle_","");$(this).hasClass("dropup")?($(this).removeClass("dropup"),$(this).find(".caret").attr("data-original-title","Hide Responses"),$("#mssg_cont_"+t).children(".mssg_cont").show()):($(this).addClass("dropup"),$(this).find(".caret").attr("data-original-title","Show Responses"),$("#mssg_cont_"+t).children(".mssg_cont").hide())},find_top_notifications=function(){var e=Math.min.apply(Math,module.notifications_top_positions),t=module.notifications_top_ids[module.notifications_top_positions.indexOf(e)];module.notifications_top_ids.splice(module.notifications_top_positions.indexOf(e),1),module.notifications_top_positions.splice(module.notifications_top_positions.indexOf(e),1),$(".chat_main").mCustomScrollbar("scrollTo",e,{scrollInertia:50}),setTimeout(function(){$("#message_"+t).addClass("highlight_background","800")},100),setTimeout(function(){$("#message_"+t).removeClass("highlight_background","slow")},800);var n=parseInt($("#notify_text_top").text());n>1?$("#notify_text_top").text(n-1):($("#notify_text_top").text(0),$("#notify_cont_top").hide("blind"))},find_bottom_notifications=function(){var e=Math.min.apply(Math,module.notifications_bottom_positions),t=module.notifications_bottom_ids[module.notifications_bottom_positions.indexOf(e)];module.notifications_bottom_ids.splice(module.notifications_bottom_positions.indexOf(e),1),module.notifications_bottom_positions.splice(module.notifications_bottom_positions.indexOf(e),1),$(".chat_main").mCustomScrollbar("scrollTo",e,{scrollInertia:50}),setTimeout(function(){$("#message_"+t).addClass("highlight_background","800")},100),setTimeout(function(){$("#message_"+t).removeClass("highlight_background","slow")},800);var n=parseInt($("#notify_text_bottom").text());n>1?$("#notify_text_bottom").text(n-1):($("#notify_text_bottom").text(0),$("#notify_cont_bottom").hide("blind"))},notifyMessage=function(){module.title_blinking=1,setTimeout(function(){module.focused?($("title").html("Mutual Cognizance"),module.title_blinking=0):($("title").html()=="Mutual Cognizance (1)"?$("title").html("New Message"):$("title").html("Mutual Cognizance (1)"),notifyMessage())},800)},module.socket.on("connect",function(){console.log("Client has connected"),module.connected=1,module.socket.emit("room",module.chat_id),$(".enter_hint").text()=="You are disconnected"&&($(".enter_hint").text("Press Shift+Enter for new line"),$(".response_hint").text("Click on a message to respond to it"),$(".pm_unseen").text(""),$(".pm_unseen").hide()),$("#logged_in").text()==1?module.socket.emit("add_member",{new_member:module.user_tracker,serial_id:module.serial_id}):module.socket.emit("add_member",{new_member:module.serial_tracker,serial_id:module.serial_id})}),module.socket.on("alertUserToResponse",function(e){if($("#mssg_cont_"+e.mssg_id).parent().css("display")=="none")var t=$("#mssg_cont_"+e.parent).position().top;else var t=$("#mssg_cont_"+e.resp_id).position().top;var n=t-module.scroll_top+12;if(!(n>0)){module.notifications_top_positions.push(t),module.notifications_top_ids.push(e.resp_id);var r=parseInt($("#notify_text_top").text());r!=9&&(r+=1),$("#notify_text_top").text(r),$("#notify_cont_top").css("display")=="none"&&$("#notify_cont_top").show("blind")}var i=t-module.scroll_top-$("#chat_messages").height();if(i>0){module.notifications_bottom_positions.push(t),module.notifications_bottom_ids.push(e.resp_id);var s=parseInt($("#notify_text_bottom").text());s!=9&&(s+=1),$("#notify_text_bottom").text(s),$("#notify_cont_bottom").css("display")=="none"&&$("#notify_cont_bottom").show("blind")}}),module.socket.on("display_details",function(e){$("#curr_details").html(e)}),module.socket.on("updateResponseCount",function(e){$("#"+e.id+".response_count").animate({color:module.color_arr[e.serial%7]},"slow"),$("#"+e.id+".response_count").animate({color:"black"},"slow"),$("#"+e.id+".response_count").text(e.count)}),module.socket.on("displayMembers",function(e){module.mems=new Array,module.mods=new Array,module.admin=new Array,e.add&&$.each($(".author_"+e.mod),function(t,n){$(".author_"+e.mod).eq(t).html("<span class='glyphicon glyphicon-tower' style='margin-right:5px;'></span>"+$(".author_"+e.mod).eq(t).html())}),e.remove&&$(".author_"+e.mod).find(".glyphicon-tower").remove(),$.each(e.members,function(e,t){t.is_admin?(module.admin.push(t.user),module.mems.push("<div style='color:white;'><span class='glyphicon glyphicon-star' style='margin-right:5px;'></span>"+t.user+"</div>")):t.is_mod?(module.mods.push(t.user),module.mems.push("<div style='color:white;'><span class='glyphicon glyphicon-tower' style='margin-right:5px;'></span>"+t.user+"</div>")):module.mems.push("<div style='color:white;'>"+t.user+"</div>")}),$("#members_list").html(module.mems.join(""))}),module.socket.on("add_mod_funcs",function(){$("#user_toolbox").append('<span class="glyphicon glyphicon-warning-sign mod_power" id="warn_user" data-toggle="tooltip" data-container="body" data-placement="top" data-original-title="Warn user"></span> <span class="glyphicon glyphicon-remove mod_power" id="kick_user" data-toggle="tooltip" data-container="body" data-placement="top" data-original-title="Kick user"></span> '),$("#warn_user").tooltip(),$("#kick_user").tooltip()}),module.socket.on("remove_mod_funcs",function(){$(".mod_power").remove()}),module.socket.on("add_mod_confirm",function(e){$("#modified_ident").text(e),$("#modified_message").text("is now a mod"),$("#action_confirmed").show("blind",function(){window.setTimeout(function(){$("#action_confirmed").hide("blind")},1500)})}),module.socket.on("remove_mod_confirm",function(e){$("#modified_ident").text(e),$("#modified_message").text("is no longer a mod"),$("#action_confirmed").show("blind",function(){window.setTimeout(function(){$("#action_confirmed").hide("blind")},1500)})}),module.socket.on("pause",function(){module.live=0,$(".chat_paused").remove(),$("#main").append('<div class="chat_paused" id="paused_message">Chat has been paused</div>'),$("#paused_message").show("fade","slow")}),module.socket.on("play",function(){module.live=1,$("#paused_message").hide("fade","slow",function(){$("#paused_message").remove()})}),module.socket.on("warn",function(){$(".chat_paused").remove(),$("#main").append('<div class="chat_paused" id="warned_user">You have been warned</div>'),$("#warned_user").show("fade","slow",function(){window.setTimeout(function(){$("#warned_user").hide("fade","slow")},1500)})}),module.socket.on("warn_confirm",function(e){$("#modified_ident").text(e),$("#modified_message").text("has been warned"),$("#action_confirmed").show("blind",function(){window.setTimeout(function(){$("#action_confirmed").hide("blind")},1500)})}),module.socket.on("kick",function(){module.banned=1,$(".chat_paused").remove(),$("#main").append('<div class="chat_paused" id="banned_user">You have been banned</div>'),$("#banned_user").show("fade","slow")}),module.socket.on("kick_confirm",function(e){$("#modified_ident").text(e),$("#modified_message").text("is now banned"),$("#action_confirmed").show("blind",function(){window.setTimeout(function(){$("#action_confirmed").hide("blind")},1500)})}),module.socket.on("check_live",function(e){e=="1"?$("#paused_message").hide("fade","show",function(){$("#paused_message").remove()}):(module.live=0,$("#main").append('<div class="chat_paused" id="paused_message">Chat has been paused</div>'),$("#paused_message").show("fade","show")),$(".mssg_icon").tooltip(),$("#notify_cont_top").on("click",find_top_notifications),$("#notify_cont_bottom").on("click",find_bottom_notifications),$("#chat_display").on("click",".mssg_icon",deleteIt),$("#chat_display").on("click",".mssg_upvote",upvoteMssg),$("#chat_display").on("click",".mssg_downvote",downvoteMssg),$("#chat_display").on("click",".chat_mssg",setClicked),$("#chat_display").on("click",".toggle_responses",getResponses),$("#chat_display").on("click",".chat_link",function(e){e.stopPropagation()})}),generateMssg=function(e,t){if(t)var n="<div class='response_to_0 mssg_cont y_0 parent_0' id='mssg_cont_"+e.id+"'><div class='chat_mssg' id='message_"+e.id+"'>";else var n="<div class='response_to_"+e.responseto+" mssg_cont y_"+e.y_dim+" parent_"+e.parent+" pad_l_20' id='mssg_cont_"+e.id+"'><div class='chat_mssg' id='message_"+e.id+"'>";return n+="<div class='row' style='margin:0;'> <div class='mssg_body_cont'><div class='vote_box'>",module.user_tracker==e.author||module.serial_tracker==e.author?n+='<span class="glyphicon glyphicon-chevron-up mssg_upvote" style="color:#57bf4b;" id="mssg_upvote_'+e.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on messages" data-container="body" data-placement="top"></span> <div class="upvote_count" id="mssg_votes_'+e.id+'">0</div> <span class="glyphicon glyphicon-chevron-down mssg_downvote" id="mssg_downvote_'+e.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on messages" data-container="body" data-placement="bottom"></span>':n+='<span class="glyphicon glyphicon-chevron-up mssg_upvote" id="mssg_upvote_'+e.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on messages" data-container="body" data-placement="top"></span> <div class="upvote_count" id="mssg_votes_'+e.id+'">0</div> <span class="glyphicon glyphicon-chevron-down mssg_downvote" id="mssg_downvote_'+e.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on messages" data-container="body" data-placement="bottom"></span>',n+='</div><div class="mssg_body author_'+e.author+'"><div id="toggle_'+e.id+'" class="toggle_responses"> <span class="caret caret_tooltip" id="caret_'+e.id+'" data-toggle="tooltip" data-original-title="Hide Responses" data-container="body" data-placement="top"></span> </div> ',(module.serial_tracker==e.author||module.user_tracker==e.author)&&e.message!="<i>This message has been deleted</i>"&&(n+="<span id='remove_"+e.id+"' style='margin-right:4px;' class='glyphicon glyphicon-remove mssg_icon' data-mssg-serial='"+e.serial+"' data-toggle='tooltip' title='Delete post' data-container='body' data-placement='top'></span>"),module.admin.indexOf(e.author)!=-1?n+="<span class='glyphicon glyphicon-star'></span>":module.mods.indexOf(e.author)!=-1&&(n+="<span class='glyphicon glyphicon-tower'></span>"),n+="<strong class='mssg_op' data-author='"+e.author+"' style='color:"+module.color_arr[e.serial%7]+";'> "+e.author+" (<span class='response_count' id='"+e.id+"'>0</span>)</strong> : "+e.message+"<div class='time_box'><div class='time' id='"+e.created_at+"'>"+moment.utc(e.created_at).fromNow()+"</div></div></div></div></div></div></div>",n},module.socket.on("publishMessage",function(e){if(e.responseto==0){var t=generateMssg(e,1);$(".tmp_message").remove(),$("#chat_display").append(t)}else{var t=generateMssg(e,0);$(".tmp_message").remove(),$("#mssg_cont_"+e.responseto).append(t)}$(".mssg_icon").tooltip(),$(".caret_tooltip").tooltip(),!module.focused&&!module.title_blinking&&notifyMessage(),module.stop_scroll||(module.scroll_mod_active=0,$(".chat_main").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){module.scroll_mod_active=1},100))}),module.socket.on("disconnect",function(){module.connected=0,$(".enter_hint").text(""),$(".response_hint").text(""),$(".enter_hint").text("You are disconnected"),$(".pm_unseen").text("You are disconnected"),$(".pm_unseen").show(),console.log("The client has disconnected!")}),$("#message").click(function(){$(".enter_hint").text(""),$(".response_hint").text(""),$(this).text("")});var keys=new Array;$("#message").keydown(function(e){keys.push(e.which)}),$("#message").keyup(function(e){if(module.live&&module.banned==0)if(e.which==13)if(keys.indexOf(16)==-1){keys.splice(keys.indexOf(e.which),1);if($("#message").val().trim()!="")if(module.connected){if($("#message").attr("class")=="global")module.socket.emit("message_sent",{message:$("#message").val(),responseto:0,y_dim:0,parent:0});else{var t=$("#message").attr("class").replace("message_",""),n=parseInt($("#mssg_cont_"+t).attr("class").split(" ")[2].replace("y_",""))+1;console.log(n);if($("#mssg_cont_"+t).attr("class").split(" ")[3].replace("parent_","")==0)var r=t;else var r=$("#mssg_cont_"+t).parents(".mssg_cont").last().attr("id").replace("mssg_cont_","");module.socket.emit("message_sent",{message:$("#message").val(),responseto:t,y_dim:n,parent:r})}$("#message").val("")}else $(".enter_hint").text("You are disconnected")}else keys.splice(keys.indexOf(e.which),1);else keys.splice(keys.indexOf(e.which),1);else keys.splice(keys.indexOf(e.which),1)})