function sendMessageToServer(e){socket.emit("message_sent",e),$("#logged_in").text()==1?$("#chat_display").append("<div id='mssg_cont'><div class='chat_mssg'><div><span class='glyphicon glyphicon-remove mssg_icon'></span><b class='mssg_op' id='"+user_tracker+"' style='color:"+color_arr[serial_tracker%7]+";'> "+user_tracker+"(<span class='response_count'>0</span>)</b> : "+e.message+"</div><div class='time'>a few seconds ago</div></div></div>"):$("#chat_display").append("<div id='mssg_cont'><div class='chat_mssg'><div><span class='glyphicon glyphicon-remove mssg_icon'></span><b class='mssg_op' id='"+serial_tracker+"' style='color:"+color_arr[serial_tracker%7]+";'> "+serial_tracker+"(<span class='response_count'>0</span>)</b> : "+e.message+"</div><div class='time'>a few seconds ago</div></div></div>")}function sendResponseToServer(e,t){socket.emit("response_sent",e),$("#logged_in").text()==1?$("#resp_cont_"+t).append("<div class='responses_to_"+t+" pad_l_20'><div class='chat_resp'><div><span class='glyphicon glyphicon-remove mssg_icon'></span><b class='mssg_op' id='"+user_tracker+"' style='color:"+color_arr[serial_tracker%7]+";'> "+user_tracker+"(<span class='response_count'>0</span>)</b> : "+e.message+"</div><div class='time'>a few seconds ago</div></div></div>"):$("#resp_cont_"+t).append("<div class='responses_to_"+t+" pad_l_20'><div class='chat_resp'><div><span class='glyphicon glyphicon-remove mssg_icon'></span><b class='mssg_op' id='"+serial_tracker+"' style='color:"+color_arr[serial_tracker%7]+";'> "+serial_tracker+"(<span class='response_count'>0</span>)</b> : "+e.message+"</div><div class='time'>a few seconds ago</div></div></div>")}var curr_request,focused=1,title_blinking=0,clicked_on=-1,mssg_clicked=-1,live=1,banned=0,chat_id=$(".chat_id").attr("id"),upvoted=jQuery.parseJSON($("#up_arr").text()),downvoted=jQuery.parseJSON($("#down_arr").text()),socket=io.connect("http://localhost:3000/"),stop_scroll=0,color_arr=new Array("#228d49","#f52103","#2532f2","#f94f06","#5a24d9","#f8b92d","#38cedb","#000"),mems=new Array,mods=new Array,admin=new Array,serial_id=$("#serial_id").text(),serial_tracker=$("#serial_tracker").text(),user_id=$("#user_id").text(),user_tracker=$("#user_tracker").text();$(".big_upvote").click(function(e){e.stopPropagation();var t=$(this).attr("id"),n=$(this).attr("id").replace("upvote_",""),r="//www.mutualcog.com/chat/upvote";$.ajax({type:"POST",data:{id:n},url:r,success:function(e){e.status==1||e.status==3?($("#votes_"+n).text(e.upvotes),$("#upvote_"+n).css("color","#57bf4b"),$("#downvote_"+n).css("color","")):e.status==2?($("#votes_"+n).text(e.upvotes),$("#upvote_"+n).css("color",""),$("#downvote_"+n).css("color","")):$("#"+t).tooltip("show")},error:function(){}})}),$(".big_downvote").click(function(e){e.stopPropagation();var t=$(this).attr("id"),n=$(this).attr("id").replace("downvote_",""),r="//www.mutualcog.com/chat/downvote";$.ajax({type:"POST",data:{id:n},url:r,success:function(e){e.status==1||e.status==3?($("#votes_"+n).text(e.upvotes),$("#downvote_"+n).css("color","red"),$("#upvote_"+n).css("color","")):e.status==2?($("#votes_"+n).text(e.upvotes),$("#upvote_"+n).css("color",""),$("#downvote_"+n).css("color","")):$("#"+t).tooltip("show")},error:function(){}})}),socket.on("updateVotes",function(e){$("#mssg_votes_"+e.message_id).text(e.response.upvotes)}),upvoteMssg=function(e){e.stopPropagation();var t=$(this).attr("id").replace("mssg_upvote_",""),n="//www.mutualcog.com/chat/message-upvote";$.ajax({type:"POST",data:{id:t},url:n,success:function(e){e.status==1||e.status==3?(e.status==1?(downvoted.splice(downvoted.indexOf(t.toString()),1),upvoted.push(t.toString())):upvoted.push(t.toString()),$("#mssg_cont_"+t).hasClass("mssg_cont")?socket.emit("update_votes",{id:t,response:e,responseto:"global"}):socket.emit("update_votes",{id:t,response:e,responseto:$("#message").attr("class")}),$("#mssg_upvote_"+t).css("color","#57bf4b"),$("#mssg_downvote_"+t).css("color","")):e.status==2?(upvoted.splice(upvoted.indexOf(t.toString()),1),$("#mssg_cont_"+t).hasClass("mssg_cont")?socket.emit("update_votes",{id:t,response:e,responseto:"global"}):socket.emit("update_votes",{id:t,response:e,responseto:$("#message").attr("class")}),$("#mssg_upvote_"+t).css("color",""),$("#mssg_downvote_"+t).css("color","")):$("#mssg_upvote_"+t).tooltip("show")},error:function(){}})},downvoteMssg=function(e){e.stopPropagation();var t=$(this).attr("id").replace("mssg_downvote_",""),n="//www.mutualcog.com/chat/message-downvote";$.ajax({type:"POST",data:{id:t},url:n,success:function(e){e.status==1||e.status==3?(e.status==1?(upvoted.splice(downvoted.indexOf(t.toString()),1),downvoted.push(t.toString())):downvoted.push(t.toString()),$("#mssg_cont_"+t).hasClass("mssg_cont")?socket.emit("update_votes",{id:t,response:e,responseto:"global"}):socket.emit("update_votes",{id:t,response:e,responseto:$("#message").attr("class")}),$("#mssg_downvote_"+t).css("color","red"),$("#mssg_upvote_"+t).css("color","")):e.status==2?(downvoted.splice(downvoted.indexOf(t.toString()),1),$("#mssg_cont_"+t).hasClass("mssg_cont")?socket.emit("update_votes",{id:t,response:e,responseto:"global"}):socket.emit("update_votes",{id:t,response:e,responseto:$("#message").attr("class")}),$("#mssg_upvote_"+t).css("color",""),$("#mssg_downvote_"+t).css("color","")):$("#mssg_downvote_"+t).tooltip("show")},error:function(){}})},$("#login_form").submit(function(){var e=1,t=$("#username").val(),n=$("#pass").val(),r=$("#pass2").val();$(".form-group").attr("class","form-group");if(t.length<3||t.length>20)$("#user_group").attr("class","form-group has-error"),$("#username").attr("data-original-title","Username must be longer than 2 characters but less than 15"),$("#username").tooltip("show"),e=0;else if(r!=""){var i=$.ajax({type:"GET",data:{username:t},url:"//www.mutualcog.com/profile/checkuser",async:!1}).responseText;console.log(t),console.log(i);if(i==1){var i=$.ajax({type:"GET",data:{username:t},url:"//www.mutualcog.com/profile/checkalpha",async:!1}).responseText;i!=1&&($("#user_group").attr("class","form-group has-error"),$("#username").attr("data-original-title","Your username must contain at least one character"),$("#username").tooltip("show"),e=0)}else $("#user_group").attr("class","form-group has-error"),$("#username").attr("data-original-title","That username already exists"),$("#username").tooltip("show"),e=0}else{var i=$.ajax({type:"GET",data:{username:t,pass:n},url:"//www.mutualcog.com/profile/checkcredentials",async:!1}).responseText;i!=1&&($("#user_group").attr("class","form-group has-error"),$("#pass1_group").attr("class","form-group has-error"),$("#username").attr("data-original-title","Your username or password is incorrect"),$("#username").tooltip("show"),e=0)}if(n.length<6||n.length>30)$("#pass1_group").attr("class","form-group has-error"),$("#pass2_group").attr("class","form-group has-error"),$("#pass").tooltip("show"),e=0;return n!=r&&r!=""&&($("#pass1_group").attr("class","form-group has-error"),$("#pass2_group").attr("class","form-group has-error"),$("#pass2").tooltip("show"),e=0),e?!0:!1}),$("#tag_dropdown").on("click",function(e){e.stopPropagation()}),$("#search_input").on("focus",function(e){e.stopPropagation(),$("#search_input").val()==""&&$("#tag_dropdown").html(""),$(this).dropdown(),$("#tag_dropdown").show()}),$(window).on("click",function(e){$("#tag_dropdown").hide(),$("#members_box").hide("blind"),$("#show_members").removeClass("highlighted_dark")});var selected_term=-1;$("#search_input").on("keydown",function(e){if(e.keyCode==13)return selected_term!=-1&&location.assign($("li#search_"+selected_term).children("a").attr("href")),!1;if(e.keyCode==38)return selected_term!=0&&(selected_term--,$(".tag_results").css("background-color",""),$("li#search_"+selected_term).css("background-color","#f5f5f5")),!1;if(e.keyCode==40)return selected_term!=$("#tag_dropdown").length&&(selected_term++,$(".tag_results").css("background-color",""),$("li#search_"+selected_term).css("background-color","#f5f5f5")),!1}),$("#search_input").on("keyup",function(e){var t=$(this).val();if(e.keyCode==13)return!1;e.keyCode!=38&&e.keyCode!=40&&(t.length>2?$.ajax({type:"GET",data:{tag:t},url:"//www.mutualcog.com/tags/similar-tag",success:function(e){var t="";$.each(e,function(e,n){t+='<li id="search_'+e+'" class="tag_results"><a href="//www.mutualcog.com/tags/tag/'+n.name+'">'+n.name+"</a></li>"}),t?($("#tag_dropdown").show(),$("#tag_dropdown").html()!=t&&($("#tag_dropdown").html(t),selected_term=-1)):($("#tag_dropdown").hide(),selected_term=-1)},error:function(){}}):$("#tag_dropdown").html(""))}),$(window).on("blur",function(){focused=0}),$(window).on("focus",function(){focused=1}),updateChatTimes=function(){$.each($(".chat_time"),function(e,t){$(this).text(moment.utc($(this).attr("id")).fromNow())})},updateTimes=function(){$.each($(".time"),function(e,t){$(this).text(moment.utc($(this).attr("id")).fromNow())})},$(document).ready(function(){updateChatTimes(),updateTimes(),setInterval(updateTimes,6e4),setInterval(updateChatTimes,6e4),$("#chat_messages").click(function(){$("#message").attr("class","global"),$(".chat_mssg").css("background-color",""),$(".chat_resp").css("background-color",""),$("#mssg_cont_"+mssg_clicked).children("#resp_cont_"+mssg_clicked).remove(),clicked_on=-1,socket.emit("leave_last_room"),$("#message").text()!=""?$("#message").text("Press enter to send a message to all"):($("#message").val("Press enter to send a message to all"),$("#message").on("click",function(){$(this).val(""),$(this).off("click")}))}),$("a#continue_description").click(function(e){e.stopPropagation(),$("#continue_modal").modal()}),$("button#save_details").click(function(){$("#description_modal").modal("hide"),$.ajax({type:"POST",data:{details:$("#detail_text").val(),id:$(".chat_id").attr("id")},url:"//www.mutualcog.com/chat/details",success:function(e){$("#curr_details").html(e),socket.emit("update_details",e)},error:function(){}})});var e=0,t=0;$("#curr_details").hasClass("edit_details")&&($("#curr_details").tooltip(),$("#curr_details").click(function(){return $("#description_modal").modal(),!1})),$(".mssg_upvote").on("click",upvoteMssg),$(".mssg_downvote").on("click",downvoteMssg),$("#show_members").tooltip(),$("#stop_scroll").tooltip(),$("#pause_chat").tooltip(),$("#mod_user").tooltip(),$("#warn_user").tooltip(),$("#kick_user").tooltip(),$("#show_members").click(function(n){return t==0&&$("#members_box").toggle("blind"),$(this).hasClass("highlighted_dark")?(e=0,$(this).attr("data-original-title","Show chat members"),$(this).removeClass("highlighted_dark")):(e=1,$(this).attr("data-original-title","Hide chat members"),$(this).addClass("highlighted_dark")),!1}),$("#show_members").hover(function(){e==0&&($("#members_box").show("blind"),t=1)},function(){e==0&&($("#members_box").hide("blind"),t=0)}),$("#pause_chat").click(function(){$(this).hasClass("pause")?(socket.emit("pause_all"),$(this).removeClass("pause"),$(this).removeClass("glyphicon-pause"),$(this).addClass("glyphicon-play"),$(this).addClass("play"),$(this).attr("data-original-title","Play chat")):(socket.emit("play_all"),$(this).removeClass("play"),$(this).removeClass("glyphicon-play"),$(this).addClass("glyphicon-pause"),$(this).addClass("pause"),$(this).attr("data-original-title","Pause chat"))}),$("#mod_user").click(function(){var e=$("#mssg_cont_"+clicked_on).find(".mssg_op").attr("id");if(e==user_tracker||clicked_on==-1)return!1;$.ajax({type:"GET",url:"//www.mutualcog.com/chat/checkmod",data:{user:e,chat_id:chat_id},success:function(t){t==0?socket.emit("make_mod",{user:e,chat_id:chat_id}):socket.emit("remove_mod",{user:e,chat_id:chat_id})},error:function(){}})}),$("#warn_user").click(function(){var e=$("#mssg_cont_"+clicked_on).find(".mssg_op").attr("id");if(e==user_tracker||clicked_on==-1)return!1;socket.emit("warn",{member:$("#mssg_cont_"+clicked_on).find(".mssg_op").attr("id")})}),$("#kick_user").click(function(){var e=$("#mssg_cont_"+clicked_on).find(".mssg_op").attr("id");if(e==user_tracker||clicked_on==-1)return!1;socket.emit("kick",{member:$("#mssg_cont_"+clicked_on).find(".mssg_op").attr("id")})}),$("#stop_scroll").click(function(){$(this).hasClass("highlight_red")?(stop_scroll=1,$(this).removeClass("highlight_red"),$(this).attr("data-original-title","Stop scrollbar")):(stop_scroll=0,$(this).addClass("highlight_red"),$(this).attr("data-original-title","Resume scrolling"))})}),deleteIt=function(e){e.stopPropagation(),$("#logged_in").text()==1?socket.emit("delete_message",{id:$(this).parents(".chat_mssg").first().attr("id"),user:user_tracker,serial:serial_tracker,responses:$(this).parent().find(".response_count").text()}):socket.emit("delete_message",{id:$(this).parents(".chat_mssg").first().attr("id"),user:serial_tracker,serial:serial_tracker,responses:$(this).parent().find(".response_count").text()})},socket.on("softDelete",function(e){$("#"+e.id+".chat_mssg").length?($(".mssg_icon").tooltip("hide"),$(".mssg_icon").tooltip(),$("#"+e.id+".chat_mssg").html("<b class='mssg_op' id='"+e.user+"' style='color:"+color_arr[e.serial%7]+";'>"+e.user+" (<span class='response_count' id='"+e.id+"'>"+e.responses+"</span>)</b> : <i>This message has been deleted</i>")):($(".resp_icon").tooltip("hide"),$(".resp_icon").tooltip(),$("#"+e.id+".chat_resp").html("<b class='mssg_op' id='"+e.user+"' style='color:"+color_arr[e.serial%7]+";'>"+e.user+" (<span class='response_count' id='"+e.id+"'>"+e.responses+"</span>)</b> : <i>This message has been deleted</i>"))}),getResponse=function(e){e.stopPropagation(),$(this).attr("class")=="chat_mssg"&&(mssg_clicked=$(this).attr("id"));if(clicked_on!=$(this).attr("id")){if(clicked_on!=-1){var t=$("#mssg_cont_"+clicked_on).attr("class").split(" ")[1].replace("level_",""),n=$(this).parent().attr("class").split(" ")[1].replace("level_","");parseInt(n)==0?$("#mssg_cont_"+clicked_on).attr("class").split(" ")[2].replace("parent_","")==$(this).attr("id")?$(".level_"+(parseInt(n)+2)).remove():$(".level_"+(parseInt(n)+1)).remove():$(this).parents(".resp_cont").first().attr("id").replace("resp_cont_","")!=clicked_on&&($("#mssg_cont_"+clicked_on).parents(".level_"+n).first().attr("id")==$(this).parent().attr("id")?$(".level_"+(parseInt(n)+2)).remove():$(".level_"+(parseInt(n)+1)).remove())}clicked_on=$(this).attr("id"),socket.emit("show_responses",$(this).attr("id")),$(".chat_mssg").css("background-color",""),$(".chat_resp").css("background-color",""),$(this).css("background-color","#eee"),$("#message").attr("class",$(this).attr("id")),$("#message").text()!=""?$("#message").text("Press enter to respond to "+$(this).find(".mssg_op").attr("id")+"'s message"):($("#message").val("Press enter to respond to "+$(this).find(".mssg_op").attr("id")+"'s message"),$("#message").on("click",function(){$(this).val(""),$(this).off("click")}))}else $("#mssg_cont_"+clicked_on).children("#resp_cont_"+clicked_on).length?$("#mssg_cont_"+clicked_on).children("#resp_cont_"+clicked_on).remove():(socket.emit("show_responses",$(this).attr("id")),$(".chat_mssg").css("background-color",""),$(".chat_resp").css("background-color",""),$(this).css("background-color","#eee"),$("#message").attr("class",$(this).attr("id")),$("#message").text()!=""?$("#message").text("Press enter to respond to "+$(this).find(".mssg_op").attr("id")+"'s message"):($("#message").val("Press enter to respond to "+$(this).find(".mssg_op").attr("id")+"'s message"),$("#message").on("click",function(){$(this).val(""),$(this).off("click")})))},scroll_mod=function(){stop_scroll=1,window.setTimeout(function(){stop_scroll=0},1e4)},blinkRed=function(e){e.css("background-color")=="rgb(255, 255, 255)"?e.animate({backgroundColor:"#F5A9A9"},"slow"):e.animate({backgroundColor:"#fff"},"slow"),e.data("continue")=="1"&&(e.off("click"),e.on("click",function(t){t.stopPropagation(),$(this).data("continue","0"),$(this).off("click"),$(this).on("click",getResponse),e.trigger("click")})),setTimeout(function(){e.data("continue")=="1"?blinkRed(e):(e.off("click"),e.on("click",getResponse),e.css("background-color","#eee"))},1e3)},blinkRedv2=function(e){e.css("background-color")=="rgb(255, 255, 255)"?e.animate({backgroundColor:"#F5A9A9"},"slow"):e.animate({backgroundColor:"#fff"},"slow"),e.data("continue")=="1"&&(e.off("click"),e.on("click",function(t){t.stopPropagation(),$(this).data("continue","0"),$(this).off("click"),$(this).on("click",getNestedResponse),e.trigger("click")})),setTimeout(function(){e.data("continue")=="1"?blinkRedv2(e):(e.off("click"),e.on("click",getNestedResponse),e.css("background-color","#eee"))},1e3)},notifyMessage=function(){title_blinking=1,setTimeout(function(){focused?($("title").html("Mutual Cognizance"),title_blinking=0):($("title").html()=="Mutual Cognizance (1)"?$("title").html("New Message"):$("title").html("Mutual Cognizance (1)"),notifyMessage())},800)},socket.on("connect",function(){socket.emit("room",$(".chat_id").attr("id")),$("#logged_in").text()==1?socket.emit("add_member",{new_member:user_tracker,user_id:user_id,serial_id:serial_id,serial:serial_tracker,logged_in:1}):socket.emit("add_member",{new_member:serial_tracker,serial_id:serial_id,logged_in:0})}),socket.on("alertUserToResponse",function(e){$("#"+e.resp_id+".chat_resp").length||($("#"+e.mssg_id+".chat_mssg").length?($("#"+e.mssg_id+".chat_mssg").data("continue","1"),blinkRed($("#"+e.mssg_id+".chat_mssg"))):$("#"+e.mssg_id+".chat_resp").length&&($("#"+e.mssg_id+".chat_resp").data("continue","1"),blinkRedv2($("#"+e.mssg_id+".chat_resp"))))}),socket.on("display_details",function(e){$("#curr_details").html(e)}),socket.on("updateResponseCount",function(e){$("#"+e.id+".response_count").animate({color:"#57bf4b"},"slow"),$("#"+e.id+".response_count").animate({color:"black"},"slow"),$("#"+e.id+".response_count").text(e.count)}),socket.on("displayMembers",function(e){mems=new Array,mods=new Array,admin=new Array,$.each(e,function(e,t){t.is_admin?(admin.push(t.user),mems.push("<div style='color:white;'><span class='glyphicon glyphicon-star' style='margin-right:5px;'></span>"+t.user+"</div>")):t.is_mod?(mods.push(t.user),mems.push("<div style='color:white;'><span class='glyphicon glyphicon-tower' style='margin-right:5px;'></span>"+t.user+"</div>")):mems.push("<div style='color:white;'>"+t.user+"</div>")}),$("#members_list").html(mems.join(""))}),socket.on("add_mod_funcs",function(){console.log("hi"),$("#user_toolbox").append('<span class="glyphicon glyphicon-warning-sign mod_power" id="warn_user" data-toggle="tooltip" data-container="body" data-placement="top" data-original-title="Warn user"></span> <span class="glyphicon glyphicon-remove mod_power" id="kick_user" data-toggle="tooltip" data-container="body" data-placement="top" data-original-title="Kick user"></span> ')}),socket.on("remove_mod_funcs",function(){$(".mod_power").remove()}),socket.on("pause",function(e){live=0,$(".chat_paused").remove(),$("#main").append('<div class="chat_paused" id="paused_message">Chat has been paused</div>'),$("#paused_message").show("fade","slow"),socket.emit("pause",{hash:e.hash})}),socket.on("play",function(e){live=1,$("#paused_message").hide("fade","slow",function(){$("#paused_message").remove()}),socket.emit("play",{hash:e.hash})}),socket.on("warn",function(){$(".chat_paused").remove(),$("#main").append('<div class="chat_paused" id="warned_user">You have been warned</div>'),$("#warned_user").show("fade","slow")}),socket.on("kick",function(){banned=1,$(".chat_paused").remove(),$("#main").append('<div class="chat_paused" id="banned_user">You have been banned</div>'),$("#banned_user").show("fade","slow")}),socket.on("check_live",function(e){e=="1"?($("#paused_message").hide("fade","show",function(){$("#paused_message").remove()}),$("#pause_chat").hasClass("pause")||($("#pause_chat").removeClass("play"),$("#pause_chat").removeClass("glyphicon-play"),$("#pause_chat").addClass("glyphicon-pause"),$("#pause_chat").addClass("pause"),$("#pause_chat").attr("data-original-title","Pause chat"))):(e=0,$("#chat_display").append('<div class="chat_paused" id="paused_message">Chat has been paused</div>'),$("#paused_message").show("fade","show"),$("#pause_chat").hasClass("pause")&&($("#pause_chat").removeClass("pause"),$("#pause_chat").removeClass("glyphicon-pause"),$("#pause_chat").addClass("glyphicon-play"),$("#pause_chat").addClass("play"),$("#pause_chat").attr("data-original-title","Play chat"))),$(".mssg_icon").tooltip(),$(".mssg_icon").on("click",deleteIt),$(".chat_mssg").on("click",getResponse),$(".chat_resp").on("click",getResponse),$(".chat_link").click(function(e){e.stopPropagation()})}),socket.on("openChat",function(e){var t=e.rows,n=new Array;if($("#mssg_cont_"+clicked_on).parent(".resp_cont").length){var r=clicked_on;clicked_on=$("#mssg_cont_"+clicked_on).parents(".resp_cont").last().attr("id").replace("resp_cont_","");var i=$("#mssg_cont_"+clicked_on).children("#resp_cont_"+clicked_on)}else var i=$("#mssg_cont_"+clicked_on).children("#resp_cont_"+clicked_on);$.each(t,function(e,t){var r="<div class='mssg_cont level_"+t.level+" parent_"+t.parent+"' id='mssg_cont_"+t.id+"'><div class='chat_mssg' id='"+t.id+"'><span class='vote_box'>";upvoted.indexOf(t.id.toString())!=-1?r+='<span class="glyphicon glyphicon-chevron-up mssg_upvote" id="mssg_upvote_'+t.id+'" style="color:#57bf4b" data-toggle="tooltip" data-original-title="You must be logged in to vote on messages" data-container="body" data-placement="top"></span> <div style="margin-top:-5px;margin-bottom:-5px;text-align:center;" id="mssg_votes_'+t.id+'">'+(t.upvotes-t.downvotes)+'</div> <span class="glyphicon glyphicon-chevron-down mssg_downvote" id="mssg_downvote_'+t.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on messages" data-container="body" data-placement="bottom"></span>':downvoted.indexOf(t.id.toString())!=-1?r+='<span class="glyphicon glyphicon-chevron-up mssg_upvote" id="mssg_upvote_'+t.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on messages" data-container="body" data-placement="top"></span> <div style="margin-top:-5px;margin-bottom:-5px;text-align:center;" id="mssg_votes_'+t.id+'">'+(t.upvotes-t.downvotes)+'</div> <span class="glyphicon glyphicon-chevron-down mssg_downvote" id="mssg_downvote_'+t.id+'" style="color:red;" data-toggle="tooltip" data-original-title="You must be logged in to vote on messages" data-container="body" data-placement="bottom"></span>':r+='<span class="glyphicon glyphicon-chevron-up mssg_upvote" id="mssg_upvote_'+t.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on messages" data-container="body" data-placement="top"></span> <div style="margin-top:-5px;margin-bottom:-5px;text-align:center;" id="mssg_votes_'+t.id+'">'+(t.upvotes-t.downvotes)+'</div> <span class="glyphicon glyphicon-chevron-down mssg_downvote" id="mssg_downvote_'+t.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on messages" data-container="body" data-placement="bottom"></span>',r+="</span><span>",(serial_tracker==t.author||user_tracker==t.author)&&t.message!="<i>This message has been deleted</i>"&&(r+="<span id='"+t.id+"' style='margin-right:4px;' class='glyphicon glyphicon-remove mssg_icon' data-toggle='tooltip' title='Delete post' data-container='body' data-placement='top'></span>"),admin.indexOf(t.author)!=-1?r+="<span class='glyphicon glyphicon-star'></span>":mods.indexOf(t.author)!=-1&&(r+="<span class='glyphicon glyphicon-tower'></span>"),r+="<b class='mssg_op' id='"+t.author+"' style='color:"+color_arr[t.serial%7]+";'> "+t.author+" (<span class='response_count' id='"+t.id+"'>"+t.responses+"</span>)</b> : "+t.message+"</span><div><div class='time' id='"+t.created_at+"'>"+moment.utc(t.created_at).fromNow()+"</div></div></div></div>",n.push(r)}),$("#chat_display").html(n.join("")),$("#mssg_cont_"+clicked_on).append(i),r&&(clicked_on=r),$(".mssg_icon").tooltip(),$(".mssg_icon").on("click",deleteIt),!focused&&!title_blinking&&notifyMessage(),e.clicked!="-1"&&($("#"+e.clicked+".chat_mssg").css("background-color","#eee"),$("#message").attr("class",e.clicked)),$(".mssg_upvote").on("click",upvoteMssg),$(".mssg_downvote").on("click",downvoteMssg),$(".chat_mssg").on("click",getResponse),$(".chat_resp").on("click",getResponse),$(".chat_link").click(function(e){e.stopPropagation()}),stop_scroll||($("#chat_messages").off("scroll",scroll_mod),$("#chat_messages").scrollTop($("#chat_display").height()),window.setTimeout(function(){$("#chat_messages").on("scroll",scroll_mod)},100))}),socket.on("openResponses",function(e){var t=new Array,n=-1;$.each(e,function(e,r){n=r.responseto;var i="<div class='responses_to_"+r.responseto+" level_"+r.level+" parent_"+r.parent+" pad_l_20' id='mssg_cont_"+r.id+"'><div class='chat_resp' id='"+r.id+"'><span class='vote_box'>";upvoted.indexOf(r.id.toString())!=-1?i+='<span class="glyphicon glyphicon-chevron-up mssg_upvote" id="mssg_upvote_'+r.id+'" style="color:#57bf4b" data-toggle="tooltip" data-original-title="You must be logged in to vote on messages" data-container="body" data-placement="top"></span> <div style="margin-top:-5px;margin-bottom:-5px;text-align:center;" id="mssg_votes_'+r.id+'">'+(r.upvotes-r.downvotes)+'</div> <span class="glyphicon glyphicon-chevron-down mssg_downvote" id="mssg_downvote_'+r.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on messages" data-container="body" data-placement="bottom"></span>':downvoted.indexOf(r.id.toString())!=-1?i+='<span class="glyphicon glyphicon-chevron-up mssg_upvote" id="mssg_upvote_'+r.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on messages" data-container="body" data-placement="top"></span> <div style="margin-top:-5px;margin-bottom:-5px;text-align:center;" id="mssg_votes_'+r.id+'">'+(r.upvotes-r.downvotes)+'</div> <span class="glyphicon glyphicon-chevron-down mssg_downvote" id="mssg_downvote_'+r.id+'" style="color:red;" data-toggle="tooltip" data-original-title="You must be logged in to vote on messages" data-container="body" data-placement="bottom"></span>':i+='<span class="glyphicon glyphicon-chevron-up mssg_upvote" id="mssg_upvote_'+r.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on messages" data-container="body" data-placement="top"></span> <div style="margin-top:-5px;margin-bottom:-5px;text-align:center;" id="mssg_votes_'+r.id+'">'+(r.upvotes-r.downvotes)+'</div> <span class="glyphicon glyphicon-chevron-down mssg_downvote" id="mssg_downvote_'+r.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on messages" data-container="body" data-placement="bottom"></span>',i+="</span><span>",(serial_tracker==r.author||user_tracker==r.author)&&r.message!="<i>This message has been deleted</i>"&&(i+="<span id='"+r.id+"' style='margin-right:4px;' class='glyphicon glyphicon-remove resp_icon' data-toggle='tooltip' title='Delete post' data-container='body' data-placement='top'></span>"),admin.indexOf(r.author)!=-1?i+="<span class='glyphicon glyphicon-star'></span>":mods.indexOf(r.author)!=-1&&(i+="<span class='glyphicon glyphicon-tower'></span>"),i+="<b class='mssg_op' id='"+r.author+"' style='color:"+color_arr[r.serial%7]+";'> "+r.author+" (<span class='response_count' id='"+r.id+"'>"+r.responses+"</span>)</b> : "+r.message+"</span><div><div class='time' id='"+r.created_at+"'>"+moment.utc(r.created_at).fromNow()+"</div></div></div></div>",t.push(i)}),$("#mssg_cont_"+n).children("#resp_cont_"+n).remove(),$("#mssg_cont_"+n).append('<div id="resp_cont_'+n+'" class="resp_cont">'+t.join("")+"</div>"),$(".mssg_upvote").on("click",upvoteMssg),$(".mssg_downvote").on("click",downvoteMssg),$(".resp_icon").on("click",deleteIt),$(".resp_icon").tooltip(),$(".chat_resp").off("click"),$(".chat_resp").on("click",getResponse),$(".chat_link").click(function(e){e.stopPropagation()}),!focused&&!title_blinking&&notifyMessage(),stop_scroll||($("#chat_responses").off("scroll",scroll_mod),$("#chat_responses").scrollTop($("#response_display").height()),window.setTimeout(function(){$("#chat_responses").on("scroll",scroll_mod)},100))}),socket.on("disconnect",function(){console.log("The client has disconnected!")}),$("#message").click(function(){$(this).text("")});var keys=new Array;$("#message").keydown(function(e){keys.push(e.which)}),$("#message").keyup(function(e){if(live&&banned==0){if(e.which==13){if(keys.indexOf(16)!=-1)return keys.splice(keys.indexOf(e.which),1),!0;keys.splice(keys.indexOf(e.which),1);if($("#message").val().trim()!=""){if($("#message").attr("class")=="global")sendMessageToServer({message:$("#message").val()});else{var t=$("#message").attr("class"),n=parseInt($("#mssg_cont_"+t).attr("class").split(" ")[1].replace("level_",""))+1;console.log(n);if($("#mssg_cont_"+t).attr("class").split(" ")[2].replace("parent_","")==-1)var r=t;else var r=$("#mssg_cont_"+t).parents(".mssg_cont").last().attr("id").replace("mssg_cont_","");sendResponseToServer({message:$("#message").val(),responseto:t,level:n,parent:r},clicked_on)}$("#message").val("")}}else keys.splice(keys.indexOf(e.which),1);return!0}keys.splice(keys.indexOf(e.which),1)})