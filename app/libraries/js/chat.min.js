var curr_request;var focused=1;var title_blinking=0;var clicked_on=-1;var mssg_clicked=-1;var live=1;var banned=0;var chat_id=$(".chat_id").attr("id");var socket=io.connect("http://localhost:3000/");var stop_scroll=0;var color_arr=new Array("#228d49","#f52103","#2532f2","#f94f06","#5a24d9","#f8b92d","#38cedb","#000");var mems=new Array();var mods=new Array();var admin=new Array();var serial_id=$("#serial_id").text();var serial_tracker=$("#serial_tracker").text();var user_id=$("#user_id").text();var user_tracker=$("#user_tracker").text();$("#login_form").submit(function(){var d=1;var e=$("#username").val();var c=$("#pass").val();var a=$("#pass2").val();$(".form-group").attr("class","form-group");if(e.length<3||e.length>20){$("#user_group").attr("class","form-group has-error");$("#username").attr("data-original-title","Username must be longer than 2 characters but less than 15");$("#username").tooltip("show");d=0}else{if(a!=""){var b=$.ajax({type:"GET",data:{username:e},url:"//mutualcog.com/profile/checkuser",async:false,}).responseText;console.log(e);console.log(b);if(b==1){var b=$.ajax({type:"GET",data:{username:e},url:"//mutualcog.com/profile/checkalpha",async:false,}).responseText;if(b==1){}else{$("#user_group").attr("class","form-group has-error");$("#username").attr("data-original-title","Your username must contain at least one character");$("#username").tooltip("show");d=0}}else{$("#user_group").attr("class","form-group has-error");$("#username").attr("data-original-title","That username already exists");$("#username").tooltip("show");d=0}}else{var b=$.ajax({type:"GET",data:{username:e,pass:c},url:"//mutualcog.com/profile/checkcredentials",async:false,}).responseText;if(b==1){}else{$("#user_group").attr("class","form-group has-error");$("#pass1_group").attr("class","form-group has-error");$("#username").attr("data-original-title","Your username or password is incorrect");$("#username").tooltip("show");d=0}}}if(c.length<6||c.length>30){$("#pass1_group").attr("class","form-group has-error");$("#pass2_group").attr("class","form-group has-error");$("#pass").tooltip("show");d=0}if(c!=a&&a!=""){$("#pass1_group").attr("class","form-group has-error");$("#pass2_group").attr("class","form-group has-error");$("#pass2").tooltip("show");d=0}if(d){return true}else{return false}});$("#tag_dropdown").on("click",function(a){a.stopPropagation()});$("#search_input").on("focus",function(a){a.stopPropagation();if($("#search_input").val()==""){$("#tag_dropdown").html("")}$(this).dropdown();$("#tag_dropdown").show()});$(window).on("click",function(a){$("#tag_dropdown").hide();$("#members_box").hide("blind");$("#show_members").removeClass("highlighted_dark")});var selected_term=-1;$("#search_input").on("keydown",function(a){if(a.keyCode==13){if(selected_term==-1){}else{location.assign($("li#search_"+selected_term).children("a").attr("href"))}return false}else{if(a.keyCode==38){if(selected_term!=0){selected_term--;$(".tag_results").css("background-color","");$("li#search_"+selected_term).css("background-color","#f5f5f5")}return false}else{if(a.keyCode==40){if(selected_term!=$("#tag_dropdown").length){selected_term++;$(".tag_results").css("background-color","");$("li#search_"+selected_term).css("background-color","#f5f5f5")}return false}}}});$("#search_input").on("keyup",function(b){var a=$(this).val();if(b.keyCode==13){return false}else{if(b.keyCode==38||b.keyCode==40){}else{if(a.length>2){$.ajax({type:"GET",data:{tag:a},url:"//mutualcog.com/tags/similar-tag",success:function(d){var c="";$.each(d,function(e,f){c+='<li id="search_'+e+'" class="tag_results"><a href="//mutualcog.com/tags/tag/'+f.name+'">'+f.name+"</a></li>"});if(c){$("#tag_dropdown").show();if($("#tag_dropdown").html()!=c){$("#tag_dropdown").html(c);selected_term=-1}}else{$("#tag_dropdown").hide();selected_term=-1}},error:function(){}})}else{$("#tag_dropdown").html("")}}}});$(window).on("blur",function(){focused=0});$(window).on("focus",function(){focused=1});updateChatTimes=function(){$.each($(".chat_time"),function(a,b){$(this).text(moment.utc($(this).attr("id")).fromNow())})};updateTimes=function(){$.each($(".time"),function(a,b){$(this).text(moment.utc($(this).attr("id")).fromNow())})};$(document).ready(function(){updateChatTimes();updateTimes();setInterval(updateTimes,60000);setInterval(updateChatTimes,60000);$("#chat_messages").click(function(){$("#message").attr("class","global");$(".chat_mssg").css("background-color","");$(".chat_resp").css("background-color","");$("#mssg_cont_"+mssg_clicked).children("#resp_cont_"+mssg_clicked).remove();clicked_on=-1;socket.emit("leave_last_room");if($("#message").text()!=""){$("#message").text("Press enter to send a message to all")}else{$("#message").val("Press enter to send a message to all");$("#message").on("click",function(){$(this).val("");$(this).off("click")})}});$("a#continue_description").click(function(c){c.stopPropagation();$("#continue_modal").modal()});$("button#save_details").click(function(){$("#description_modal").modal("hide");$.ajax({type:"POST",data:{details:$("#detail_text").val(),id:$(".chat_id").attr("id")},url:"//mutualcog.com/chat/details",success:function(c){$("#curr_details").html(c);$("#curr_details").show()},error:function(){}})});var a=0;var b=0;if($("#curr_details").hasClass("edit_details")){$("#curr_details").tooltip();$("#curr_details").click(function(){$("#description_modal").modal();return false})}$("#show_members").tooltip();$("#stop_scroll").tooltip();$("#pause_chat").tooltip();$("#mod_user").tooltip();$("#warn_user").tooltip();$("#kick_user").tooltip();$("#show_members").click(function(c){if(b==0){$("#members_box").toggle("blind")}if($(this).hasClass("highlighted_dark")){a=0;$(this).attr("data-original-title","Show chat members");$(this).removeClass("highlighted_dark")}else{a=1;$(this).attr("data-original-title","Hide chat members");$(this).addClass("highlighted_dark")}return false});$("#show_members").hover(function(){if(a==0){$("#members_box").show("blind");b=1}},function(){if(a==0){$("#members_box").hide("blind");b=0}});$("#pause_chat").click(function(){if($(this).hasClass("pause")){socket.emit("pause_all");$(this).removeClass("pause");$(this).removeClass("glyphicon-pause");$(this).addClass("glyphicon-play");$(this).addClass("play");$(this).attr("data-original-title","Play chat")}else{socket.emit("play_all");$(this).removeClass("play");$(this).removeClass("glyphicon-play");$(this).addClass("glyphicon-pause");$(this).addClass("pause");$(this).attr("data-original-title","Pause chat")}});$("#mod_user").click(function(){var c=$("#mssg_cont_"+clicked_on).find(".mssg_op").attr("id");if(c==user_tracker||clicked_on==-1){return false}else{$.ajax({type:"GET",url:"//mutualcog.com/chat/checkmod",data:{user:c,chat_id:chat_id},success:function(d){if(d==0){socket.emit("make_mod",{user:c,chat_id:chat_id})}else{socket.emit("remove_mod",{user:c,chat_id:chat_id})}},error:function(){}})}});$("#warn_user").click(function(){var c=$("#mssg_cont_"+clicked_on).find(".mssg_op").attr("id");if(c==user_tracker||clicked_on==-1){return false}else{socket.emit("warn",{member:$("#mssg_cont_"+clicked_on).find(".mssg_op").attr("id")})}});$("#kick_user").click(function(){var c=$("#mssg_cont_"+clicked_on).find(".mssg_op").attr("id");if(c==user_tracker||clicked_on==-1){return false}else{socket.emit("kick",{member:$("#mssg_cont_"+clicked_on).find(".mssg_op").attr("id")})}});$("#stop_scroll").click(function(){if($(this).hasClass("highlight_red")){stop_scroll=1;$(this).removeClass("highlight_red");$(this).attr("data-original-title","Stop scrollbar")}else{stop_scroll=0;$(this).addClass("highlight_red");$(this).attr("data-original-title","Resume scrolling")}})});deleteIt=function(a){a.stopPropagation();if($("#logged_in").text()==1){socket.emit("delete_message",{id:user_id,user:user_tracker,serial:serial_tracker,responses:$(this).parent().children(".mssg_op").children(".response_count").text()})}else{socket.emit("delete_message",{id:serial_id,user:serial_tracker,serial:serial_tracker,responses:$(this).parent().children(".mssg_op").children(".response_count").text()})}};socket.on("softDelete",function(a){if($("#"+a.id+".chat_mssg").length){$(".mssg_icon").tooltip("hide");$(".mssg_icon").tooltip();$("#"+a.id+".chat_mssg").html("<b class='mssg_op' id='"+a.user+"' style='color:"+color_arr[a.serial%7]+";'>"+a.user+" (<span class='response_count' id='"+a.id+"'>"+a.responses+"</span>)</b> : <i>This message has been deleted</i>")}else{$(".resp_icon").tooltip("hide");$(".resp_icon").tooltip();$("#"+a.id+".chat_resp").html("<b class='mssg_op' id='"+a.user+"' style='color:"+color_arr[a.serial%7]+";'>"+a.user+" (<span class='response_count' id='"+a.id+"'>"+a.responses+"</span>)</b> : <i>This message has been deleted</i>")}});getResponse=function(c){c.stopPropagation();if($(this).attr("class")=="chat_mssg"){mssg_clicked=$(this).attr("id")}if(clicked_on!=$(this).attr("id")){if(clicked_on!=-1){var a=$("#mssg_cont_"+clicked_on).attr("class").split(" ")[1].replace("level_","");var b=$(this).parent().attr("class").split(" ")[1].replace("level_","");if(parseInt(b)==0){if($("#mssg_cont_"+clicked_on).attr("class").split(" ")[2].replace("parent_","")==$(this).attr("id")){$(".level_"+(parseInt(b)+2)).remove()}else{$(".level_"+(parseInt(b)+1)).remove()}}else{if($(this).parents(".resp_cont").first().attr("id").replace("resp_cont_","")!=clicked_on){if($("#mssg_cont_"+clicked_on).parents(".level_"+b).first().attr("id")==$(this).parent().attr("id")){$(".level_"+(parseInt(b)+2)).remove()}else{$(".level_"+(parseInt(b)+1)).remove()}}}}clicked_on=$(this).attr("id");socket.emit("show_responses",$(this).attr("id"));$(".chat_mssg").css("background-color","");$(".chat_resp").css("background-color","");$(this).css("background-color","#eee");$("#message").attr("class",$(this).attr("id"));if($("#message").text()!=""){$("#message").text("Press enter to respond to "+$(this).children().eq(0).children(".mssg_op").attr("id")+"'s message")}else{$("#message").val("Press enter to respond to "+$(this).children().eq(0).children(".mssg_op").attr("id")+"'s message");$("#message").on("click",function(){$(this).val("");$(this).off("click")})}}else{if($("#mssg_cont_"+clicked_on).children("#resp_cont_"+clicked_on).length){$("#mssg_cont_"+clicked_on).children("#resp_cont_"+clicked_on).remove()}else{socket.emit("show_responses",$(this).attr("id"));$(".chat_mssg").css("background-color","");$(".chat_resp").css("background-color","");$(this).css("background-color","#eee");$("#message").attr("class",$(this).attr("id"));if($("#message").text()!=""){$("#message").text("Press enter to respond to "+$(this).children().eq(0).children(".mssg_op").attr("id")+"'s message")}else{$("#message").val("Press enter to respond to "+$(this).children().eq(0).children(".mssg_op").attr("id")+"'s message");$("#message").on("click",function(){$(this).val("");$(this).off("click")})}}}};scroll_mod=function(){stop_scroll=1;window.setTimeout(function(){stop_scroll=0},10000)};blinkRed=function(a){if(a.css("background-color")=="rgb(255, 255, 255)"){a.animate({backgroundColor:"#F5A9A9"},"slow")}else{a.animate({backgroundColor:"#fff"},"slow")}if(a.data("continue")=="1"){a.off("click");a.on("click",function(b){b.stopPropagation();$(this).data("continue","0");$(this).off("click");$(this).on("click",getResponse);a.trigger("click")})}setTimeout(function(){if(a.data("continue")=="1"){blinkRed(a)}else{a.off("click");a.on("click",getResponse);a.css("background-color","#eee")}},1000)};blinkRedv2=function(a){if(a.css("background-color")=="rgb(255, 255, 255)"){a.animate({backgroundColor:"#F5A9A9"},"slow")}else{a.animate({backgroundColor:"#fff"},"slow")}if(a.data("continue")=="1"){a.off("click");a.on("click",function(b){b.stopPropagation();$(this).data("continue","0");$(this).off("click");$(this).on("click",getNestedResponse);a.trigger("click")})}setTimeout(function(){if(a.data("continue")=="1"){blinkRedv2(a)}else{a.off("click");a.on("click",getNestedResponse);a.css("background-color","#eee")}},1000)};notifyMessage=function(){title_blinking=1;setTimeout(function(){if(focused){$("title").html("Mutual Cognizance");title_blinking=0}else{if($("title").html()=="Mutual Cognizance (1)"){$("title").html("New Message")}else{$("title").html("Mutual Cognizance (1)")}notifyMessage()}},800)};socket.on("connect",function(){socket.emit("room",$(".chat_id").attr("id"));if($("#logged_in").text()==1){socket.emit("add_member",{new_member:user_tracker,user_id:user_id,serial_id:serial_id,serial:serial_tracker,logged_in:1})}else{socket.emit("add_member",{new_member:serial_tracker,serial_id:serial_id,logged_in:0})}});socket.on("alertUserToResponse",function(a){if(!$("#"+a.resp_id+".chat_resp").length){if($("#"+a.mssg_id+".chat_mssg").length){$("#"+a.mssg_id+".chat_mssg").data("continue","1");blinkRed($("#"+a.mssg_id+".chat_mssg"))}else{if($("#"+a.mssg_id+".chat_resp").length){$("#"+a.mssg_id+".chat_resp").data("continue","1");blinkRedv2($("#"+a.mssg_id+".chat_resp"))}}}});socket.on("updateResponseCount",function(a){$("#"+a.id+".response_count").animate({color:"#57bf4b"},"slow");$("#"+a.id+".response_count").animate({color:"black"},"slow");$("#"+a.id+".response_count").text(a.count)});socket.on("displayMembers",function(a){mems=new Array();mods=new Array();admin=new Array();$.each(a,function(b,c){if(c.is_admin){admin.push(c.user);mems.push("<div style='color:white;'><span class='glyphicon glyphicon-star' style='margin-right:5px;'></span>"+c.user+"</div>")}else{if(c.is_mod){mods.push(c.user);mems.push("<div style='color:white;'><span class='glyphicon glyphicon-tower' style='margin-right:5px;'></span>"+c.user+"</div>")}else{mems.push("<div style='color:white;'>"+c.user+"</div>")}}});$("#members_list").html(mems.join(""))});socket.on("add_mod_funcs",function(){console.log("hi");$("#user_toolbox").append(' <span class="glyphicon glyphicon-pause pause mod_power" id="pause_chat" data-toggle="tooltip" data-container="body" data-placement="top" data-original-title="Pause chat"></span> <span class="glyphicon glyphicon-tower mod_power" id="mod_user" data-toggle="tooltip" data-container="body" data-placement="top" data-original-title="Grant holy moderation powers"></span> <span class="glyphicon glyphicon-warning-sign mod_power" id="warn_user" data-toggle="tooltip" data-container="body" data-placement="top" data-original-title="Warn user"></span> <span class="glyphicon glyphicon-remove mod_power" id="kick_user" data-toggle="tooltip" data-container="body" data-placement="top" data-original-title="Kick user"></span> ')});socket.on("remove_mod_funcs",function(){$(".mod_power").remove()});socket.on("pause",function(a){live=0;$(".chat_paused").remove();$("#main").append('<div class="chat_paused" id="paused_message">Chat has been paused</div>');$("#paused_message").show("fade","slow");socket.emit("pause",{hash:a.hash})});socket.on("play",function(a){live=1;$("#paused_message").hide("fade","slow",function(){$("#paused_message").remove()});socket.emit("play",{hash:a.hash})});socket.on("warn",function(){$(".chat_paused").remove();$("#main").append('<div class="chat_paused" id="warned_user">You have been warned</div>');$("#warned_user").show("fade","slow")});socket.on("kick",function(){banned=1;$(".chat_paused").remove();$("#main").append('<div class="chat_paused" id="banned_user">You have been banned</div>');$("#banned_user").show("fade","slow")});socket.on("check_live",function(a){if(a=="1"){$("#paused_message").hide("fade","show",function(){$("#paused_message").remove()});if(!$("#pause_chat").hasClass("pause")){$("#pause_chat").removeClass("play");$("#pause_chat").removeClass("glyphicon-play");$("#pause_chat").addClass("glyphicon-pause");$("#pause_chat").addClass("pause");$("#pause_chat").attr("data-original-title","Pause chat")}}else{a=0;$("#chat_display").append('<div class="chat_paused" id="paused_message">Chat has been paused</div>');$("#paused_message").show("fade","show");if($("#pause_chat").hasClass("pause")){$("#pause_chat").removeClass("pause");$("#pause_chat").removeClass("glyphicon-pause");$("#pause_chat").addClass("glyphicon-play");$("#pause_chat").addClass("play");$("#pause_chat").attr("data-original-title","Play chat")}}$(".mssg_icon").tooltip();$(".mssg_icon").on("click",deleteIt);$(".chat_mssg").on("click",getResponse);$(".chat_resp").on("click",getResponse);$(".chat_link").click(function(b){b.stopPropagation()});if(!stop_scroll){$("#chat_messages").off("scroll",scroll_mod);$("#chat_messages").scrollTop($("#chat_display").height());window.setTimeout(function(){$("#chat_messages").on("scroll",scroll_mod)},100)}});socket.on("openChat",function(b){var c=b.rows;var d=new Array();if($("#mssg_cont_"+clicked_on).parent(".resp_cont").length){var a=clicked_on;clicked_on=$("#mssg_cont_"+clicked_on).parents(".resp_cont").last().attr("id").replace("resp_cont_","");var e=$("#mssg_cont_"+clicked_on).children("#resp_cont_"+clicked_on)}else{var e=$("#mssg_cont_"+clicked_on).children("#resp_cont_"+clicked_on)}$.each(c,function(f,h){var g="<div class='mssg_cont level_"+h.level+" parent_"+h.parent+"' id='mssg_cont_"+h.id+"'><div class='chat_mssg' id='"+h.id+"'><div>";if((serial_tracker==h.author||user_tracker==h.author)&&h.message!="<i>This message has been deleted</i>"){g+="<span id='"+h.id+"' style='margin-right:4px;' class='glyphicon glyphicon-remove mssg_icon' data-toggle='tooltip' title='Delete post' data-container='body' data-placement='top'></span>"}if(admin.indexOf(h.author)!=-1){g+="<span class='glyphicon glyphicon-star'></span>"}else{if(mods.indexOf(h.author)!=-1){g+="<span class='glyphicon glyphicon-tower'></span>"}}g+="<b class='mssg_op' id='"+h.author+"' style='color:"+color_arr[h.serial%7]+";'> "+h.author+" (<span class='response_count' id='"+h.id+"'>"+h.responses+"</span>)</b> : "+h.message+"</div><div class='time' id='"+h.created_at+"'>"+moment.utc(h.created_at).fromNow()+"</div></div></div>";d.push(g)});$("#chat_display").html(d.join(""));$("#mssg_cont_"+clicked_on).append(e);if(a){clicked_on=a}$(".mssg_icon").tooltip();$(".mssg_icon").on("click",deleteIt);if(!focused&&!title_blinking){notifyMessage()}if(b.clicked!="-1"){$("#"+b.clicked+".chat_mssg").css("background-color","#eee");$("#message").attr("class",b.clicked)}$(".chat_mssg").on("click",getResponse);$(".chat_resp").on("click",getResponse);$(".chat_link").click(function(f){f.stopPropagation()});if(!stop_scroll){$("#chat_messages").off("scroll",scroll_mod);$("#chat_messages").scrollTop($("#chat_display").height());window.setTimeout(function(){$("#chat_messages").on("scroll",scroll_mod)},100)}});socket.on("openResponses",function(b){var a=new Array();var c=-1;$.each(b,function(d,f){c=f.responseto;var e="<div class='responses_to_"+f.responseto+" level_"+f.level+" parent_"+f.parent+" pad_l_20' id='mssg_cont_"+f.id+"'><div class='chat_resp' id='"+f.id+"'><div>";if((serial_tracker==f.author||user_tracker==f.author)&&f.message!="<i>This message has been deleted</i>"){e+="<span id='"+f.id+"' style='margin-right:4px;' class='glyphicon glyphicon-remove resp_icon' data-toggle='tooltip' title='Delete post' data-container='body' data-placement='top'></span>"}if(admin.indexOf(f.author)!=-1){e+="<span class='glyphicon glyphicon-star'></span>"}else{if(mods.indexOf(f.author)!=-1){e+="<span class='glyphicon glyphicon-tower'></span>"}}e+="<b class='mssg_op' id='"+f.author+"' style='color:"+color_arr[f.serial%7]+";'> "+f.author+" (<span class='response_count' id='"+f.id+"'>"+f.responses+"</span>)</b> : "+f.message+"</div><div class='time' id='"+f.created_at+"'>"+moment.utc(f.created_at).fromNow()+"</div></div></div>";a.push(e)});$("#mssg_cont_"+c).children("#resp_cont_"+c).remove();$("#mssg_cont_"+c).append('<div id="resp_cont_'+c+'" class="resp_cont">'+a.join("")+"</div>");$(".resp_icon").on("click",deleteIt);$(".resp_icon").tooltip();$(".chat_resp").off("click");$(".chat_resp").on("click",getResponse);$(".chat_link").click(function(d){d.stopPropagation()});if(!focused&&!title_blinking){notifyMessage()}if(!stop_scroll){$("#chat_responses").off("scroll",scroll_mod);$("#chat_responses").scrollTop($("#response_display").height());window.setTimeout(function(){$("#chat_responses").on("scroll",scroll_mod)},100)}});socket.on("disconnect",function(){console.log("The client has disconnected!")});function sendMessageToServer(a){socket.emit("message_sent",a);if($("#logged_in").text()==1){$("#chat_display").append("<div id='mssg_cont'><div class='chat_mssg'><div><span class='glyphicon glyphicon-remove mssg_icon'></span><b class='mssg_op' id='"+user_tracker+"' style='color:"+color_arr[serial_tracker%7]+";'> "+user_tracker+"(<span class='response_count'>0</span>)</b> : "+a.message+"</div><div class='time'>a few seconds ago</div></div></div>")}else{$("#chat_display").append("<div id='mssg_cont'><div class='chat_mssg'><div><span class='glyphicon glyphicon-remove mssg_icon'></span><b class='mssg_op' id='"+serial_tracker+"' style='color:"+color_arr[serial_tracker%7]+";'> "+serial_tracker+"(<span class='response_count'>0</span>)</b> : "+a.message+"</div><div class='time'>a few seconds ago</div></div></div>")}}function sendResponseToServer(a,b){socket.emit("response_sent",a);if($("#logged_in").text()==1){$("#resp_cont_"+b).append("<div class='responses_to_"+b+" pad_l_20'><div class='chat_resp'><div><span class='glyphicon glyphicon-remove mssg_icon'></span><b class='mssg_op' id='"+user_tracker+"' style='color:"+color_arr[serial_tracker%7]+";'> "+user_tracker+"(<span class='response_count'>0</span>)</b> : "+a.message+"</div><div class='time'>a few seconds ago</div></div></div>")}else{$("#resp_cont_"+b).append("<div class='responses_to_"+b+" pad_l_20'><div class='chat_resp'><div><span class='glyphicon glyphicon-remove mssg_icon'></span><b class='mssg_op' id='"+serial_tracker+"' style='color:"+color_arr[serial_tracker%7]+";'> "+serial_tracker+"(<span class='response_count'>0</span>)</b> : "+a.message+"</div><div class='time'>a few seconds ago</div></div></div>")}}$("#message").click(function(){$(this).text("")});$("#message").keypress(function(a){if(live&&banned==0){if(a.which==13){if($("#message").val()!=""){if($("#message").attr("class")=="global"){sendMessageToServer({message:$("#message").val()})}else{var d=$("#message").attr("class");var c=parseInt($("#mssg_cont_"+d).attr("class").split(" ")[1].replace("level_",""))+1;console.log(c);if($("#mssg_cont_"+d).attr("class").split(" ")[2].replace("parent_","")==-1){var b=d}else{var b=$("#mssg_cont_"+d).parents(".mssg_cont").last().attr("id").replace("mssg_cont_","")}sendResponseToServer({message:$("#message").val(),responseto:d,level:c,parent:b},clicked_on)}$("#message").val("")}return false}return true}});