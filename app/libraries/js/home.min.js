function hashHtml(e){return e.replace(/#/,"&#035;")}function emoji(e){var t=["\\&lt\\;3",":\\)",":\\(",":D",":\\&\\#39\\;\\(","spec_face_angr","spec_face_rage",":\\|",":O",":P","T_T"],n={"&lt;3":'<img style="height:18px;" src="//localhost/laravel/app/emoji/heart.png"></img>',":D":'<img style="height:18px;" src="//localhost/laravel/app/emoji/smile.png"></img>',":)":'<img style="height:18px;" src="//localhost/laravel/app/emoji/smiley.png"></img>',":(":'<img style="height:18px;" src="//localhost/laravel/app/emoji/disappointed.png"></img>',":|":'<img style="height:18px;" src="//localhost/laravel/app/emoji/neutral_face.png"></img>',":&#39;(":'<img style="height:18px;" src="//localhost/laravel/app/emoji/cry.png"></img>',":O":'<img style="height:18px;" src="//localhost/laravel/app/emoji/open_mouth.png"></img>',":P":'<img style="height:18px;" src="//localhost/laravel/app/emoji/stuck_out_tongue_closed_eyes.png"></img>',T_T:'<img style="height:18px;" src="//localhost/laravel/app/emoji/sob.png"></img>',spec_face_angr:'<img style="height:18px;" src="//localhost/laravel/app/emoji/angry.png"></img>',spec_face_rage:'<img style="height:18px;" src="//localhost/laravel/app/emoji/rage.png"></img>'},r=new RegExp(t.join("|"),"gi");return e=e.replace(r,function(e){return n[e]}),e}function processMessage(e){var t=/(\b)(https?:\/\/)?([\da-z-]+)\.([a-z]{2,6})([\/\w\.-]*)*\/?/g,n=/(img)(\s)(src\=)/g,r=/\/c\/([^\s]*)(\s*)/g,i=/\/u\/([^\s]*)(\s*)/g,s=/\@([^\s]*)(\s*)/g,o=/\&\#035\;([^\s]*)(\s*)/g,u=new RegExp("^<p>","g"),a=new RegExp("</p>$","g");return e=hashHtml(e),e=e.replace(">:|","spec_face_angr"),e=e.replace(">:(","spec_face_rage"),e=marked(e),e=e.replace(t,"$1<a class='chat_link' href='//$3.$4$5'>$3.$4$5</a>"),e.length&&(e=e.replace(/^\s+|\s+$/g,""),e=e.replace(u,""),e=e.replace(a,""),e=e.replace(i,"<a class='chat_link' href='//mutualcog.com/u/$1'>/p/$1</a>$2"),e=e.replace(r,"<a class='chat_link' href='//mutualcog.com/c/$1'>/c/$1</a>$2"),e=e.replace(s,"<a class='chat_link' href='//mutualcog.com/u/$1'>@$1</a>$2"),e=e.replace(o,"<a class='chat_link' href='//mutualcog.com/c/$1'>#$1</a>$2"),e=e.replace(n,"$1$2style='max-width:300px;max-height:200px;margin-bottom:5px;' $3")),e=emoji(e),e}function randomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}function newPmChat(e,t,n,r){if(t==0)var i='<div class="pm_cont pm_visible" id="pm_'+r+'_0" style="visibility:hidden;">';else var i='<div class="pm_cont pm_visible" id="pm_'+e+"_"+t+'" style="visibility:hidden;">';return i+='<div class="pm_header"><div class="'+n+' pm_status"></div><div class="glyphicon glyphicon-remove pm_remove"></div><a class="pm_name" href="//mutualcog.com/u/'+r+'">'+r+"</a></div>",i+='<div class="pm_body"><div class="pm_body_mssgs">',i+='</div><div class="pm_body_alerts"> <div class="pm_mssg_alert pm_unseen" style="display:none;">Not seen</div> <div class="pm_mssg_alert pm_typing" style="display:none;">'+r+" is typing...</div> </div></div>",i+='<textarea rows=1 class="pm_text"></textarea>',i+="</div>",i}function validateLogin(e,t){var n=$.ajax({type:"GET",data:{username:e,pass:t},url:"//mutualcog.com/profile/validate-login",async:!1}).responseText;return n==1?($("#user_group").attr("class","form-group"),$("#pass1_group").attr("class","form-group"),$("#username").tooltip("destroy"),1):($("#user_group").attr("class","form-group has-error"),$("#pass1_group").attr("class","form-group has-error"),$("#username").attr("data-original-title","Your username or password is incorrect"),$("#username").tooltip("show"),0)}function validateUser(e){if(e.length<3||e.length>module.max_user_length)return $("#reg_user_group").attr("class","form-group has-error"),$("#reg_username").attr("data-original-title","Username must be between 3 and "+module.max_user_length+" characters"),$("#reg_username").tooltip("show"),0;var t=$.ajax({type:"GET",data:{username:e},url:"//mutualcog.com/profile/validate-username",async:!1}).responseText;return t==2?($("#reg_user_group").attr("class","form-group has-error"),$("#reg_username").attr("data-original-title","That username already exists"),$("#reg_username").tooltip("show"),0):t==3?($("#reg_user_group").attr("class","form-group has-error"),$("#reg_username").attr("data-original-title","Your username must contain at least one character"),$("#reg_username").tooltip("show"),0):($("#reg_user_group").attr("class","form-group"),$("#reg_username").tooltip("destroy"),1)}function validatePasswords(e,t){return e!=t&&t!=""?($("#reg_pass1_group").attr("class","form-group has-error"),$("#pass2_group").attr("class","form-group has-error"),$("#pass2").tooltip("show"),0):(e.length<6||e.length>30)&&t!=""?($("#reg_pass1_group").attr("class","form-group has-error"),$("#pass2_group").attr("class","form-group has-error"),$("#pass").tooltip("show"),0):($("#reg_pass1_group").attr("class","form-group"),$("#pass2_group").attr("class","form-group"),$("#pass2").tooltip("destroy"),$("#reg_pass").tooltip("destroy"),1)}function validateEmail(e){var t=$.ajax({type:"GET",data:{email:e},url:"//mutualcog.com/profile/validate-email",async:!1}).responseText;return t==0?($("#email_group").attr("class","form-group has-error"),$("#email").tooltip("show"),0):($("#email_group").attr("class","form-group"),$("#email").tooltip("destroy"),1)}function cookiesEnabled(){var e=navigator.cookieEnabled;if(e===!1)return!1;if(!document.cookie&&(e===null||!1)){document.cookie="testcookie=1";if(!document.cookie)return!1;document.cookie="testcookie=; expires="+(new Date(0)).toUTCString()}return!0}function validateCommunity(e){var t=$.ajax({type:"GET",data:{community:e},url:"//mutualcog.com/community/validate-name",async:!1}).responseText;return t==1?1:0}module=function(){var e=live=scroll_mod_active=1,t="",n=new Array,r={},i=chat_scroll_timer=typ_cnt=connected=recent=banned=stop_scroll=scroll_button_clicked=scroll_top=0,s=-1;if($(".chat_id").length)var o=$(".chat_id").attr("id").replace("chat_","");else var o="";if($("#up_arr").length)var u=jQuery.parseJSON($("#up_arr").text()),a=jQuery.parseJSON($("#down_arr").text());if(typeof io!="undefined")var f=io.connect("http://localhost:3000/",{query:"sid="+$("#sid").attr("data-sid")+"&serial="+$("#serial_tracker").text()});else var f=$("body");var l=new Array("#228d49","#f52103","#2532f2","#f94f06","#5a24d9","#f8b92d","#38cedb","#050a57"),c=new Array,h=new Array,p=new Array,d=new Array,v=new Array,m=new Array,g=new Array,y=$("#serial_id").text(),b=$("#serial_tracker").text(),w=$("#user_id").text(),E=$("#user_tracker").text(),S=20,x=300,T=1e4,N=2500,C=100,k=1e4,L=new Array("Use 'who like' to find users with certain interests","Use 'about' to find posts about a certain topic","Type 'here' to search current community","Use 'in' to search communities","Press enter for more results","Search for your interests or specific content");return{search_messages:L,crit_len:n,chat_scroll_timer:chat_scroll_timer,max_title_length:x,max_user_length:S,max_static_length:T,max_chat_mssg_length:N,max_description_length:C,max_info_length:k,pm_scroll_inactive:r,connected:connected,recent:recent,typ_cnt:typ_cnt,pm_info:t,focused:e,live:live,title_blinking:i,banned:banned,stop_scroll:stop_scroll,scroll_mod_active:scroll_mod_active,scroll_button_clicked:scroll_button_clicked,scroll_top:scroll_top,clicked_on:s,chat_id:o,upvoted:u,downvoted:a,socket:f,color_arr:l,mems:c,mods:h,admin:p,notifications_top_positions:d,notifications_bottom_positions:v,notifications_top_ids:m,notifications_bottom_ids:g,serial_id:y,serial_tracker:b,user_id:w,user_tracker:E}}(),marked.setOptions({sanitize:!0,breaks:!0,highlight:function(e){return require("highlight.js").highlightAuto(e).value}}),updateChatTimes=function(){$.each($(".chat_time"),function(e,t){$(this).text(moment.utc($(this).attr("id")).fromNow())}),$(".last_login").length&&$(".last_login").html("<strong>Last login: </strong>"+moment.utc($(".last_login").attr("id")).fromNow())}(),updateTimes=function(){$.each($(".time"),function(e,t){$(this).text(moment.utc($(this).attr("id")).fromNow())})}(),$(window).resize(function(){$(window).width()<768?($(".nav_pad_r").css("padding-right",""),$(".community_search").css("display",""),$("#search_input").css("width","")):$(".community_search").css("display")!="none"&&($(".community_input").width($("#welcome_user").width()-34),$("#logged_in").text()==1?$(".nav_pad_r").css("padding-right",$(".community_search_cont").width()+118):$(".nav_pad_r").css("padding-right",$(".community_search_cont").width())),$(".pm_bar").width()>$(window).width()-30?(module.crit_len.push($(window).width()+30),$.each($(".pm_cont"),function(e,t){if($(".pm_cont").eq(e).css("display")!="none"){$(".pm_cont").eq(e).css("display","none"),$(".pm_cont").eq(e).css("visibility","hidden");var n=$(".pm_cont").eq(e),r=n.attr("id").split("_")[1],i=n.attr("id").split("_")[2],s=n.find(".pm_status").attr("class").split(" ")[0],o=n.find(".pm_name").text();return $(".pm_list_footer").length==0?$(".pm_bar").prepend('<div class="dropup pm_list_footer_cont"><div class="pm_list_footer dropdown-toggle" data-toggle="dropdown"><div class="glyphicon glyphicon-comment" style="color:white;float:left;"> ...</div></div><ul class="dropdown-menu pm_dropup" role="menu"><li id="switch_'+r+"_"+i+'"><a class="switch_pm" href="#" data-friend-id="'+r+'" data-friend-name="'+o+'" data-pm-id="'+i+'" data-status="'+s+'">'+o+"</a></li></ul></div>"):$(".pm_dropup").prepend('<li id="switch_'+r+"_"+i+'"><a class="switch_pm" href="#" data-friend-id="'+r+'" data-friend-name="'+o+'" data-pm-id="'+i+'" data-status="'+s+'">'+o+"</a></li>"),!1}})):(module.crit_len.length>0&&$(window).width()>module.crit_len[module.crit_len.length-1]||module.crit_len.length==0&&$(".pm_bar").width()<=$(window).width()-30)&&$(".pm_cont").eq(0).css("display")=="none"&&(module.crit_len.pop(),$.each($(".pm_cont"),function(e,t){if($(".pm_cont").eq(e).css("display")!="none"&&e>0){var n=$(".pm_cont").eq(e-1),r=n.attr("id").split("_")[1],i=n.attr("id").split("_")[2];$("#switch_"+r+"_"+i).remove(),$(".pm_dropup").children().length==0&&$(".pm_list_footer_cont").remove(),$(".pm_cont").eq(e-1).css("display",""),$(".pm_cont").eq(e-1).find(".pm_body").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$(".pm_cont").eq(e-1).css("visibility","")},50)}else if(e==$(".pm_cont").length-1){var n=$(".pm_cont").eq(e),r=n.attr("id").split("_")[1],i=n.attr("id").split("_")[2];$("#switch_"+r+"_"+i).remove(),$(".pm_dropup").children().length==0&&$(".pm_list_footer_cont").remove(),$(".pm_cont").eq(e).css("display",""),$(".pm_cont").eq(e).find(".pm_body").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$(".pm_cont").eq(e).css("visibility","")},50)}}))}),$(document).ready(function(){$.each($(".chat_img"),function(e,t){$(".chat_img").eq(e).attr("src",$(".chat_img").eq(e).attr("data-chat-img"))}),module.user_id.length&&(window.setInterval(function(){module.typ_cnt>1?module.typ_cnt--:module.typ_cnt==1&&(module.typ_cnt--,module.socket.emit("not_typing",{pm_id:module.pm_info[2],friend_id:module.pm_info[1],user_id:module.user_id})),module.recent>120?$.ajax({type:"POST",data:{user_id:module.user_id},url:"//mutualcog.com/profile/update-online-status",success:function(){},error:function(){}}):module.recent++},1e3),$(window).on("mousemove",function(){module.recent>120&&module.socket.emit("seen_chats"),module.recent=0})),typeof socket!="undefined"&&module.socket.emit("seen_chats"),$(".pm_body").length&&($(".pm_bar").width()>$(window).width()-30&&$.each($(".pm_cont"),function(e,t){$(".pm_cont").eq(e).css("display","none"),$(".pm_cont").eq(e).removeClass("pm_visible");var n=$(".pm_cont").eq(e),r=n.attr("id").split("_")[1],i=n.attr("id").split("_")[2],s=n.find(".pm_status").attr("class").split(" ")[0],o=n.find(".pm_name").text();$(".pm_list_footer").length==0?$(".pm_bar").prepend('<div class="dropup pm_list_footer_cont"><div class="pm_list_footer dropdown-toggle" data-toggle="dropdown"><div class="glyphicon glyphicon-comment" style="color:white;float:left;"> ...</div></div><ul class="dropdown-menu pm_dropup" role="menu"><li id="switch_'+r+"_"+i+'"><a class="switch_pm" href="#" data-friend-id="'+r+'" data-friend-name="'+o+'" data-pm-id="'+i+'" data-status="'+s+'">'+o+"</a></li></ul></div>"):$(".pm_dropup").prepend('<li id="switch_'+r+"_"+i+'"><a class="switch_pm" href="#" data-friend-id="'+r+'" data-friend-name="'+o+'" data-pm-id="'+i+'" data-status="'+s+'">'+o+"</a></li>");if($(".pm_bar").width()<=$(window).width()-30)return!1}),$(".pm_body").mCustomScrollbar({theme:"light-2",callbacks:{onScroll:function(){var e=$(this),t=e.parent().attr("id"),n=this.mcs.draggerTop+e.find(".mCSB_dragger").height();n==e.height()?module.pm_scroll_inactive[t]=0:module.pm_scroll_inactive[t]=1}}}),$(".pm_body").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$(".pm_visible").css("visibility",""),$.each($(".pm_cont"),function(e,t){$(".pm_cont").eq(e).hasClass("pm_visible")||$(".pm_cont").eq(e).addClass("pm_visible")})},50)),updateChatTimes,updateTimes,setInterval(updateTimes,6e4),setInterval(updateChatTimes,6e4);if(document.URL.indexOf("#")!=-1&&$(".nav-tabs").length!=0){var e=document.URL.substring(document.URL.indexOf("#"));$(".nav-tabs").find('a[href="'+e+'"]').tab("show")}$.each($(".pm_message"),function(e,t){moment().local().format("D:M:YYYY")==moment.utc($(".pm_message").eq(e).attr("title")).local().format("D:M:YYYY")?$(".pm_message").eq(e).attr("title",moment.utc($(".pm_message").eq(e).attr("title")).local().format("[Today at] h:mma")):$(".pm_message").eq(e).attr("title",moment.utc($(".pm_message").eq(e).attr("title")).local().format("M/D/YY [at] h:mma"))}),$.each($(".chat_time"),function(e,t){moment().local().format("D:M:YYYY")==moment.utc($(".chat_time").eq(e).attr("title")).local().format("D:M:YYYY")?$(".chat_time").eq(e).attr("title",moment.utc($(".chat_time").eq(e).attr("title")).local().format("[Today at] h:mma")):$(".chat_time").eq(e).attr("title",moment.utc($(".chat_time").eq(e).attr("title")).local().format("M/D/YY [at] h:mma"))}),$.each($(".time"),function(e,t){moment().local().format("D:M:YYYY")==moment.utc($(".time").eq(e).attr("title")).local().format("D:M:YYYY")?$(".time").eq(e).attr("title",moment.utc($(".time").eq(e).attr("title")).local().format("[Today at] h:mma")):$(".time").eq(e).attr("title",moment.utc($(".time").eq(e).attr("title")).local().format("M/D/YY [at] h:mma"))}),$("#mssg_requests").popover({html:!0}),$("#global_requests").popover({html:!0}),$("#friend_requests").popover({html:!0}),$("#mssg_requests").blur(function(){$(this).popover("hide")}),$("#global_requests").blur(function(){$(this).popover("hide")}),$("#friend_requests").blur(function(){$(this).popover("hide")}),$("#request_friend").click(function(){if($("#logged_in").text()!=1)return $("#reg_modal_title").text("Sign up to add friends"),$("#register_modal").modal(),!1;module.socket.emit("request_friend",{user_id:$(this).attr("data-user-id"),user:$(this).attr("data-user-name"),sender_id:module.user_id,sender:module.user_tracker}),$(this).removeClass("btn-primary"),$(this).addClass("btn-success"),$(this).html('<div class="glyphicon glyphicon-check" id="request_glyph"></div> Request Sent'),$(this).off("click")}),$(".register_link").click(function(){$("#reg_modal_title").text("Create an account")}),$(".show_subscriptions").click(function(){$(".left_menu_toggle").html('Subscriptions <strong class="caret" style="color:white;"></strong>'),$(".show_friends").show(),$("#friend_box_cont").hide(),$("#subscription_cont").show("slide"),$(this).hide()}),$(".show_friends").click(function(){$(".left_menu_toggle").html('Friends <strong class="caret" style="color:white;"></strong>'),$(".show_subscriptions").show(),$("#friend_box_cont").show("slide"),$("#subscription_cont").hide(),$(this).hide()}),$("body").on("click",".mssg_upvote",upvoteMssg),$("body").on("click",".mssg_downvote",downvoteMssg),$("#chat_display").on("click",".toggle_responses",getResponses),$(".chat_content").on("click",".toggle_responses",getStaticResponses),$(".request_btn").on("click",function(){}),$(".pm_bar").on("click",".pm_name",function(e){e.stopPropagation()}),$("body").on("click",".request_link",function(){var e=$(this);$.ajax({type:"GET",data:{note_id:$(this).attr("data-request-id")},url:"//mutualcog.com/profile/remove-notification",success:function(){window.location.href=e.attr("data-request-link")}})}),$(".user_tooltip").tooltip(),$(".caret_tooltip").tooltip(),$("body").on("click",".accept_request",function(){var e=$(this).attr("id").split("_"),t=e[1],n=e[2];module.socket.emit("request_answered",{type:t,user_id:n,accepted:1})}),$("body").on("click",".decline_request",function(){var e=$(this).attr("id").split("_"),t=e[1],n=e[2];module.socket.emit("request_answered",{type:t,user_id:n,accepted:0})}),$("body").on("click",".pm_remove",function(){$(this).parent().parent().remove();var e=$(this).parent().parent().attr("id").split("_");return module.socket.emit("leave_pm",{pm_id:e[2],friend_id:e[1]}),!1}),$("body").on("click",".friend_box",function(){var e=$(this).attr("id").replace("friend_box_for_",""),t=$(this).attr("data-friend-id"),n=$(this).attr("data-pm-chat-id"),r=$(this).find("#friend_"+t+"_status").attr("class").replace("friend_status","");if($(".pm_bar").width()<$(window).width()-370&&$("#pm_"+t+"_"+n).length==0)if(n!="0"){var i=newPmChat(t,n,r,e);$(".pm_bar").prepend(i),$.ajax({type:"GET",data:{pm_id:n},url:"//mutualcog.com/chat/pm-log",success:function(r){var i="";$.each(r,function(e,t){t.author_id==module.user_id?i+='<div class="pm_mssg_cont"> <div class="pm_message pull-right" style="background-color:#eee;margin-left:30px;margin-right:5px;" title="'+moment.utc(t.created_at).local().format("[Today at] h:mma")+'"> '+t.message+" </div> </div>":i+='<div class="pm_mssg_cont"> <div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(t.created_at).local().format("[Today at] h:mma")+'"> '+t.message+" </div> </div>"}),$("#pm_"+t+"_"+n).find(".pm_body_mssgs").append(i),module.socket.emit("join_pm",{friend_id:t,friend_name:e,pm_id:n},function(e){}),$(".pm_body").eq(0).mCustomScrollbar({theme:"light-2",callbacks:{onScroll:function(){var e=$(this),t=e.parent().attr("id"),n=this.mcs.draggerTop+e.find(".mCSB_dragger").height();n==e.height()?module.pm_scroll_inactive[t]=0:module.pm_scroll_inactive[t]=1}}}),$(".pm_body").eq(0).mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$(".pm_visible").css("visibility",""),$("#pm_"+t+"_"+n).find(".pm_text").focus()},50),$(".pm_cont").eq(0).resizable({handles:"nw",ghost:!1,maxHeight:450,maxWidth:400,minHeight:330,minWidth:240,resize:function(e,t){var n=t.size.height,r=t.size.width-10;$(this).css("left","0"),$(this).css("top","0"),$(this).find(".pm_header").width(r),$(this).find(".pm_body").height(n-64),$(this).find(".pm_body").width($(this).find(".pm_header").width()+6),$(this).find(".pm_text").width($(this).find(".pm_header").width()-2)}})},error:function(){}})}else{var i=newPmChat(t,0,r,e);$(".pm_bar").prepend(i),module.socket.emit("join_pm",{friend_id:t,friend_name:e,pm_id:n},function(e){$("#pm_"+e.friend_name+"_0").attr("id","pm_"+e.friend_id+"_"+e.pm_id)}),$(".pm_body").eq(0).mCustomScrollbar({theme:"light-2",callbacks:{onScroll:function(){var e=$(this),t=e.parent().attr("id"),n=this.mcs.draggerTop+e.find(".mCSB_dragger").height();n==e.height()?module.pm_scroll_inactive[t]=0:module.pm_scroll_inactive[t]=1}}}),$(".pm_body").eq(0).mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$(".pm_visible").css("visibility",""),$("#pm_"+t+"_"+n).find(".pm_text").focus()},50),$(".pm_cont").eq(0).resizable({handles:"nw",ghost:!1,maxHeight:450,maxWidth:400,minHeight:330,minWidth:240,resize:function(e,t){var n=t.size.height,r=t.size.width-10;$(this).css("left","0"),$(this).css("top","0"),$(this).find(".pm_header").width(r),$(this).find(".pm_body").height(n-64),$(this).find(".pm_body").width($(this).find(".pm_header").width()+6),$(this).find(".pm_text").width($(this).find(".pm_header").width()-2)}})}else $("#pm_"+t+"_"+n).length==0&&($(".pm_list_footer").length==0?$(".pm_bar").prepend('<div class="dropup pm_list_footer_cont"><div class="pm_list_footer dropdown-toggle" data-toggle="dropdown"><div class="glyphicon glyphicon-comment" style="color:white;float:left;"> ...</div></div><ul class="dropdown-menu pm_dropup" role="menu"><li id="switch_'+t+"_"+n+'"><a class="switch_pm" href="#" data-friend-id="'+t+'" data-friend-name="'+e+'" data-pm-id="'+n+'" data-status="'+r+'">'+e+"</a></li></ul></div>"):$(".pm_dropup").prepend('<li id="switch_'+t+"_"+n+'"><a class="switch_pm" href="#" data-friend-id="'+t+'" data-friend-name="'+e+'" data-pm-id="'+n+'" data-status="'+r+'">'+e+"</a></li>"))}),$("body").on("click",".switch_pm",function(){$(this).remove();var e=$(".pm_cont").first(),t=e.attr("id").split("_")[1],n=e.attr("id").split("_")[2],r=e.find(".pm_status").attr("class").split(" ")[0],i=e.find(".pm_name").text();$(".pm_dropup").prepend('<li id="switch_'+s+"_"+o+'"><a class="switch_pm" href="#" data-friend-id="'+t+'" data-friend-name="'+i+'" data-pm-id="'+n+'" data-status="'+r+'">'+i+"</a></li>"),$(".pm_cont").first().css("display","none"),$(".pm_cont").first().css("visibility","hidden");var s=$(this).attr("data-friend-id"),o=$(this).attr("data-pm-id"),u=$(this).attr("data-status"),a=$(this).attr("data-friend-name");if($("#pm_"+s+"_"+o).length==0){var f=newPmChat(s,o,u,a);$(".pm_cont").first().before(f),$.ajax({type:"GET",data:{pm_id:o},url:"//mutualcog.com/chat/pm-log",success:function(e){var t="";$.each(e,function(e,n){n.author_id==module.user_id?t+='<div class="pm_mssg_cont"> <div class="pm_message pull-right" style="background-color:#eee;margin-left:30px;margin-right:5px;" title="'+moment.utc(n.created_at).local().format("[Today at] h:mma")+'"> '+n.message+" </div> </div>":t+='<div class="pm_mssg_cont"> <div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(n.created_at).local().format("[Today at] h:mma")+'"> '+n.message+" </div> </div>"}),$("#pm_"+s+"_"+o).find(".pm_body_mssgs").append(t),module.socket.emit("join_pm",{friend_id:s,friend_name:a,pm_id:o},function(e){}),$("#pm_"+s+"_"+o).find(".pm_body").mCustomScrollbar({theme:"light-2",callbacks:{onScroll:function(){var e=$(this),t=e.parent().attr("id"),n=this.mcs.draggerTop+e.find(".mCSB_dragger").height();n==e.height()?module.pm_scroll_inactive[t]=0:module.pm_scroll_inactive[t]=1}}}),$("#pm_"+s+"_"+o).find(".pm_body").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$("#pm_"+s+"_"+o).css("visibility",""),$("#pm_"+s+"_"+o).find(".pm_text").focus()},50),$("#pm_"+s+"_"+o).resizable({handles:"nw",ghost:!1,maxHeight:450,maxWidth:400,minHeight:330,minWidth:240,resize:function(e,t){var n=t.size.height,r=t.size.width-10;$(this).css("left","0"),$(this).css("top","0"),$(this).find(".pm_header").width(r),$(this).find(".pm_body").height(n-64),$(this).find(".pm_body").width($(this).find(".pm_header").width()+6),$(this).find(".pm_text").width($(this).find(".pm_header").width()-2)}})},error:function(){}})}else{var f=$("#pm_"+s+"_"+o).clone();$("#pm_"+s+"_"+o).remove(),f.css("display",""),$(".pm_cont").first().before(f),$("#pm_"+s+"_"+o).find(".pm_body").mCustomScrollbar({theme:"light-2",callbacks:{onScroll:function(){var e=$(this),t=e.parent().attr("id"),n=this.mcs.draggerTop+e.find(".mCSB_dragger").height();n==e.height()?module.pm_scroll_inactive[t]=0:module.pm_scroll_inactive[t]=1}}}),$("#pm_"+s+"_"+o).find(".pm_body").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$("#pm_"+s+"_"+o).css("visibility",""),$("#pm_"+s+"_"+o).find(".pm_text").focus()},50),$("#pm_"+s+"_"+o).resizable({handles:"nw",ghost:!1,maxHeight:450,maxWidth:400,minHeight:330,minWidth:240,resize:function(e,t){var n=t.size.height,r=t.size.width-10;$(this).css("left","0"),$(this).css("top","0"),$(this).find(".pm_header").width(r),$(this).find(".pm_body").height(n-64),$(this).find(".pm_body").width($(this).find(".pm_header").width()+6),$(this).find(".pm_text").width($(this).find(".pm_header").width()-2)}})}return!1}),$(".pm_cont").resizable({handles:"nw",ghost:!1,maxHeight:450,maxWidth:400,minHeight:330,minWidth:240,resize:function(e,t){var n=t.size.height,r=t.size.width-10;$(this).css("left","0"),$(this).css("top","0"),$(this).find(".pm_header").width(r),$(this).find(".pm_body").height(n-64),$(this).find(".pm_body").width($(this).find(".pm_header").width()+6),$(this).find(".pm_text").width($(this).find(".pm_header").width()-2)}}),$("body").on("click",".pm_header",function(){var e=$(this).parent().attr("id").split("_");$(this).parent().find(".pm_body").css("display")=="none"?(module.socket.emit("maximize_pm",{friend_id:e[1],pm_id:e[2]}),$(this).parent().resizable("enable"),$(this).parent().find(".pm_body").css("display",""),$(this).parent().find(".pm_text").css("display",""),$(this).parent().find(".pm_body").css("visibility","hidden"),$(".pm_body").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$(".pm_body").css("visibility","")},50)):(module.socket.emit("minimize_pm",{friend_id:e[1],pm_id:e[2]}),$(this).parent().css("height")!=""&&($(this).parent().attr("data-expanded-height",$(this).parent().css("height")),$(this).parent().css("height","")),$(this).parent().resizable("disable"),$(this).parent().find(".pm_body").css("display","none"),$(this).parent().find(".pm_text").css("display","none"))}),$(".community_search").hide(),$(".community_search").css("visibility","visible"),$(".toggle_search").click(function(){$(".community_search").css("display")=="none"?($(".community_search_expand").css("display","none"),$(".community_search_collapse").css("display",""),$(".community_input").width($("#welcome_user").width()-34),$(".community_input").attr("placeholder",module.search_messages[randomInt(0,module.search_messages.length-1)]),$(".nav_pad_r").css("padding-right",$("#welcome_user").width()+100),$(".community_search").show("slide",{direction:"right"})):($(".community_search_expand").css("display",""),$(".community_search_collapse").css("display","none"),$(".community_search").hide("slide",{direction:"right"},function(){$(".nav_pad_r").css("padding-right",$(".community_search_cont").width())})),$(".community_input").focus()}),$("#community_dropdown").on("click",".search_link",function(){return $("#keywords_modal").modal(),!1})}),upvoteMssg=function(e){e.stopPropagation();var t=$(this).attr("id").replace("mssg_upvote_",""),n="//mutualcog.com/chat/message-upvote",r=parseInt($("#mssg_votes_"+t).text());$("#mssg_downvote_"+t).hasClass("red_color")?($("#mssg_upvote_"+t).addClass("green_color"),$("#mssg_downvote_"+t).removeClass("red_color"),$("#mssg_votes_"+t).text(r+2)):$("#mssg_upvote_"+t).hasClass("green_color")?($("#mssg_upvote_"+t).removeClass("green_color"),$("#mssg_downvote_"+t).removeClass("red_color"),$("#mssg_votes_"+t).text(r-1)):($("#mssg_upvote_"+t).addClass("green_color"),$("#mssg_downvote_"+t).removeClass("red_color"),$("#mssg_votes_"+t).text(r+1)),$("#logged_in").text()==1?$.ajax({type:"POST",data:{id:t},url:n,success:function(e){e.status==1||e.status==3?(e.status==1?(module.downvoted.splice(module.downvoted.indexOf(t.toString()),1),module.upvoted.push(t.toString())):module.upvoted.push(t.toString()),$("#mssg_cont_"+t).hasClass("mssg_cont")?module.socket.emit("update_votes",{id:t,response:e,responseto:"global"}):module.socket.emit("update_votes",{id:t,response:e,responseto:$("#message").attr("class")}),$("#mssg_upvote_"+t).addClass("green_color"),$("#mssg_downvote_"+t).removeClass("red_color")):e.status==2?(module.upvoted.splice(module.upvoted.indexOf(t.toString()),1),$("#mssg_cont_"+t).hasClass("mssg_cont")?module.socket.emit("update_votes",{id:t,response:e,responseto:"global"}):module.socket.emit("update_votes",{id:t,response:e,responseto:$("#message").attr("class")}),$("#mssg_upvote_"+t).removeClass("green_color"),$("#mssg_downvote_"+t).removeClass("red_color")):($("#reg_modal_title").text("Sign up to upvote/downvote"),$("#register_modal").modal())},error:function(){}}):($("#reg_modal_title").text("Sign up to upvote/downvote"),$("#register_modal").modal())},downvoteMssg=function(e){e.stopPropagation();var t=$(this).attr("id").replace("mssg_downvote_",""),n="//mutualcog.com/chat/message-downvote",r=parseInt($("#mssg_votes_"+t).text());$("#mssg_downvote_"+t).hasClass("red_color")?($("#mssg_upvote_"+t).removeClass("green_color"),$("#mssg_downvote_"+t).removeClass("red_color"),$("#mssg_votes_"+t).text(r+1)):$("#mssg_upvote_"+t).hasClass("green_color")?($("#mssg_upvote_"+t).removeClass("green_color"),$("#mssg_downvote_"+t).addClass("red_color"),$("#mssg_votes_"+t).text(r-2)):($("#mssg_upvote_"+t).removeClass("green_color"),$("#mssg_downvote_"+t).addClass("red_color"),$("#mssg_votes_"+t).text(r-1)),$("#logged_in").text()==1?$.ajax({type:"POST",data:{id:t},url:n,success:function(e){e.status==1||e.status==3?(e.status==1?(module.upvoted.splice(module.downvoted.indexOf(t.toString()),1),module.downvoted.push(t.toString())):module.downvoted.push(t.toString()),$("#mssg_cont_"+t).hasClass("mssg_cont")?module.socket.emit("update_votes",{id:t,response:e,responseto:"global"}):module.socket.emit("update_votes",{id:t,response:e,responseto:$("#message").attr("class")}),$("#mssg_upvote_"+t).removeClass("green_color"),$("#mssg_downvote_"+t).addClass("red_color")):e.status==2?(module.downvoted.splice(module.downvoted.indexOf(t.toString()),1),$("#mssg_cont_"+t).hasClass("mssg_cont")?module.socket.emit("update_votes",{id:t,response:e,responseto:"global"}):module.socket.emit("update_votes",{id:t,response:e,responseto:$("#message").attr("class")}),$("#mssg_upvote_"+t).removeClass("green_color"),$("#mssg_downvote_"+t).removeClass("red_color")):($("#reg_modal_title").text("Sign up to upvote/downvote"),$("#register_modal").modal())},error:function(){}}):($("#reg_modal_title").text("Sign up to upvote/downvote"),$("#register_modal").modal())},$(".big_upvote").click(function(e){e.stopPropagation();var t=$(this).attr("id"),n=$(this).attr("id").replace("upvote_",""),r="//mutualcog.com/chat/upvote",i=parseInt($("#votes_"+n).text());$("#downvote_"+n).hasClass("red_color")?($("#upvote_"+n).addClass("green_color"),$("#downvote_"+n).removeClass("red_color"),$("#votes_"+n).text(i+2)):$("#upvote_"+n).hasClass("green_color")?($("#upvote_"+n).removeClass("green_color"),$("#downvote_"+n).removeClass("red_color"),$("#votes_"+n).text(i-1)):($("#upvote_"+n).addClass("green_color"),$("#downvote_"+n).removeClass("red_color"),$("#votes_"+n).text(i+1)),$("#logged_in").text()==1?$.ajax({type:"POST",data:{id:n},url:r,success:function(e){e.status==1||e.status==3?($("#votes_"+n).text(e.upvotes),$("#upvote_"+n).addClass("green_color"),$("#downvote_"+n).removeClass("red_color")):e.status==2?($("#votes_"+n).text(e.upvotes),$("#upvote_"+n).removeClass("green_color"),$("#downvote_"+n).removeClass("red_color")):($("#reg_modal_title").text("Sign up to upvote/downvote"),$("#register_modal").modal())},error:function(){}}):($("#reg_modal_title").text("Sign up to upvote/downvote"),$("#register_modal").modal())}),$(".big_downvote").click(function(e){e.stopPropagation();var t=$(this).attr("id"),n=$(this).attr("id").replace("downvote_",""),r="//mutualcog.com/chat/downvote",i=parseInt($("#votes_"+n).text());$("#downvote_"+n).hasClass("red_color")?($("#upvote_"+n).removeClass("green_color"),$("#downvote_"+n).removeClass("red_color"),$("#votes_"+n).text(i+1)):$("#upvote_"+n).hasClass("green_color")?($("#upvote_"+n).removeClass("green_color"),$("#downvote_"+n).addClass("red_color"),$("#votes_"+n).text(i-2)):($("#upvote_"+n).removeClass("green_color"),$("#downvote_"+n).addClass("red_color"),$("#votes_"+n).text(i-1)),$("#logged_in").text()==1?$.ajax({type:"POST",data:{id:n},url:r,success:function(e){e.status==1||e.status==3?($("#votes_"+n).text(e.upvotes),$("#upvote_"+n).removeClass("green_color"),$("#downvote_"+n).addClass("red_color")):e.status==2?($("#votes_"+n).text(e.upvotes),$("#upvote_"+n).removeClass("green_color"),$("#downvote_"+n).removeClass("red_color")):($("#reg_modal_title").text("Sign up to upvote/downvote"),$("#register_modal").modal())},error:function(){}}):($("#reg_modal_title").text("Sign up to upvote/downvote"),$("#register_modal").modal())}),module.socket.on("updateVotes",function(e){$("#mssg_votes_"+e.message_id).text(e.response.upvotes)}),$("#login_form").submit(function(){var e=$("#username").val(),t=$("#pass").val();if(e.length>0&&t.length>0){var n=validateLogin(e,t);return n?!0:!1}return!1}),$("#reg_username").blur(function(){var e=$("#reg_username").val();if(e.length>0)var t=validateUser(e)}),$("#pass2").blur(function(){var e=$("#reg_pass").val(),t=$("#pass2").val();if(e.length>0&&t.length>0)var n=validatePasswords(e,t)}),$("#register_form").submit(function(){var e=$("#reg_username").val(),t=$("#reg_pass").val(),n=$("#pass2").val(),r=$("#email").val();if(e.length>0&&t.length>0&&n.length>0){var i=validateUser(e);if(!i)return!1;var i=validatePasswords(t,n);if(!i)return!1;if(r.length>0){var i=validateEmail(r);if(!i)return!1}return!0}return e.length==0&&$("#reg_user_group").attr("class","form-group has-error"),t.length==0&&$("#reg_pass1_group").attr("class","form-group has-error"),n.length==0&&$("#pass2_group").attr("class","form-group has-error"),$("#reg_username").attr("data-original-title","Please enter both a username and a confirmed password"),$("#reg_username").tooltip("show"),!1}),$(".modal").on("hide.bs.modal",function(){$(".form-control").tooltip("destroy")}),$("#community_dropdown").on("click",function(e){e.stopPropagation()}),$("#search_input").on("focus",function(e){e.stopPropagation(),$("#search_input").val()==""&&$("#community_dropdown").html(""),$(this).dropdown(),$("#community_dropdown").show()});var selected_term=-1;$("#search_input").on("keydown",function(e){if(e.keyCode==13)return selected_term==-1?window.location.href="//mutualcog.com/search/result/"+$("#search_input").val():location.assign($("li#search_"+selected_term).children("a").attr("href")),!1;if(e.keyCode==38)return selected_term!=0&&(selected_term--,$(".community_results").css("background-color",""),$("li#search_"+selected_term).css("background-color","#ddd")),!1;if(e.keyCode==40)return selected_term!=$(".community_results").length-1&&(selected_term++,$(".community_results").css("background-color",""),$("li#search_"+selected_term).css("background-color","#ddd")),!1}),$(".entry_search_submit").click(function(){return selected_term==-1?window.location.href="//mutualcog.com/search/result/"+$("#search_input").val():location.assign($("li#search_"+selected_term).children("a").attr("href")),!1}),$("#search_input").on("keyup",function(e){var t=$(this).val();if(e.keyCode==13)return!1;e.keyCode!=38&&e.keyCode!=40&&(t.length>2?$.ajax({type:"GET",data:{community:t},url:"//mutualcog.com/search/similar-entity",success:function(e){var t="",n=0,r=0,i=0;$.each(e,function(e,s){s.type=="community"?(r==0&&(t+='<div class="search_res_type"><strong>Communities</strong></div>',r++),t+='<li id="search_'+e+'" class="community_results"><a href="//mutualcog.com/c/'+s.name+'">'+s.name+"</a></li>"):s.type=="post"?(i==0&&(t+='<div class="search_res_type"><strong>Posts</strong></div>',i++),s.live==1?t+='<li id="search_'+e+'" class="community_results"><a href="//mutualcog.com/chat/live/'+s.id+'">'+s.name+"</a></li>":t+='<li id="search_'+e+'" class="community_results"><a href="//mutualcog.com/chat/static/'+s.id+'">'+s.name+"</a></li>"):(n==0&&(t+='<div class="search_res_type"><strong>Users</strong></div>',n++),t+='<li id="search_'+e+'" class="community_results"><a href="//mutualcog.com/u/'+s.name+'">'+s.name+"</a></li>")}),t+='<div class="search_hint_cont"><div class="search_hint"><strong>Press enter for more results</strong></div></div>',t+='<li><a class="search_link" href="#" ><strong>List of advanced search keywords</strong></a></li>',t?($("#community_dropdown").show(),$("#community_dropdown").html()!=t&&($("#community_dropdown").html(t),selected_term=-1)):($("#community_dropdown").hide(),selected_term=-1)},error:function(){}}):$("#community_dropdown").html(""))}),$(window).on("blur",function(){module.focused=0,module.user_id.length&&(module.recent+=110)}),$(window).on("focus",function(){module.focused=1,module.user_id.length&&(module.recent>120&&module.socket.emit("seen_chats"),module.recent=0)}),module.socket.on("receive_pm",function(e){var t=$("#pm_"+e.friend_id+"_"+e.pm_id);if(e.state==0){var n=$("#friend_"+e.friend_id+"_status").attr("class").replace("friend_status","");$.ajax({type:"GET",data:{pm_id:e.pm_id},url:"//mutualcog.com/chat/pm-log",success:function(r){var i='<div class="pm_cont" id="pm_'+e.friend_id+"_"+e.pm_id+'">';i+='<div class="pm_header"><div class="'+n+' pm_status"></div><div class="glyphicon glyphicon-remove pm_remove"></div><a class="pm_name" href="//mutualcog.com/u/'+e.friend_name+'">'+e.friend_name+"</a></div>",i+='<div class="pm_body"><div class="pm_body_mssgs">',$.each(r,function(e,t){t.author_id==module.user_id?i+='<div class="pm_mssg_cont"> <div class="pm_message pull-right" style="background-color:#eee;margin-left:30px;margin-right:5px;" title="'+moment.utc(t.created_at).local().format("[Today at] h:mma")+'"> '+t.message+" </div> </div>":i+='<div class="pm_mssg_cont"> <div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(t.created_at).local().format("[Today at] h:mma")+'"> '+t.message+" </div> </div>"}),i+='</div><div class="pm_body_alerts"> <div class="pm_mssg_alert pm_unseen" style="display:none;">Not seen</div> <div class="pm_mssg_alert pm_typing" style="display:none;">'+e.friend_name+" is typing...</div> </div></div>",i+='<textarea rows=1 class="pm_text"></textarea>',i+="</div>",$(".pm_bar").prepend(i);var s='<div class="pm_mssg_cont">';s+='<div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(e.time).local().format("[Today at] h:mma")+'">'+e.message+"</div>",s+="</div>",t=$("#pm_"+e.friend_id+"_"+e.pm_id),t.find(".pm_body_mssgs").append(s);if(module.pm_scroll_inactive[t.attr("id")]==0||!(t.attr("id")in module.pm_scroll_inactive)){var o=t.find(".pm_body");window.setTimeout(function(){o.mCustomScrollbar("scrollTo","bottom",{scrollInertia:0})},20)}},error:function(){}})}else if(e.state==2){t.resizable("enable"),t.parent().find(".pm_body").css("display",""),t.parent().find(".pm_text").css("display","");var r='<div class="pm_mssg_cont">';r+='<div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(e.time).local().format("[Today at] h:mma")+'">'+e.message+"</div>",r+="</div>",t.find(".pm_body_mssgs").append(r)}else{var r='<div class="pm_mssg_cont">';r+='<div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(e.time).local().format("[Today at] h:mma")+'">'+e.message+"</div>",r+="</div>",t.find(".pm_body_mssgs").append(r)}if(module.pm_scroll_inactive[t.attr("id")]==0||!(t.attr("id")in module.pm_scroll_inactive)){var i=t.find(".pm_body");window.setTimeout(function(){i.mCustomScrollbar("scrollTo","bottom",{scrollInertia:0})},20)}}),module.socket.on("displayFriendRequests",function(e){var t=$("#friend_requests_count");t.text().length>0?t.text(parseInt(t.text())+1):($("#friend_request_glyph").addClass("pull-left"),t.text("1")),$("#friend_requests").attr("data-content").indexOf("No friend requests")>=0?$("#friend_requests").attr("data-content",e.message):$("#friend_requests").attr("data-content",$("#friend_requests").attr("data-content").prepend(e.message))}),module.socket.on("displayGlobalRequests",function(e){var t=$("#global_requests_count");t.text().length>0?t.text(parseInt(t.text())+1):($("#global_request_glyph").addClass("pull-left"),t.text("1")),$("#global_requests").attr("data-content").indexOf("No global requests")>=0?$("#global_requests").attr("data-content",e.message):$("#global_requests").attr("data-content",$("#global_requests").attr("data-content").prepend(e.message))}),module.socket.on("chat_seen",function(e){var t=$("#pm_"+e.friend_id+"_"+e.pm_id);t.find(".pm_unseen").hide()}),module.socket.on("is_typing",function(e){var t=$("#pm_"+e.friend_id+"_"+e.pm_id);t.find(".pm_typing").show()}),module.socket.on("not_typing",function(e){var t=$("#pm_"+e.friend_id+"_"+e.pm_id);t.find(".pm_typing").hide()});var pm_keys=new Array;$("body").on("cut",".pm_text",function(e){var t=$(this),n=this;window.setTimeout(function(){t.height(0),t.height(n.scrollHeight-10)},0)}),$("body").on("paste",".pm_text",function(e){var t=$(this),n=this;window.setTimeout(function(){t.height(0),t.height(n.scrollHeight-10)},0)}),$("body").on("keydown",".pm_text",function(e){pm_keys.push(e.which);var t=$(this),n=this;if(e.which==13&&$(this).val().trim()=="")return!1;window.setTimeout(function(){(e.which!=13||pm_keys.indexOf(16)!=-1)&&t.val().trim()!=""&&(t.height(0),t.height(n.scrollHeight-10))},0)}),$("body").on("keyup",".pm_text",function(e){module.pm_info=$(this).parent().attr("id").split("_");var t=$(this).parents(".pm_cont");module.user_id.length&&(module.recent>120&&module.socket.emit("seen_chats"),module.recent=0);if(e.which==13)if(pm_keys.indexOf(16)==-1){pm_keys.splice(pm_keys.indexOf(e.which),1),module.typ_cnt>0&&module.socket.emit("not_typing",{pm_id:module.pm_info[2],friend_id:module.pm_info[1],user_id:module.user_id});if($(this).val().trim()=="")return!1;var n=processMessage($(this).val());module.socket.emit("send_pm",{message:n,pm_id:module.pm_info[2],friend_id:module.pm_info[1],user_id:module.user_id},function(e){var t=$("#pm_"+e.friend_id+"_"+e.pm_id),n=t.find(".tmp_message");n.find(".pm_message").html(e.message),n.attr("class",n.attr("class").replace("tmp_message","")),e.unseen&&t.find(".pm_unseen").show()}),$(this).css("height","");var r='<div class="pm_mssg_cont tmp_message">';r+='<div class="pm_message pull-right" style="background-color:#eee;margin-left:30px;margin-right:5px;" title="'+moment().format("hh:mma")+'">'+$(this).val()+"</div>",r+="</div>",$(this).val(""),$("#pm_"+module.pm_info[1]+"_"+module.pm_info[2]).find(".pm_body_mssgs").append(r);if(module.pm_scroll_inactive[t.attr("id")]==0||!(t.attr("id")in module.pm_scroll_inactive)){var i=t.find(".pm_body");window.setTimeout(function(){i.mCustomScrollbar("scrollTo","bottom",{scrollInertia:0})},20)}module.typ_cnt=0}else module.typ_cnt==0&&module.socket.emit("is_typing",{pm_id:module.pm_info[2],friend_id:module.pm_info[1],user_id:module.user_id}),pm_keys.splice(keys.indexOf(e.which),1),module.typ_cnt=4;else module.typ_cnt==0&&module.socket.emit("is_typing",{pm_id:module.pm_info[2],friend_id:module.pm_info[1],user_id:module.user_id}),pm_keys.splice(pm_keys.indexOf(e.which),1),module.typ_cnt=4;return!0}),module.socket.on("softDelete",function(e){$("#message_"+e.id+".chat_mssg").length&&($(".mssg_icon").tooltip("hide"),$(".mssg_icon").tooltip(),$("#message_"+e.id+".chat_mssg").find(".mssg_body").html("<strong class='mssg_op' id='"+e.user+"' style='color:"+module.color_arr[e.mssg_serial%7]+";'>"+e.user+" (<span class='response_count' id='"+e.id+"'>"+e.responses+"</span>)</strong> : <em>This message has been deleted</em>"))}),deleteIt=function(e){e.stopPropagation();var t=$(this).parents(".chat_mssg").first().attr("id").replace("message_","");$("#logged_in").text()==1?module.socket.emit("delete_message",{id:t,user:module.user_tracker,serial:$(this).attr("data-mssg-serial"),responses:$(this).parent().find(".response_count").text()}):module.socket.emit("delete_message",{id:t,user:module.serial_tracker,serial:$(this).attr("data-mssg-serial"),responses:$(this).parent().find(".response_count").text()})},getResponses=function(e){e.stopPropagation();var t=$(this).attr("id").replace("toggle_","");$(this).hasClass("dropup")?($(this).removeClass("dropup"),$(this).find(".caret").attr("data-original-title","Hide Responses"),$("#mssg_cont_"+t).children(".mssg_cont").show()):($(this).addClass("dropup"),$(this).find(".caret").attr("data-original-title","Show Responses"),$("#mssg_cont_"+t).children(".mssg_cont").hide())},getStaticResponses=function(e){e.stopPropagation();var t=$(this).attr("id").replace("toggle_","");$(this).hasClass("dropup")?($(this).removeClass("dropup"),$(this).find(".caret").attr("data-original-title","Hide Responses"),$("#mssg_cont_"+t).find(".mssg_cont").show()):($(this).addClass("dropup"),$(this).find(".caret").attr("data-original-title","Show Responses"),$("#mssg_cont_"+t).find(".mssg_cont").hide())};var selected_community=-1,selected_mod=-1,selected_admin=-1;$(document).ready(function(){$(".advanced_cog").tooltip(),$("#pause_chat").tooltip(),$(".chat_content").on("click",".mssg_icon",deleteIt),$(".glyphicon-info-sign").tooltip(),$.each($(".interaction_time"),function(e,t){$(this).text(moment.utc($(this).attr("id")).fromNow())}),$("body").on("click",".p_chat_mssg",function(){var e=$(this).find(".p_mssg_body").attr("class").split(" ")[0].split("_")[2],t=$(this).attr("id");window.location.href="//mutualcog.com/chat/static/"+e+"/"+t}),$("#message_user_form").submit(function(){return $(this).find("#message_body").val()!=""?($(this).attr("action",$(this).attr("action")+$(".profile_name").attr("id")),!0):!1}),$(".toggle_description").click(function(){var e=$(this).parent().parent().find(".description_cont");return e.css("display")=="none"?($(this).html("Hide description"),e.css("display","block")):($(this).html("Show description"),e.css("display","none")),!1}),$(".load_more").on("click",function(){var e=$(this).attr("href"),t=$(this).parent(),n=$(this);return $.ajax({type:"GET",url:e,success:function(e){var r=e.length,i=e.upvoted,s=e.downvoted,o=0;delete e.upvoted,delete e.downvoted,n.remove();var u="";$.each(e,function(e,t){u+='<div class="response_to_'+t.responseto+" mssg_cont y_"+t.y_dim+" parent_"+t.parent+' pad_l_10" id="mssg_cont_'+t.id+'">',u+='<div class="mssg_cont_inner"><div class="chat_mssg" id="message_'+t.id+'"> <div class="row" style="margin:0;"> <div class="mssg_body_cont"> <div class="chat_vote_box">',i.indexOf(t.id)!=-1?u+='<span class="glyphicon glyphicon-chevron-up mssg_upvote" id="mssg_upvote_'+t.id+'" style="color:#57bf4b" data-toggle="tooltip" data-original-title="You must be logged in to vote on responses" data-container="body" data-placement="top"></span> <div class="upvote_count" id="mssg_votes_'+t.id+'">'+(t.upvotes-t.downvotes)+'</div> <span class="glyphicon glyphicon-chevron-down mssg_downvote" id="mssg_downvote_'+t.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on responses" data-container="body" data-placement="bottom"></span></div>':s.indexOf(t.id)!=-1?u+='<span class="glyphicon glyphicon-chevron-up mssg_upvote" id="mssg_upvote_'+t.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on responses" data-container="body" data-placement="top"></span> <div class="upvote_count" id="mssg_votes_'+t.id+'">'+(t.upvotes-t.downvotes)+'</div> <span class="glyphicon glyphicon-chevron-down mssg_downvote" id="mssg_downvote_'+t.id+'" style="color:red;" data-toggle="tooltip" data-original-title="You must be logged in to vote on responses" data-container="body" data-placement="bottom"></span></div>':u+='<span class="glyphicon glyphicon-chevron-up mssg_upvote" id="mssg_upvote_'+t.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on responses" data-container="body" data-placement="top"></span> <div class="upvote_count" id="mssg_votes_'+t.id+'">'+(t.upvotes-t.downvotes)+'</div> <span class="glyphicon glyphicon-chevron-down mssg_downvote" id="mssg_downvote_'+t.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on responses" data-container="body" data-placement="bottom"></span></div>',u+='<div class="mssg_body author_'+t.author+'">',u+='<div id="toggle_'+t.id+'" class="toggle_responses"> <span class="caret caret_tooltip" id="caret_'+t.id+'" data-toggle="tooltip" data-original-title="Hide Responses" data-container="body" data-placement="top"></span> </div>',t.message!="This response has been deleted"&&(module.serial_tracker==t.author||module.user_tracker==t.author)&&(u+='<span id="remove_'+t.id+'" class="glyphicon glyphicon-remove mssg_icon" data-mssg-serial="'+t.serial+'" style="margin-right:5px;" data-toggle="tooltip" title="Delete post" data-container="body" data-placement="top"></span>'),t.author==$("#chat_admin_info").text()&&(u+='<span class="glyphicon glyphicon-star"></span>'),u+='<strong class="mssg_op" data-author="'+t.author+'" style="color:'+module.color_arr[t.serial%7]+'"> '+t.author+' (<span class="response_count" id="'+t.id+'">'+t.responses+"</span>)</strong> : "+t.message,u+='<div class="time_box">',$(".chat_status_indicator").hasClass("glyphicon-pause")&&(u+='<div class="reply"><a href="#" class="reply_link" data-mssg-id="'+t.id+'"><strong>Reply</strong></a></div>'),u+='<div class="time" id="'+t.created_at+'" title="'+t.created_at+' UTC">'+moment.utc(t.created_at).fromNow()+"</div></div>",u+="</div></div></div></div>";if(t.responses==0)if(t.y_dim==o||e==0)u+="</div></div>";else for(var n=0;n<o-t.y_dim;n++)u+="</div></div>";o=t.y_dim}),t.append(u)},error:function(){}}),!1});var e=$("#reply_form").clone();$(".remove_mod").tooltip(),$("#subscribe_btn").click(function(){return $("#logged_in").text()==1?!0:($("#reg_modal_title").text("Sign up to subscribe to communities"),$("#register_modal").modal(),!1)}),$("button#message_friend").click(function(){return $("#logged_in").text()==1?!0:($("#reg_modal_title").text("Sign up to message users"),$("#register_modal").modal(),!1)}),$("#create_community").click(function(){return $("#logged_in").text()==1?!0:($("#reg_modal_title").text("Sign up to create communities"),$("#register_modal").modal(),!1)}),$("#advanced_create").click(function(e){return $("#advanced_modal").modal(),!1}),$("#community_edit").click(function(e){var t=$(this).parents(".side_content");return $("#input_community_id").val(t.find("#community_id_str").text()),$("#input_community_info").val(t.find("#community_info_str").text()),$("#input_community_desc").val(t.find("#community_desc_str").text()),$("#community_edit_modal").modal(),!1}),$(".edit_chat_link").click(function(e){var t=$(this).parents(".chat_title_box");return $("#Title_v3").val(t.find(".chat_title_str").text()),$("#Link_v3").val(t.find(".chat_link_str").text()),$("#Communities_v3").val(t.find(".chat_community_str").text()),$("#description_v3").val(t.find(".chat_desc_str").text()),$("#form_chat_id").val(t.find(".chat_id_str").text()),t.find(".chat_live_str").text()==1?$("#live_status_v3").attr("checked",!0):$("#live_status_v3").attr("checked",!1),t.find(".chat_nsfw_str").text()==1?$("#nsfw_v3").attr("checked",!0):$("#nsfw_v3").attr("checked",!1),$("#edit_modal").modal(),!1}),$(".remove_mod").click(function(e){var t=$(this).attr("id").split("_")[3],n=$(this).attr("id").split("_")[2];window.location.href="//mutualcog.com/community/remove-mod/"+n+"/"+t}),$(".remove_chat_link").click(function(e){return $("#remove_modal").modal(),$("#remove_chat_final").attr("href",$(this).attr("data-remove-link")),!1}),$(".reply_link").on("click",function(){return $("#message_"+$(this).attr("data-mssg-id")).find("#reply_form_"+$(this).attr("data-mssg-id")).length?($("#message_"+$(this).attr("data-mssg-id")).find("#reply_form_"+$(this).attr("data-mssg-id")).toggle(),$(this).children().text()=="Reply"?$(this).children().text("Cancel"):$(this).children().text("Reply")):($(this).html("<strong>Cancel</strong>"),e=$("#reply_form").clone(),$("#message_"+$(this).attr("data-mssg-id")).append(e),$("#message_"+$(this).attr("data-mssg-id")).find("#reply_form").attr("id","reply_form_"+$(this).attr("data-mssg-id")),$("#reply_form_"+$(this).attr("data-mssg-id")).children("#reply_to").val($(this).attr("data-mssg-id"))),!1}),$("body").on("submit",".reply_forms",function(){module.socket.emit("notify_response",$(this).children("#reply_to").val())})}),module.socket.on("connect",function(){console.log("Client has connected"),module.connected=1,module.chat_id&&module.socket.emit("room",module.chat_id)}),$("#home_form_v2").submit(function(){if(cookiesEnabled()){var e=$("#Title_v2").val(),t=$("#Link_v2").val(),n=$("#Communities_v2").val(),r=$("#description").val();return $(".form_error").hide(),$(".form-group").attr("class","form-group"),e.length<5||e.length>module.max_title_length?($("#Title_v2").attr("data-original-title","Title must be between 5 and "+module.max_title_length+" characters"),$("#Title_v2").tooltip("show"),$("#title_group_v2").attr("class","form-group has-error"),!1):n.split(" ")[0]==""||n.split(" ").length>5?($("#communities_group_v2").attr("class","form-group has-error"),$("#Communities_v2").attr("data-original-title","Must have at least 1 community but less than 6"),$("#Communities_v2").tooltip({placement:"bottom",trigger:"focus"}),$("#Communities_v2").tooltip("show"),!1):(n=n.split(" "),$.each(n,function(e,t){t=t.replace("#","");if((t.length<3||t.length>20)&&t.length!=0)return $("#communities_group_v2").attr("class","form-group has-error"),$("#Communities_v2").attr("data-original-title","Communities must be between 3 and 20 characters"),$("#Communities_v2").tooltip({placement:"bottom",trigger:"focus"}),$("#Communities_v2").tooltip("show"),!1}),r.length>module.max_static_length&&($("#description_group").attr("class","form-group has-error"),$("#description").tooltip("show")),$("#home_form_v2").append('<input type="hidden" name="js_key" value="js_enabled" id="js_key">'),!0)}return $("#Title_v2").attr("data-original-title","You must enable cookies to post chats"),$("#Title_v2").tooltip("show"),!1}),$("#home_form_v3").submit(function(){var e=$("#Title_v3").val(),t=$("#Link_v3").val(),n=$("#Communities_v3").val(),r=$("#description_v3").val();return $(".form_error").hide(),$(".form-group").attr("class","form-group"),e.length<5||e.length>module.max_title_length?($("#Title_v3").attr("data-original-title","Title must be between 5 and "+module.max_title_length+" characters"),$("#Title_v3").tooltip("show"),$("#title_group_v3").attr("class","form-group has-error"),!1):n.split(" ")[0]==""||n.split(" ").length>5?($("#communities_group_v3").attr("class","form-group has-error"),$("#Communities_v3").attr("data-original-title","Must have at least 1 community but less than 6"),$("#Communities_v3").tooltip({placement:"bottom",trigger:"focus"}),$("#Communities_v3").tooltip("show"),!1):(n=n.split(" "),$.each(n,function(e,t){t=t.replace("#","");if((t.length<3||t.length>20)&&t.length!=0)return $("#communities_group_v3").attr("class","form-group has-error"),$("#Communities_v3").attr("data-original-title","Communities must be between 3 and 20 characters"),$("#Communities_v3").tooltip({placement:"bottom",trigger:"focus"}),$("#Communities_v3").tooltip("show"),!1}),r.length>module.max_static_length&&($("#description_group_v3").attr("class","form-group has-error"),$("#description_v3").tooltip("show")),$("#home_form_v3").append('<input type="hidden" name="js_key" value="js_enabled" id="js_key">'),!0)}),$("#community_edit_form").submit(function(){var e=$("#edit_community_desc").val(),t=$("#edit_community_info").val();return e.length>module.max_static_length?($("#community_desc_group").attr("class","form-group has-error"),$("#edit_community_desc").tooltip("show"),!1):t.length>module.max_info_length?($("#community_info_group").attr("class","form-group has-error"),$("#edit_community_info").tooltip("show"),!1):!0}),$("#community_create_form").submit(function(){var e=$("#create_community_name").val(),t=$("#create_community_desc").val(),n=$("#create_community_info").val();return e.length<3||e.length>20?($("#create_name_group").attr("class","form-group has-error"),$("#create_community_name").attr("data-original-title","Communities must be between 3 and 20 characters"),$("#create_community_name").tooltip("show"),!1):validateCommunity(e)?t.length>module.max_static_length?($("#create_desc_group").attr("class","form-group has-error"),$("#create_community_desc").tooltip("show"),!1):n.length>module.max_info_length?($("#create_info_group").attr("class","form-group has-error"),$("#create_community_info").tooltip("show"),!1):!0:($("#create_name_group").attr("class","form-group has-error"),$("#create_community_name").attr("data-original-title","Communities must be unique"),$("#create_community_name").tooltip("show"),!1)}),$(window).on("click",function(e){$("#community_dropdown").hide()}),$(".communities_input").on("keydown",function(e){if(e.keyCode==13){if(selected_community!=-1){var t=$(this).val().split(" ");return t.pop(),t.push("#"+$(".suggested_communities").eq(selected_community).text()),$(this).val(t.join(" ")+" #"),$(this).focus(),!1}return!1}if(e.keyCode==38){if($(".popover").length!=0)return selected_community!=0&&(selected_community-=1,$(".suggested_communities").css("color",""),$(".suggested_communities").eq(selected_community).css("color","#57bf4b")),!1}else if(e.keyCode==40&&$(".popover").length!=0)return selected_community!=$(".suggested_communities").length-1&&(selected_community+=1,$(".suggested_communities").css("color",""),$(".suggested_communities").eq(selected_community).css("color","#57bf4b")),!1}),$(".communities_input").on("keyup",function(e){if(e.keyCode==32)if($(this).val().length==1)$(this).val("");else{var t=$(this).val().split(" "),n=new Array;$.each(t,function(e,t){t=t.replace("#",""),n.push("#"+t)}),$(this).val(n.join(" ")),$(this).popover("destroy"),selected_community=-1}else if(e.keyCode!=38&&e.keyCode!=40){var r=$(this).val().split(" ");r=r.pop().replace("#","");if(r.length>2){var i=$(this);$(this).on("blur",function(){$(".popover").length&&$(this).popover("hide")}),$.ajax({type:"GET",data:{community:r.slice(0,-1)},url:"//mutualcog.com/community/similar-community",success:function(e){var t="";$.each(e,function(e,n){t+='<div class="suggested_communities" id="'+n.id+'">'+n.name+"</div>"}),$(".popover").length==0?t&&(i.popover({html:!0}),i.attr("data-content",t),i.popover("show"),$(".suggested_communities").click(function(){var e=$(".communities_input").val().split(" ");e.pop(),e.push("#"+$(this).text()),i.val(e.join(" ")+" #"),i.focus(),i.popover("destroy"),selected_community=-1}),selected_community=-1):t?$(".popover-content").html()!=t&&($(".popover-content").html(t),selected_community=-1,$(".suggested_communities").off("click"),$(".suggested_communities").click(function(){var e=$(".communities_input").val().split(" ");e.pop(),e.push("#"+$(this).text()),i.val(e.join(" ")+" #"),i.focus(),i.popover("destroy"),selected_community=-1})):(i.popover("destroy"),selected_community=-1)},error:function(){}})}else $(this).popover("destroy"),selected_community=-1}}),$("#mod_input").on("keydown",function(e){if(e.keyCode==13){if(selected_mod!=-1){var t={community_id:$(this).attr("data-community-id"),community_name:$(this).attr("data-community-name"),user_id:$(".suggested_mods").eq(selected_mod).attr("id")};module.socket.emit("request_mod",t,function(e){e==1?($("#mod_request_sent").text("Request sent"),$("#mod_request_sent").hasClass("base_green_color")||($("#mod_request_sent").removeClass("base_red_color"),$("#mod_request_sent").addClass("base_green_color"))):($("#mod_request_sent").text("Limit reached"),$("#mod_request_sent").hasClass("base_red_color")||($("#mod_request_sent").removeClass("base_green_color"),$("#mod_request_sent").addClass("base_red_color"))),$("#mod_request_sent").show("fade","slow",function(){window.setTimeout(function(){$("#mod_request_sent").hide("fade","slow")},1500)})}),$(this).popover("destroy"),$(this).focus(),selected_mod=-1}return!1}if(e.keyCode==38)return $(".popover").length!=0&&selected_mod!=0&&(selected_mod+=1,$(".suggested_mods").css("color",""),$(".suggested_mods").eq(selected_mod).css("color","#57bf4b")),!1;if(e.keyCode==40)return $(".popover").length!=0&&selected_mod!=$(".suggested_mods").length-1&&(selected_mod-=1,$(".suggested_mods").css("color",""),$(".suggested_mods").eq(selected_mod).css("color","#57bf4b")),!1}),$("#mod_input").on("keyup",function(e){if(e.keyCode==32||e.keyCode==13)return!1;if(e.keyCode==38||e.keyCode==40)return!1;var t=$(this).val(),n=$(this).attr("data-community-id");if(t.length>2){var r=$(this);$(this).on("blur",function(){$(".popover").length&&$(this).popover("hide")}),$.ajax({type:"GET",data:{mod:t,community_id:n},url:"//mutualcog.com/community/similar-mod",success:function(e){var t="";$.each(e,function(e,n){t+='<div class="suggested_mods" id="'+n.id+'">'+n.name+"</div>"}),$(".popover").length==0?t&&(r.popover({html:!0}),r.attr("data-content",t),r.popover("show"),$(".suggested_mods").click(function(){var e={community_id:r.attr("data-community-id"),community_name:r.attr("data-community-name"),user_id:$(".suggested_mods").eq(selected_mod).attr("id")};module.socket.emit("request_mod",e,function(e){e?($("#mod_request_sent").text("Request sent"),$("#mod_request_sent").hasClass("base_green_color")||($("#mod_request_sent").removeClass("base_red_color"),$("#mod_request_sent").addClass("base_green_color"))):($("#mod_request_sent").text("Limit reached"),$("#mod_request_sent").hasClass("base_red_color")||($("#mod_request_sent").removeClass("base_green_color"),$("#mod_request_sent").addClass("base_red_color"))),$("#mod_request_sent").show("fade","slow",function(){window.setTimeout(function(){$("#mod_request_sent").hide("fade","slow")},1500)})}),r.focus(),r.popover("destroy"),selected_mod=-1}),selected_mod=-1):t?$(".popover-content").html()!=t&&($(".popover-content").html(t),selected_mod=-1,$(".suggested_mods").off("click"),$(".suggested_mods").click(function(){var e={community_id:r.attr("data-community-id"),community_name:r.attr("data-community-name"),user_id:$(".suggested_mods").eq(selected_mod).attr("id")};module.socket.emit("request_mod",e,function(e){e?($("#mod_request_sent").text("Request sent"),$("#mod_request_sent").hasClass("base_green_color")||($("#mod_request_sent").removeClass("base_red_color"),$("#mod_request_sent").addClass("base_green_color"))):($("#mod_request_sent").text("Limit reached"),$("#mod_request_sent").hasClass("base_red_color")||($("#mod_request_sent").removeClass("base_green_color"),$("#mod_request_sent").addClass("base_red_color"))),$("#mod_request_sent").show("fade","slow",function(){window.setTimeout(function(){$("#mod_request_sent").hide("fade","slow")},1500)})}),r.focus(),r.popover("destroy"),selected_mod=-1})):(r.popover("destroy"),selected_mod=-1)},error:function(){}})}else $(this).popover("destroy"),selected_mod=-1}),$("#admin_input").on("keydown",function(e){if(e.keyCode==13){if(selected_admin!=-1){var t={community_id:$(this).attr("data-community-id"),community_name:$(this).attr("data-community-name"),user_id:$(".suggested_admin").eq(selected_admin).attr("id")};module.socket.emit("request_admin",t,function(e){e==1?($("#admin_request_sent").text("Request sent"),$("#admin_request_sent").hasClass("base_green_color")||($("#admin_request_sent").removeClass("base_red_color"),$("#admin_request_sent").addClass("base_green_color"))):($("#admin_request_sent").text("Limit reached"),$("#admin_request_sent").hasClass("base_red_color")||($("#admin_request_sent").removeClass("base_green_color"),$("#admin_request_sent").addClass("base_red_color"))),$("#admin_request_sent").show("fade","slow",function(){window.setTimeout(function(){$("#admin_request_sent").hide("fade","slow")},1500)})}),$(this).popover("destroy"),$(this).focus(),selected_admin=-1}return!1}if(e.keyCode==38)return $(".popover").length!=0&&selected_admin!=0&&(selected_admin+=1,$(".suggested_admin").css("color",""),$(".suggested_admin").eq(selected_admin).css("color","#57bf4b")),!1;if(e.keyCode==40)return $(".popover").length!=0&&selected_admin!=$(".suggested_admin").length-1&&(selected_admin-=1,$(".suggested_admin").css("color",""),$(".suggested_admin").eq(selected_admin).css("color","#57bf4b")),!1}),$("#admin_input").on("keyup",function(e){if(e.keyCode==32||e.keyCode==13)return!1;if(e.keyCode==38||e.keyCode==40)return!1;var t=$(this).val(),n=$(this).attr("data-community-id");if(t.length>2){var r=$(this);$(this).on("blur",function(){$(".popover").length&&$(this).popover("hide")}),$.ajax({type:"GET",data:{admin:t,community_id:n},url:"//mutualcog.com/community/similar-admin",success:function(e){var t="";$.each(e,function(e,n){t+='<div class="suggested_admin" id="'+n.id+'">'+n.name+"</div>"}),$(".popover").length==0?t&&(r.popover({html:!0}),r.attr("data-content",t),r.popover("show"),$(".suggested_admin").click(function(){var e={community_id:r.attr("data-community-id"),community_name:r.attr("data-community-name"),user_id:$(".suggested_admin").eq(selected_admin).attr("id")};module.socket.emit("request_admin",e,function(e){e?($("#admin_request_sent").text("Request sent"),$("#admin_request_sent").hasClass("base_green_color")||($("#admin_request_sent").removeClass("base_red_color"),$("#admin_request_sent").addClass("base_green_color"))):($("#admin_request_sent").text("Limit reached"),$("#admin_request_sent").hasClass("base_red_color")||($("#admin_request_sent").removeClass("base_green_color"),$("#admin_request_sent").addClass("base_red_color"))),$("#admin_request_sent").show("fade","slow",function(){window.setTimeout(function(){$("#admin_request_sent").hide("fade","slow")},1500)})}),r.focus(),r.popover("destroy"),selected_admin=-1}),selected_admin=-1):t?$(".popover-content").html()!=t&&($(".popover-content").html(t),selected_admin=-1,$(".suggested_admin").off("click"),$(".suggested_admin").click(function(){var e={community_id:r.attr("data-community-id"),community_name:r.attr("data-community-name"),user_id:$(".suggested_admin").eq(selected_admin).attr("id")};module.socket.emit("request_admin",e,function(e){e?($("#admin_request_sent").text("Request sent"),$("#admin_request_sent").hasClass("base_green_color")||($("#admin_request_sent").removeClass("base_red_color"),$("#admin_request_sent").addClass("base_green_color"))):($("#admin_request_sent").text("Limit reached"),$("#admin_request_sent").hasClass("base_red_color")||($("#admin_request_sent").removeClass("base_green_color"),$("#admin_request_sent").addClass("base_red_color"))),$("#admin_request_sent").show("fade","slow",function(){window.setTimeout(function(){$("#admin_request_sent").hide("fade","slow")},1500)})}),r.focus(),r.popover("destroy"),selected_admin=-1})):(r.popover("destroy"),selected_admin=-1)},error:function(){}})}else $(this).popover("destroy"),selected_admin=-1})