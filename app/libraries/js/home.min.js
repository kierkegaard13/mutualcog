function newPmChat(e,t,n,r){if(t==0)var i='<div class="pm_cont pm_visible" id="pm_'+r+'_0" style="visibility:hidden;">';else var i='<div class="pm_cont pm_visible" id="pm_'+e+"_"+t+'" style="visibility:hidden;">';return i+='<div class="pm_header"><div class="'+n+' pm_status"></div><div class="glyphicon glyphicon-remove pm_remove"></div><div class="pm_name">'+r+"</div></div>",i+='<div class="pm_body"><div class="pm_body_mssgs">',i+='</div><div class="pm_body_alerts"> <div class="pm_mssg_alert pm_unseen" style="display:none;">Not seen</div> <div class="pm_mssg_alert pm_typing" style="display:none;">'+r+" is typing...</div> </div></div>",i+='<textarea rows=1 class="pm_text"></textarea>',i+="</div>",i}function validateLogin(e,t){var n=$.ajax({type:"GET",data:{username:e,pass:t},url:"//mutualcog.com/profile/validate-login",async:!1}).responseText;return n==1?($("#user_group").attr("class","form-group"),$("#pass1_group").attr("class","form-group"),$("#username").tooltip("destroy"),1):($("#user_group").attr("class","form-group has-error"),$("#pass1_group").attr("class","form-group has-error"),$("#username").attr("data-original-title","Your username or password is incorrect"),$("#username").tooltip("show"),0)}function validateUser(e){if(e.length<3||e.length>module.max_user_length)return $("#reg_user_group").attr("class","form-group has-error"),$("#reg_username").attr("data-original-title","Username must be between 3 and "+module.max_user_length+" characters"),$("#reg_username").tooltip("show"),0;var t=$.ajax({type:"GET",data:{username:e},url:"//mutualcog.com/profile/validate-username",async:!1}).responseText;return t==2?($("#reg_user_group").attr("class","form-group has-error"),$("#reg_username").attr("data-original-title","That username already exists"),$("#reg_username").tooltip("show"),0):t==3?($("#reg_user_group").attr("class","form-group has-error"),$("#reg_username").attr("data-original-title","Your username must contain at least one character"),$("#reg_username").tooltip("show"),0):($("#reg_user_group").attr("class","form-group"),$("#reg_username").tooltip("destroy"),1)}function validatePasswords(e,t){return e!=t&&t!=""?($("#reg_pass1_group").attr("class","form-group has-error"),$("#pass2_group").attr("class","form-group has-error"),$("#pass2").tooltip("show"),0):(e.length<6||e.length>30)&&t!=""?($("#reg_pass1_group").attr("class","form-group has-error"),$("#pass2_group").attr("class","form-group has-error"),$("#pass").tooltip("show"),0):($("#reg_pass1_group").attr("class","form-group"),$("#pass2_group").attr("class","form-group"),$("#pass2").tooltip("destroy"),$("#reg_pass").tooltip("destroy"),1)}function validateEmail(e){var t=$.ajax({type:"GET",data:{email:e},url:"//mutualcog.com/profile/validate-email",async:!1}).responseText;return t==0?($("#email_group").attr("class","form-group has-error"),$("#email").tooltip("show"),0):($("#email_group").attr("class","form-group"),$("#email").tooltip("destroy"),1)}function cookiesEnabled(){var e=navigator.cookieEnabled;if(e===!1)return!1;if(!document.cookie&&(e===null||!1)){document.cookie="testcookie=1";if(!document.cookie)return!1;document.cookie="testcookie=; expires="+(new Date(0)).toUTCString()}return!0}function validateTag(e){var t=$.ajax({type:"GET",data:{tag:e},url:"//mutualcog.com/tags/validate-name",async:!1}).responseText;return t==1?1:0}module=function(){var e=live=scroll_mod_active=1,t="",n=new Array,r={},i=chat_scroll_timer=typ_cnt=connected=recent=banned=stop_scroll=scroll_button_clicked=scroll_top=0,s=-1;if($(".chat_id").length)var o=$(".chat_id").attr("id").replace("chat_","");else var o="";if($("#up_arr").length)var u=jQuery.parseJSON($("#up_arr").text()),a=jQuery.parseJSON($("#down_arr").text());if(typeof io!="undefined")var f=io.connect("http://localhost:3000/",{query:"sid="+$("#sid").attr("data-sid")+"&serial="+$("#serial_tracker").text()});else var f=$("body");var l=new Array("#228d49","#f52103","#2532f2","#f94f06","#5a24d9","#f8b92d","#38cedb","#050a57"),c=new Array,h=new Array,p=new Array,d=new Array,v=new Array,m=new Array,g=new Array,y=$("#serial_id").text(),b=$("#serial_tracker").text(),w=$("#user_id").text(),E=$("#user_tracker").text(),S=20,x=300,T=1e4,N=2500,C=100,k=1e4;return{crit_len:n,chat_scroll_timer:chat_scroll_timer,max_title_length:x,max_user_length:S,max_static_length:T,max_chat_mssg_length:N,max_description_length:C,max_info_length:k,pm_scroll_inactive:r,connected:connected,recent:recent,typ_cnt:typ_cnt,pm_info:t,focused:e,live:live,title_blinking:i,banned:banned,stop_scroll:stop_scroll,scroll_mod_active:scroll_mod_active,scroll_button_clicked:scroll_button_clicked,scroll_top:scroll_top,clicked_on:s,chat_id:o,upvoted:u,downvoted:a,socket:f,color_arr:l,mems:c,mods:h,admin:p,notifications_top_positions:d,notifications_bottom_positions:v,notifications_top_ids:m,notifications_bottom_ids:g,serial_id:y,serial_tracker:b,user_id:w,user_tracker:E}}(),updateChatTimes=function(){$.each($(".chat_time"),function(e,t){$(this).text(moment.utc($(this).attr("id")).fromNow())}),$(".last_login").length&&$(".last_login").html("<strong>Last login: </strong>"+moment.utc($(".last_login").attr("id")).fromNow())}(),updateTimes=function(){$.each($(".time"),function(e,t){$(this).text(moment.utc($(this).attr("id")).fromNow())})}(),$(window).resize(function(){$(".pm_bar").width()>$(window).width()-150&&$(window).width()>10?(module.crit_len.push($(window).width()),$.each($(".pm_cont"),function(e,t){if($(".pm_cont").eq(e).css("display")!="none")return $(".pm_cont").eq(e).css("display","none"),!1})):$(window).width()>module.crit_len[module.crit_len.length-1]&&$(".pm_cont").eq(0).css("display")=="none"&&$(window).width()>10&&(module.crit_len.pop(),$.each($(".pm_cont"),function(e,t){$(".pm_cont").eq(e).css("display")!="none"&&e>0&&$(".pm_cont").eq(e-1).css("display","")}))}),$(document).ready(function(){module.user_id.length&&(window.setInterval(function(){module.typ_cnt>1?module.typ_cnt--:module.typ_cnt==1&&(module.typ_cnt--,module.socket.emit("not_typing",{pm_id:module.pm_info[2],friend_id:module.pm_info[1],user_id:module.user_id})),module.recent>120?$.ajax({type:"POST",data:{user_id:module.user_id},url:"//mutualcog.com/profile/update-online-status",success:function(){},error:function(){}}):module.recent++},1e3),$(window).on("mousemove",function(){module.recent>120&&module.socket.emit("seen_chats"),module.recent=0})),$(".pm_body").length&&($(".pm_body").mCustomScrollbar({theme:"light-2",callbacks:{onScroll:function(){var e=$(this),t=e.parent().attr("id"),n=this.mcs.draggerTop+e.find(".mCSB_dragger").height();n==e.height()?module.pm_scroll_inactive[t]=0:module.pm_scroll_inactive[t]=1}}}),$(".pm_body").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$(".pm_visible").css("visibility","")},50)),updateChatTimes,updateTimes,setInterval(updateTimes,6e4),setInterval(updateChatTimes,6e4),$.each($(".pm_message"),function(e,t){$(".pm_message").eq(e).attr("title",moment.utc($(".pm_message").eq(e).attr("title")).local().format("hh:mma"))}),$("#mssg_requests").popover({html:!0}),$("#global_requests").popover({html:!0}),$("#friend_requests").popover({html:!0}),$("#mssg_requests").blur(function(){$(this).popover("hide")}),$("#global_requests").blur(function(){$(this).popover("hide")}),$("#friend_requests").blur(function(){$(this).popover("hide")}),$("body").on("click",".mssg_upvote",upvoteMssg),$("body").on("click",".mssg_downvote",downvoteMssg),$("#chat_display").on("click",".toggle_responses",getResponses),$(".chat_content").on("click",".toggle_responses",getStaticResponses),$(".request_btn").on("click",function(){}),$("body").on("click",".request_link",function(){var e=$(this);$.ajax({type:"GET",data:{note_id:$(this).attr("data-request-id")},url:"//mutualcog.com/profile/remove-notification",success:function(){window.location.href=e.attr("data-request-link")}})}),$(".user_tooltip").tooltip(),$(".caret_tooltip").tooltip(),$("body").on("click",".accept_request",function(){var e=$(this).attr("id").split("_"),t=e[1],n=e[2];module.socket.emit("request_answered",{type:t,user_id:n,accepted:1})}),$("body").on("click",".decline_request",function(){var e=$(this).attr("id").split("_"),t=e[1],n=e[2];module.socket.emit("request_answered",{type:t,user_id:n,accepted:0})}),$("body").on("click",".pm_remove",function(){$(this).parent().parent().remove();var e=$(this).parent().parent().attr("id").split("_");return module.socket.emit("leave_pm",{pm_id:e[2],friend_id:e[1]}),!1}),$("body").on("click",".friend_box",function(){var e=$(this).attr("id").replace("friend_box_for_",""),t=$(this).attr("data-friend-id"),n=$(this).attr("data-pm-chat-id"),r=$(this).find("#friend_"+t+"_status").attr("class").replace("friend_status","");if($(".pm_bar").width()<$(window).width()-450)if(n!="0"){var i=newPmChat(t,n,r,e);$(".pm_bar").prepend(i),$.ajax({type:"GET",data:{pm_id:n},url:"//mutualcog.com/chat/pm-log",success:function(r){var i="";$.each(r,function(e,t){t.author_id==module.user_id?i+='<div class="pm_mssg_cont"> <div class="pm_message pull-right" style="background-color:#eee;margin-left:30px;margin-right:5px;" title="'+moment.utc(t.created_at).local().format("hh:mma")+'"> '+t.message+" </div> </div>":i+='<div class="pm_mssg_cont"> <div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(t.created_at).local().format("hh:mma")+'"> '+t.message+" </div> </div>"}),$("#pm_"+t+"_"+n).find(".pm_body_mssgs").append(i),module.socket.emit("join_pm",{friend_id:t,friend_name:e,pm_id:n},function(e){}),$(".pm_body").eq(0).mCustomScrollbar({theme:"light-2",callbacks:{onScroll:function(){var e=$(this),t=e.parent().attr("id"),n=this.mcs.draggerTop+e.find(".mCSB_dragger").height();n==e.height()?module.pm_scroll_inactive[t]=0:module.pm_scroll_inactive[t]=1}}}),$(".pm_body").eq(0).mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$(".pm_visible").css("visibility",""),$("#pm_"+t+"_"+n).find(".pm_text").focus()},50),$(".pm_cont").eq(0).resizable({handles:"nw",ghost:!1,maxHeight:450,maxWidth:400,minHeight:330,minWidth:240,resize:function(e,t){var n=t.size.height,r=t.size.width-10;$(this).css("left","0"),$(this).css("top","0"),$(this).find(".pm_header").width(r),$(this).find(".pm_body").height(n-64),$(this).find(".pm_body").width($(this).find(".pm_header").width()+6),$(this).find(".pm_text").width($(this).find(".pm_header").width()-2)}})},error:function(){}})}else{var i=newPmChat(t,0,r,e);$(".pm_bar").prepend(i),module.socket.emit("join_pm",{friend_id:t,friend_name:e,pm_id:n},function(e){$("#pm_"+e.friend_name+"_0").attr("id","pm_"+e.friend_id+"_"+e.pm_id)}),$(".pm_body").eq(0).mCustomScrollbar({theme:"light-2",callbacks:{onScroll:function(){var e=$(this),t=e.parent().attr("id"),n=this.mcs.draggerTop+e.find(".mCSB_dragger").height();n==e.height()?module.pm_scroll_inactive[t]=0:module.pm_scroll_inactive[t]=1}}}),$(".pm_body").eq(0).mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$(".pm_visible").css("visibility",""),$("#pm_"+t+"_"+n).find(".pm_text").focus()},50),$(".pm_cont").eq(0).resizable({handles:"nw",ghost:!1,maxHeight:450,maxWidth:400,minHeight:330,minWidth:240,resize:function(e,t){var n=t.size.height,r=t.size.width-10;$(this).css("left","0"),$(this).css("top","0"),$(this).find(".pm_header").width(r),$(this).find(".pm_body").height(n-64),$(this).find(".pm_body").width($(this).find(".pm_header").width()+6),$(this).find(".pm_text").width($(this).find(".pm_header").width()-2)}})}else $(".pm_list_footer").length==0?$(".pm_bar").prepend('<div class="dropup pm_list_footer_cont"><div class="pm_list_footer dropdown-toggle" data-toggle="dropdown"><div class="glyphicon glyphicon-comment" style="color:white;float:left;"> ...</div></div><ul class="dropdown-menu pm_dropup" role="menu"><li><a class="switch_pm" href="#" data-friend-id="'+t+'" data-friend-name="'+e+'" data-pm-id="'+n+'" data-status="'+r+'">'+e+"</a></li></ul></div>"):$(".pm_dropup").prepend('<li><a class="switch_pm" href="#" data-friend-id="'+t+'" data-friend-name="'+e+'" data-pm-id="'+n+'" data-status="'+r+'">'+e+"</a></li>")}),$("body").on("click",".switch_pm",function(){$(this).remove();var e=$(".pm_cont").first(),t=e.attr("id").split("_")[1],n=e.attr("id").split("_")[2],r=e.find(".pm_status").attr("class").split(" ")[0],i=e.find(".pm_name").text();$(".pm_dropup").prepend('<li><a class="switch_pm" href="#" data-friend-id="'+t+'" data-friend-name="'+i+'" data-pm-id="'+n+'" data-status="'+r+'">'+i+"</a></li>"),$(".pm_cont").first().css("display","none"),$(".pm_cont").first().css("visibility","hidden");var s=$(this).attr("data-friend-id"),o=$(this).attr("data-pm-id"),u=$(this).attr("data-status"),a=$(this).attr("data-friend-name");if($("#pm_"+s+"_"+o).length==0){var f=newPmChat(s,o,u,a);$(".pm_cont").first().before(f),$.ajax({type:"GET",data:{pm_id:o},url:"//mutualcog.com/chat/pm-log",success:function(e){var t="";$.each(e,function(e,n){n.author_id==module.user_id?t+='<div class="pm_mssg_cont"> <div class="pm_message pull-right" style="background-color:#eee;margin-left:30px;margin-right:5px;" title="'+moment.utc(n.created_at).local().format("hh:mma")+'"> '+n.message+" </div> </div>":t+='<div class="pm_mssg_cont"> <div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(n.created_at).local().format("hh:mma")+'"> '+n.message+" </div> </div>"}),$("#pm_"+s+"_"+o).find(".pm_body_mssgs").append(t),module.socket.emit("join_pm",{friend_id:s,friend_name:a,pm_id:o},function(e){}),$("#pm_"+s+"_"+o).find(".pm_body").mCustomScrollbar({theme:"light-2",callbacks:{onScroll:function(){var e=$(this),t=e.parent().attr("id"),n=this.mcs.draggerTop+e.find(".mCSB_dragger").height();n==e.height()?module.pm_scroll_inactive[t]=0:module.pm_scroll_inactive[t]=1}}}),$("#pm_"+s+"_"+o).find(".pm_body").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$("#pm_"+s+"_"+o).css("visibility",""),$("#pm_"+s+"_"+o).find(".pm_text").focus()},50),$("#pm_"+s+"_"+o).resizable({handles:"nw",ghost:!1,maxHeight:450,maxWidth:400,minHeight:330,minWidth:240,resize:function(e,t){var n=t.size.height,r=t.size.width-10;$(this).css("left","0"),$(this).css("top","0"),$(this).find(".pm_header").width(r),$(this).find(".pm_body").height(n-64),$(this).find(".pm_body").width($(this).find(".pm_header").width()+6),$(this).find(".pm_text").width($(this).find(".pm_header").width()-2)}})},error:function(){}})}else{console.log("hihi");var f=$("#pm_"+s+"_"+o).clone();$("#pm_"+s+"_"+o).remove(),f.css("display",""),$(".pm_cont").first().before(f),$("#pm_"+s+"_"+o).find(".pm_body").mCustomScrollbar({theme:"light-2",callbacks:{onScroll:function(){var e=$(this),t=e.parent().attr("id"),n=this.mcs.draggerTop+e.find(".mCSB_dragger").height();n==e.height()?module.pm_scroll_inactive[t]=0:module.pm_scroll_inactive[t]=1}}}),$("#pm_"+s+"_"+o).find(".pm_body").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$("#pm_"+s+"_"+o).css("visibility",""),$("#pm_"+s+"_"+o).find(".pm_text").focus()},50),$("#pm_"+s+"_"+o).resizable({handles:"nw",ghost:!1,maxHeight:450,maxWidth:400,minHeight:330,minWidth:240,resize:function(e,t){var n=t.size.height,r=t.size.width-10;$(this).css("left","0"),$(this).css("top","0"),$(this).find(".pm_header").width(r),$(this).find(".pm_body").height(n-64),$(this).find(".pm_body").width($(this).find(".pm_header").width()+6),$(this).find(".pm_text").width($(this).find(".pm_header").width()-2)}})}return!1}),$(".pm_cont").resizable({handles:"nw",ghost:!1,maxHeight:450,maxWidth:400,minHeight:330,minWidth:240,resize:function(e,t){var n=t.size.height,r=t.size.width-10;$(this).css("left","0"),$(this).css("top","0"),$(this).find(".pm_header").width(r),$(this).find(".pm_body").height(n-64),$(this).find(".pm_body").width($(this).find(".pm_header").width()+6),$(this).find(".pm_text").width($(this).find(".pm_header").width()-2)}}),$("body").on("click",".pm_header",function(){var e=$(this).parent().attr("id").split("_");$(this).parent().find(".pm_body").css("display")=="none"?(module.socket.emit("maximize_pm",{friend_id:e[1],pm_id:e[2]}),$(this).parent().resizable("enable"),$(this).parent().find(".pm_body").css("display",""),$(this).parent().find(".pm_text").css("display",""),$(this).parent().find(".pm_body").css("visibility","hidden"),$(".pm_body").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$(".pm_body").css("visibility","")},50)):(module.socket.emit("minimize_pm",{friend_id:e[1],pm_id:e[2]}),$(this).parent().css("height")!=""&&($(this).parent().attr("data-expanded-height",$(this).parent().css("height")),$(this).parent().css("height","")),$(this).parent().resizable("disable"),$(this).parent().find(".pm_body").css("display","none"),$(this).parent().find(".pm_text").css("display","none"))})}),upvoteMssg=function(e){e.stopPropagation();var t=$(this).attr("id").replace("mssg_upvote_",""),n="//mutualcog.com/chat/message-upvote";$.ajax({type:"POST",data:{id:t},url:n,success:function(e){e.status==1||e.status==3?(e.status==1?(module.downvoted.splice(module.downvoted.indexOf(t.toString()),1),module.upvoted.push(t.toString())):module.upvoted.push(t.toString()),$("#mssg_cont_"+t).hasClass("mssg_cont")?module.socket.emit("update_votes",{id:t,response:e,responseto:"global"}):module.socket.emit("update_votes",{id:t,response:e,responseto:$("#message").attr("class")}),$("#mssg_upvote_"+t).css("color","#57bf4b"),$("#mssg_downvote_"+t).css("color","")):e.status==2?(module.upvoted.splice(module.upvoted.indexOf(t.toString()),1),$("#mssg_cont_"+t).hasClass("mssg_cont")?module.socket.emit("update_votes",{id:t,response:e,responseto:"global"}):module.socket.emit("update_votes",{id:t,response:e,responseto:$("#message").attr("class")}),$("#mssg_upvote_"+t).css("color",""),$("#mssg_downvote_"+t).css("color","")):$("#mssg_upvote_"+t).tooltip("show")},error:function(){}})},downvoteMssg=function(e){e.stopPropagation();var t=$(this).attr("id").replace("mssg_downvote_",""),n="//mutualcog.com/chat/message-downvote";$.ajax({type:"POST",data:{id:t},url:n,success:function(e){e.status==1||e.status==3?(e.status==1?(module.upvoted.splice(module.downvoted.indexOf(t.toString()),1),module.downvoted.push(t.toString())):module.downvoted.push(t.toString()),$("#mssg_cont_"+t).hasClass("mssg_cont")?module.socket.emit("update_votes",{id:t,response:e,responseto:"global"}):module.socket.emit("update_votes",{id:t,response:e,responseto:$("#message").attr("class")}),$("#mssg_downvote_"+t).css("color","red"),$("#mssg_upvote_"+t).css("color","")):e.status==2?(module.downvoted.splice(module.downvoted.indexOf(t.toString()),1),$("#mssg_cont_"+t).hasClass("mssg_cont")?module.socket.emit("update_votes",{id:t,response:e,responseto:"global"}):module.socket.emit("update_votes",{id:t,response:e,responseto:$("#message").attr("class")}),$("#mssg_upvote_"+t).css("color",""),$("#mssg_downvote_"+t).css("color","")):$("#mssg_downvote_"+t).tooltip("show")},error:function(){}})},module.socket.on("updateVotes",function(e){$("#mssg_votes_"+e.message_id).text(e.response.upvotes)}),$("#login_form").submit(function(){var e=$("#username").val(),t=$("#pass").val();if(e.length>0&&t.length>0){var n=validateLogin(e,t);if(!n)return!1}return!0}),$("#reg_username").blur(function(){var e=$("#reg_username").val();if(e.length>0)var t=validateUser(e)}),$("#pass2").blur(function(){var e=$("#reg_pass").val(),t=$("#pass2").val();if(e.length>0&&t.length>0)var n=validatePasswords(e,t)}),$("#register_form").submit(function(){var e=$("#reg_username").val(),t=$("#reg_pass").val(),n=$("#pass2").val(),r=$("#email").val();if(e.length>0&&t.length>0&&n.length>0){var i=validateUser(e);if(!i)return!1;var i=validatePasswords(t,n);if(!i)return!1;if(r.length>0){var i=validateEmail(r);if(!i)return!1}return!0}return e.length==0&&$("#reg_user_group").attr("class","form-group has-error"),t.length==0&&$("#reg_pass1_group").attr("class","form-group has-error"),n.length==0&&$("#pass2_group").attr("class","form-group has-error"),$("#reg_username").attr("data-original-title","Please enter both a username and a confirmed password"),$("#reg_username").tooltip("show"),!1}),$(".modal").on("hide.bs.modal",function(){$(".form-control").tooltip("destroy")}),$("#tag_dropdown").on("click",function(e){e.stopPropagation()}),$("#search_input").on("focus",function(e){e.stopPropagation(),$("#search_input").val()==""&&$("#tag_dropdown").html(""),$(this).dropdown(),$("#tag_dropdown").show()});var selected_term=-1;$("#search_input").on("keydown",function(e){if(e.keyCode==13)return selected_term!=-1&&location.assign($("li#search_"+selected_term).children("a").attr("href")),!1;if(e.keyCode==38)return selected_term!=0&&(selected_term--,$(".tag_results").css("background-color",""),$("li#search_"+selected_term).css("background-color","#ddd")),!1;if(e.keyCode==40)return selected_term!=$(".tag_results").length-1&&(selected_term++,$(".tag_results").css("background-color",""),$("li#search_"+selected_term).css("background-color","#ddd")),!1}),$("#search_input").on("keyup",function(e){var t=$(this).val();if(e.keyCode==13)return!1;e.keyCode!=38&&e.keyCode!=40&&(t.length>2?$.ajax({type:"GET",data:{tag:t},url:"//mutualcog.com/tags/similar-entity",success:function(e){var t="",n=0,r=0;$.each(e,function(e,i){i.type=="tag"?(r==0&&(t+='<div class="search_res_type">Tags</div>',r++),t+='<li id="search_'+e+'" class="tag_results"><a href="//mutualcog.com/t/'+i.name+'">'+i.name+"</a></li>"):(n==0&&(t+='<div class="search_res_type">Users</div>',n++),t+='<li id="search_'+e+'" class="tag_results"><a href="//mutualcog.com/u/'+i.name+'">'+i.name+"</a></li>")}),t?($("#tag_dropdown").show(),$("#tag_dropdown").html()!=t&&($("#tag_dropdown").html(t),selected_term=-1)):($("#tag_dropdown").hide(),selected_term=-1)},error:function(){}}):$("#tag_dropdown").html(""))}),$(window).on("blur",function(){module.focused=0,module.user_id.length&&(module.recent+=110)}),$(window).on("focus",function(){module.focused=1,module.user_id.length&&(module.recent>120&&module.socket.emit("seen_chats"),module.recent=0)}),module.socket.on("receive_pm",function(e){var t=$("#pm_"+e.friend_id+"_"+e.pm_id);if(e.state==0){var n=$("#friend_"+e.friend_id+"_status").attr("class").replace("friend_status","");$.ajax({type:"GET",data:{pm_id:e.pm_id},url:"//mutualcog.com/chat/pm-log",success:function(r){var i='<div class="pm_cont" id="pm_'+e.friend_id+"_"+e.pm_id+'">';i+='<div class="pm_header"><div class="'+n+' pm_status"></div><div class="glyphicon glyphicon-remove pm_remove"></div><div class="pm_name">'+e.friend_name+"</div></div>",i+='<div class="pm_body"><div class="pm_body_mssgs">',$.each(r,function(e,t){t.author_id==module.user_id?i+='<div class="pm_mssg_cont"> <div class="pm_message pull-right" style="background-color:#eee;margin-left:30px;margin-right:5px;" title="'+moment.utc(t.created_at).local().format("hh:mma")+'"> '+t.message+" </div> </div>":i+='<div class="pm_mssg_cont"> <div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(t.created_at).local().format("hh:mma")+'"> '+t.message+" </div> </div>"}),i+='</div><div class="pm_body_alerts"> <div class="pm_mssg_alert pm_unseen" style="display:none;">Not seen</div> <div class="pm_mssg_alert pm_typing" style="display:none;">'+e.friend_name+" is typing...</div> </div></div>",i+='<textarea rows=1 class="pm_text"></textarea>',i+="</div>",$(".pm_bar").prepend(i);var s='<div class="pm_mssg_cont">';s+='<div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(e.time).local().format("hh:mma")+'">'+e.message+"</div>",s+="</div>",t=$("#pm_"+e.friend_id+"_"+e.pm_id),t.find(".pm_body_mssgs").append(s);if(module.pm_scroll_inactive[t.attr("id")]==0||!(t.attr("id")in module.pm_scroll_inactive)){var o=t.find(".pm_body");window.setTimeout(function(){o.mCustomScrollbar("scrollTo","bottom",{scrollInertia:0})},20)}},error:function(){}})}else if(e.state==2){t.resizable("enable"),t.parent().find(".pm_body").css("display",""),t.parent().find(".pm_text").css("display","");var r='<div class="pm_mssg_cont">';r+='<div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(e.time).local().format("hh:mma")+'">'+e.message+"</div>",r+="</div>",t.find(".pm_body_mssgs").append(r)}else{var r='<div class="pm_mssg_cont">';r+='<div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(e.time).local().format("hh:mma")+'">'+e.message+"</div>",r+="</div>",t.find(".pm_body_mssgs").append(r)}if(module.pm_scroll_inactive[t.attr("id")]==0||!(t.attr("id")in module.pm_scroll_inactive)){var i=t.find(".pm_body");window.setTimeout(function(){i.mCustomScrollbar("scrollTo","bottom",{scrollInertia:0})},20)}}),module.socket.on("displayFriendRequests",function(e){var t=$("#friend_requests_count");t.text().length>0?t.text(parseInt(t.text())+1):($("#friend_request_glyph").addClass("pull-left"),t.text("1")),$("#friend_requests").attr("data-content").indexOf("No friend requests")>=0?$("#friend_requests").attr("data-content",e.message):$("#friend_requests").attr("data-content",$("#friend_requests").attr("data-content").prepend(e.message))}),module.socket.on("displayGlobalRequests",function(e){var t=$("#global_requests_count");t.text().length>0?t.text(parseInt(t.text())+1):($("#global_request_glyph").addClass("pull-left"),t.text("1")),$("#global_requests").attr("data-content").indexOf("No global requests")>=0?$("#global_requests").attr("data-content",e.message):$("#global_requests").attr("data-content",$("#global_requests").attr("data-content").prepend(e.message))}),module.socket.on("chat_seen",function(e){var t=$("#pm_"+e.friend_id+"_"+e.pm_id);t.find(".pm_unseen").hide()}),module.socket.on("is_typing",function(e){var t=$("#pm_"+e.friend_id+"_"+e.pm_id);t.find(".pm_typing").show()}),module.socket.on("not_typing",function(e){var t=$("#pm_"+e.friend_id+"_"+e.pm_id);t.find(".pm_typing").hide()});var pm_keys=new Array;$("body").on("cut",".pm_text",function(e){var t=$(this),n=this;window.setTimeout(function(){t.height(0),t.height(n.scrollHeight-10)},0)}),$("body").on("paste",".pm_text",function(e){var t=$(this),n=this;window.setTimeout(function(){t.height(0),t.height(n.scrollHeight-10)},0)}),$("body").on("keydown",".pm_text",function(e){pm_keys.push(e.which);var t=$(this),n=this;window.setTimeout(function(){t.height(0),t.height(n.scrollHeight-10)},0)}),$("body").on("keyup",".pm_text",function(e){module.pm_info=$(this).parent().attr("id").split("_");var t=$(this).parents(".pm_cont");module.user_id.length&&(module.recent>120&&module.socket.emit("seen_chats"),module.recent=0);if(e.which==13)if(pm_keys.indexOf(16)==-1){pm_keys.splice(pm_keys.indexOf(e.which),1),module.typ_cnt>0&&module.socket.emit("not_typing",{pm_id:module.pm_info[2],friend_id:module.pm_info[1],user_id:module.user_id});if($(this).val().trim()!=""){module.socket.emit("send_pm",{message:$(this).val(),pm_id:module.pm_info[2],friend_id:module.pm_info[1],user_id:module.user_id},function(e){var t=$("#pm_"+e.friend_id+"_"+e.pm_id),n=t.find(".tmp_message");n.find(".pm_message").html(e.message),n.attr("class",n.attr("class").replace("tmp_message","")),e.unseen&&t.find(".pm_unseen").show()}),$(this).css("height","");var n='<div class="pm_mssg_cont tmp_message">';n+='<div class="pm_message pull-right" style="background-color:#eee;margin-left:30px;margin-right:5px;" title="'+moment().format("hh:mma")+'">'+$(this).val()+"</div>",n+="</div>",$(this).val(""),$("#pm_"+module.pm_info[1]+"_"+module.pm_info[2]).find(".pm_body_mssgs").append(n);if(module.pm_scroll_inactive[t.attr("id")]==0||!(t.attr("id")in module.pm_scroll_inactive)){var r=t.find(".pm_body");window.setTimeout(function(){r.mCustomScrollbar("scrollTo","bottom",{scrollInertia:0})},20)}}module.typ_cnt=0}else module.typ_cnt==0&&module.socket.emit("is_typing",{pm_id:module.pm_info[2],friend_id:module.pm_info[1],user_id:module.user_id}),pm_keys.splice(keys.indexOf(e.which),1),module.typ_cnt=4;else module.typ_cnt==0&&module.socket.emit("is_typing",{pm_id:module.pm_info[2],friend_id:module.pm_info[1],user_id:module.user_id}),pm_keys.splice(pm_keys.indexOf(e.which),1),module.typ_cnt=4;return!0}),module.socket.on("softDelete",function(e){$("#message_"+e.id+".chat_mssg").length&&($(".mssg_icon").tooltip("hide"),$(".mssg_icon").tooltip(),$("#message_"+e.id+".chat_mssg").find(".mssg_body").html("<strong class='mssg_op' id='"+e.user+"' style='color:"+module.color_arr[e.mssg_serial%7]+";'>"+e.user+" (<span class='response_count' id='"+e.id+"'>"+e.responses+"</span>)</strong> : <em>This message has been deleted</em>"))}),deleteIt=function(e){e.stopPropagation();var t=$(this).parents(".chat_mssg").first().attr("id").replace("message_","");$("#logged_in").text()==1?module.socket.emit("delete_message",{id:t,user:module.user_tracker,serial:$(this).attr("data-mssg-serial"),responses:$(this).parent().find(".response_count").text()}):module.socket.emit("delete_message",{id:t,user:module.serial_tracker,serial:$(this).attr("data-mssg-serial"),responses:$(this).parent().find(".response_count").text()})},getResponses=function(e){e.stopPropagation();var t=$(this).attr("id").replace("toggle_","");$(this).hasClass("dropup")?($(this).removeClass("dropup"),$(this).find(".caret").attr("data-original-title","Hide Responses"),$("#mssg_cont_"+t).children(".mssg_cont").show()):($(this).addClass("dropup"),$(this).find(".caret").attr("data-original-title","Show Responses"),$("#mssg_cont_"+t).children(".mssg_cont").hide())},getStaticResponses=function(e){e.stopPropagation();var t=$(this).attr("id").replace("toggle_","");$(this).hasClass("dropup")?($(this).removeClass("dropup"),$(this).find(".caret").attr("data-original-title","Hide Responses"),$("#mssg_cont_"+t).find(".mssg_cont").show()):($(this).addClass("dropup"),$(this).find(".caret").attr("data-original-title","Show Responses"),$("#mssg_cont_"+t).find(".mssg_cont").hide())};var selected_tag=-1,selected_mod=-1,selected_admin=-1;$(document).ready(function(){$(".chat_status_indicator").tooltip(),$(".advanced_cog").tooltip(),$("#pause_chat").tooltip(),$(".chat_content").on("click",".mssg_icon",deleteIt),$(".glyphicon-info-sign").tooltip(),$.each($(".interaction_time"),function(e,t){$(this).text(moment.utc($(this).attr("id")).fromNow())}),$("body").on("click",".p_chat_mssg",function(){var e=$(this).find(".p_mssg_body").attr("class").split(" ")[0].split("_")[2],t=$(this).attr("id");window.location.href="//mutualcog.com/chat/static/"+e+"/"+t}),$(".load_more").on("click",function(){var e=$(this).attr("href"),t=$(this).parent(),n=$(this);return $.ajax({type:"GET",url:e,success:function(e){var r=e.length,i=e.upvoted,s=e.downvoted,o=0;delete e.upvoted,delete e.downvoted,n.remove();var u="";$.each(e,function(e,t){u+='<div class="response_to_'+t.responseto+" mssg_cont y_"+t.y_dim+" parent_"+t.parent+' pad_l_10" id="mssg_cont_'+t.id+'">',u+='<div class="mssg_cont_inner"><div class="chat_mssg" id="message_'+t.id+'"> <div class="row" style="margin:0;"> <div class="mssg_body_cont"> <div class="chat_vote_box">',i.indexOf(t.id)!=-1?u+='<span class="glyphicon glyphicon-chevron-up mssg_upvote" id="mssg_upvote_'+t.id+'" style="color:#57bf4b" data-toggle="tooltip" data-original-title="You must be logged in to vote on responses" data-container="body" data-placement="top"></span> <div class="upvote_count" id="mssg_votes_'+t.id+'">'+(t.upvotes-t.downvotes)+'</div> <span class="glyphicon glyphicon-chevron-down mssg_downvote" id="mssg_downvote_'+t.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on responses" data-container="body" data-placement="bottom"></span></div>':s.indexOf(t.id)!=-1?u+='<span class="glyphicon glyphicon-chevron-up mssg_upvote" id="mssg_upvote_'+t.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on responses" data-container="body" data-placement="top"></span> <div class="upvote_count" id="mssg_votes_'+t.id+'">'+(t.upvotes-t.downvotes)+'</div> <span class="glyphicon glyphicon-chevron-down mssg_downvote" id="mssg_downvote_'+t.id+'" style="color:red;" data-toggle="tooltip" data-original-title="You must be logged in to vote on responses" data-container="body" data-placement="bottom"></span></div>':u+='<span class="glyphicon glyphicon-chevron-up mssg_upvote" id="mssg_upvote_'+t.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on responses" data-container="body" data-placement="top"></span> <div class="upvote_count" id="mssg_votes_'+t.id+'">'+(t.upvotes-t.downvotes)+'</div> <span class="glyphicon glyphicon-chevron-down mssg_downvote" id="mssg_downvote_'+t.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on responses" data-container="body" data-placement="bottom"></span></div>',u+='<div class="mssg_body author_'+t.author+'">',u+='<div id="toggle_'+t.id+'" class="toggle_responses"> <span class="caret caret_tooltip" id="caret_'+t.id+'" data-toggle="tooltip" data-original-title="Hide Responses" data-container="body" data-placement="top"></span> </div>',t.message!="This response has been deleted"&&(module.serial_tracker==t.author||module.user_tracker==t.author)&&(u+='<span id="remove_'+t.id+'" class="glyphicon glyphicon-remove mssg_icon" data-mssg-serial="'+t.serial+'" style="margin-right:5px;" data-toggle="tooltip" title="Delete post" data-container="body" data-placement="top"></span>'),t.author==$("#chat_admin_info").text()&&(u+='<span class="glyphicon glyphicon-star"></span>'),u+='<strong class="mssg_op" data-author="'+t.author+'" style="color:'+module.color_arr[t.serial%7]+'"> '+t.author+' (<span class="response_count" id="'+t.id+'">'+t.responses+"</span>)</strong> : "+t.message,u+='<div class="time_box">',$(".chat_status_indicator").hasClass("glyphicon-pause")&&(u+='<div class="reply"><a href="#" class="reply_link" data-mssg-id="'+t.id+'"><strong>Reply</strong></a></div>'),u+='<div class="time" id="'+t.created_at+'" title="'+t.created_at+' UTC">'+moment.utc(t.created_at).fromNow()+"</div></div>",u+="</div></div></div></div>";if(t.responses==0)if(t.y_dim==o||e==0)u+="</div></div>";else for(var n=0;n<o-t.y_dim;n++)u+="</div></div>";o=t.y_dim}),t.append(u)},error:function(){}}),!1});var e=$("#reply_form").clone();$(".remove_mod").tooltip(),$("#request_friend").click(function(){module.socket.emit("request_friend",{user_id:$(this).attr("data-user-id"),user:$(this).attr("data-user-name"),sender_id:module.user_id,sender:module.user_tracker}),$(this).removeClass("btn-primary"),$(this).addClass("btn-success"),$(this).html('<div class="glyphicon glyphicon-check" id="request_glyph"></div> Request Sent'),$(this).off("click")}),$("a#advanced_create").click(function(e){return $("#advanced_modal").modal(),!1}),$("a#tag_edit").click(function(e){var t=$(this).parents(".side_content");return $("#input_tag_id").val(t.find("#tag_id_str").text()),$("#input_tag_info").val(t.find("#tag_info_str").text()),$("#input_tag_desc").val(t.find("#tag_desc_str").text()),$("#tag_edit_modal").modal(),!1}),$("a.edit_chat_link").click(function(e){var t=$(this).parents(".chat_title_box");return $("#Title_v3").val(t.find(".chat_title_str").text()),$("#Link_v3").val(t.find(".chat_link_str").text()),$("#Tags_v3").val(t.find(".chat_tag_str").text()),$("#description_v3").val(t.find(".chat_desc_str").text()),$("#form_chat_id").val(t.find(".chat_id_str").text()),console.log(t.find(".chat_live_str").text()+" : "+t.find(".chat_nsfw_str").text()),t.find(".chat_live_str").text()?$("#live_status_v3").prop("checked","true"):$("#live_status_v3").prop("checked","false"),t.find(".chat_nsfw_str").text()?(console.log("hooray"),$("#nsfw_v3").prop("checked","true")):$("#nsfw_v3").prop("checked","false"),$("#edit_modal").modal(),!1}),$(".remove_mod").click(function(e){var t=$(this).attr("id").split("_")[3],n=$(this).attr("id").split("_")[2];window.location.href="//mutualcog.com/tags/remove-mod/"+n+"/"+t}),$("a.remove_chat_link").click(function(e){return $("#remove_modal").modal(),$("#remove_chat_final").attr("href",$(this).attr("data-remove-link")),!1}),$(".reply_link").on("click",function(){return $("#message_"+$(this).attr("data-mssg-id")).find("#reply_form_"+$(this).attr("data-mssg-id")).length?($("#message_"+$(this).attr("data-mssg-id")).find("#reply_form_"+$(this).attr("data-mssg-id")).toggle(),$(this).children().text()=="Reply"?$(this).children().text("Cancel"):$(this).children().text("Reply")):($(this).html("<strong>Cancel</strong>"),e=$("#reply_form").clone(),$("#message_"+$(this).attr("data-mssg-id")).append(e),$("#message_"+$(this).attr("data-mssg-id")).find("#reply_form").attr("id","reply_form_"+$(this).attr("data-mssg-id")),$("#reply_form_"+$(this).attr("data-mssg-id")).children("#reply_to").val($(this).attr("data-mssg-id"))),!1}),$("body").on("submit",".reply_forms",function(){module.socket.emit("notify_response",$(this).children("#reply_to").val())})}),module.socket.on("connect",function(){console.log("Client has connected"),module.connected=1,module.chat_id&&module.socket.emit("room",module.chat_id)}),$("#home_form_v2").submit(function(){if(cookiesEnabled()){var e=$("#Title_v2").val(),t=$("#Link_v2").val(),n=$("#Tags_v2").val(),r=$("#description").val();return $(".form_error").hide(),$(".form-group").attr("class","form-group"),e.length<5||e.length>module.max_title_length?($("#Title_v2").attr("data-original-title","Title must be between 5 and "+module.max_title_length+" characters"),$("#Title_v2").tooltip("show"),$("#title_group_v2").attr("class","form-group has-error"),!1):n.split(" ")[0]==""||n.split(" ").length>5?($("#tags_group_v2").attr("class","form-group has-error"),$("#Tags_v2").attr("data-original-title","Must have at least 1 tag but less than 6"),$("#Tags_v2").tooltip({placement:"bottom",trigger:"focus"}),$("#Tags_v2").tooltip("show"),!1):(n=n.split(" "),$.each(n,function(e,t){t=t.substr(1);if((t.length<3||t.length>20)&&t.length!=0)return $("#tags_group_v2").attr("class","form-group has-error"),$("#Tags_v2").attr("data-original-title","Tags must be between 3 and 20 characters"),$("#Tags_v2").tooltip({placement:"bottom",trigger:"focus"}),$("#Tags_v2").tooltip("show"),!1}),r.length>module.max_static_length&&($("#description_group").attr("class","form-group has-error"),$("#description").tooltip("show")),$("#home_form_v2").append('<input type="hidden" name="js_key" value="js_enabled" id="js_key">'),!0)}return $("#Title_v2").attr("data-original-title","You must enable cookies to post chats"),$("#Title_v2").tooltip("show"),!1}),$("#home_form_v3").submit(function(){var e=$("#Title_v3").val(),t=$("#Link_v3").val(),n=$("#Tags_v3").val(),r=$("#description_v3").val();return $(".form_error").hide(),$(".form-group").attr("class","form-group"),e.length<5||e.length>module.max_title_length?($("#Title_v3").attr("data-original-title","Title must be between 5 and "+module.max_title_length+" characters"),$("#Title_v3").tooltip("show"),$("#title_group_v3").attr("class","form-group has-error"),!1):n.split(" ")[0]==""||n.split(" ").length>5?($("#tags_group_v3").attr("class","form-group has-error"),$("#Tags_v3").attr("data-original-title","Must have at least 1 tag but less than 6"),$("#Tags_v3").tooltip({placement:"bottom",trigger:"focus"}),$("#Tags_v3").tooltip("show"),!1):(n=n.split(" "),$.each(n,function(e,t){t=t.substr(1);if((t.length<3||t.length>20)&&t.length!=0)return $("#tags_group_v3").attr("class","form-group has-error"),$("#Tags_v3").attr("data-original-title","Tags must be between 3 and 20 characters"),$("#Tags_v3").tooltip({placement:"bottom",trigger:"focus"}),$("#Tags_v3").tooltip("show"),!1}),r.length>module.max_static_length&&($("#description_group_v3").attr("class","form-group has-error"),$("#description_v3").tooltip("show")),$("#home_form_v3").append('<input type="hidden" name="js_key" value="js_enabled" id="js_key">'),!0)}),$("#tag_edit_form").submit(function(){var e=$("#edit_tag_desc").val(),t=$("#edit_tag_info").val();return e.length>module.max_static_length?($("#tag_desc_group").attr("class","form-group has-error"),$("#edit_tag_desc").tooltip("show"),!1):t.length>module.max_info_length?($("#tag_info_group").attr("class","form-group has-error"),$("#edit_tag_info").tooltip("show"),!1):!0}),$("#tag_create_form").submit(function(){var e=$("#create_tag_name").val(),t=$("#create_tag_desc").val(),n=$("#create_tag_info").val();return e.length<3||e.length>20?($("#create_name_group").attr("class","form-group has-error"),$("#create_tag_name").attr("data-original-title","Tags must be between 3 and 20 characters"),$("#create_tag_name").tooltip("show"),!1):validateTag(e)?t.length>module.max_static_length?($("#create_desc_group").attr("class","form-group has-error"),$("#create_tag_desc").tooltip("show"),!1):n.length>module.max_info_length?($("#create_info_group").attr("class","form-group has-error"),$("#create_tag_info").tooltip("show"),!1):!0:($("#create_name_group").attr("class","form-group has-error"),$("#create_tag_name").attr("data-original-title","Tags must be unique"),$("#create_tag_name").tooltip("show"),!1)}),$(".big_upvote").click(function(e){e.stopPropagation();var t=$(this).attr("id"),n=$(this).attr("id").replace("upvote_",""),r="//mutualcog.com/chat/upvote";$.ajax({type:"POST",data:{id:n},url:r,success:function(e){e.status==1||e.status==3?($("#votes_"+n).text(e.upvotes),$("#upvote_"+n).css("color","#57bf4b"),$("#downvote_"+n).css("color","")):e.status==2?($("#votes_"+n).text(e.upvotes),$("#upvote_"+n).css("color",""),$("#downvote_"+n).css("color","")):$("#"+t).tooltip("show")},error:function(){}})}),$(".big_downvote").click(function(e){e.stopPropagation();var t=$(this).attr("id"),n=$(this).attr("id").replace("downvote_",""),r="//mutualcog.com/chat/downvote";$.ajax({type:"POST",data:{id:n},url:r,success:function(e){e.status==1||e.status==3?($("#votes_"+n).text(e.upvotes),$("#downvote_"+n).css("color","red"),$("#upvote_"+n).css("color","")):e.status==2?($("#votes_"+n).text(e.upvotes),$("#upvote_"+n).css("color",""),$("#downvote_"+n).css("color","")):$("#"+t).tooltip("show")},error:function(){}})}),$(window).on("click",function(e){$("#tag_dropdown").hide()}),$(".tags_input").on("keydown",function(e){if(e.keyCode==13){if(selected_tag!=-1){var t=$(this).val().split(" ");return t.pop(),t.push("#"+$(".suggested_tags").eq(selected_tag).text()),$(this).val(t.join(" ")+" #"),$(this).focus(),!1}return!1}if(e.keyCode==38){if($(".popover").length!=0)return selected_tag!=0&&(selected_tag-=1,$(".suggested_tags").css("color",""),$(".suggested_tags").eq(selected_tag).css("color","#57bf4b")),!1}else if(e.keyCode==40&&$(".popover").length!=0)return selected_tag!=$(".suggested_tags").length-1&&(selected_tag+=1,$(".suggested_tags").css("color",""),$(".suggested_tags").eq(selected_tag).css("color","#57bf4b")),!1}),$(".tags_input").on("keyup",function(e){if(e.keyCode==32)if($(this).val().length==1)$(this).val("");else{var t=$(this).val().split(" "),n=new Array;$.each(t,function(e,t){t=t.replace("#",""),n.push("#"+t)}),$(this).val(n.join(" ")),$(this).popover("destroy"),selected_tag=-1}else if(e.keyCode!=38&&e.keyCode!=40){var r=$(this).val().split(" ");r=r.pop().replace("#","");if(r.length>2){var i=$(this);$(this).on("blur",function(){$(".popover").length&&$(this).popover("hide")}),$.ajax({type:"GET",data:{tag:r.slice(0,-1)},url:"//mutualcog.com/tags/similar-tag",success:function(e){var t="";$.each(e,function(e,n){t+='<div class="suggested_tags" id="'+n.id+'">'+n.name+"</div>"}),$(".popover").length==0?t&&(i.popover({html:!0}),i.attr("data-content",t),i.popover("show"),$(".suggested_tags").click(function(){var e=$(".tags_input").val().split(" ");e.pop(),e.push("#"+$(this).text()),i.val(e.join(" ")+" #"),i.focus(),i.popover("destroy"),selected_tag=-1}),selected_tag=-1):t?$(".popover-content").html()!=t&&($(".popover-content").html(t),selected_tag=-1,$(".suggested_tags").off("click"),$(".suggested_tags").click(function(){var e=$(".tags_input").val().split(" ");e.pop(),e.push("#"+$(this).text()),i.val(e.join(" ")+" #"),i.focus(),i.popover("destroy"),selected_tag=-1})):(i.popover("destroy"),selected_tag=-1)},error:function(){}})}else $(this).popover("destroy"),selected_tag=-1}}),$("#mod_input").on("keydown",function(e){if(e.keyCode==13){if(selected_mod!=-1){var t={tag_id:$(this).attr("data-tag-id"),tag_name:$(this).attr("data-tag-name"),user_id:$(".suggested_mods").eq(selected_mod).attr("id")};module.socket.emit("request_mod",t,function(e){e==1?($("#mod_request_sent").text("Request sent"),$("#mod_request_sent").hasClass("base_green_color")||($("#mod_request_sent").removeClass("base_red_color"),$("#mod_request_sent").addClass("base_green_color"))):($("#mod_request_sent").text("Limit reached"),$("#mod_request_sent").hasClass("base_red_color")||($("#mod_request_sent").removeClass("base_green_color"),$("#mod_request_sent").addClass("base_red_color"))),$("#mod_request_sent").show("fade","slow",function(){window.setTimeout(function(){$("#mod_request_sent").hide("fade","slow")},1500)})}),$(this).popover("destroy"),$(this).focus(),selected_mod=-1}return!1}if(e.keyCode==38)return $(".popover").length!=0&&selected_mod!=0&&(selected_mod+=1,$(".suggested_mods").css("color",""),$(".suggested_mods").eq(selected_mod).css("color","#57bf4b")),!1;if(e.keyCode==40)return $(".popover").length!=0&&selected_mod!=$(".suggested_mods").length-1&&(selected_mod-=1,$(".suggested_mods").css("color",""),$(".suggested_mods").eq(selected_mod).css("color","#57bf4b")),!1}),$("#mod_input").on("keyup",function(e){if(e.keyCode==32||e.keyCode==13)return!1;if(e.keyCode==38||e.keyCode==40)return!1;var t=$(this).val(),n=$(this).attr("data-tag-id");if(t.length>2){var r=$(this);$(this).on("blur",function(){$(".popover").length&&$(this).popover("hide")}),$.ajax({type:"GET",data:{mod:t,tag_id:n},url:"//mutualcog.com/tags/similar-mod",success:function(e){var t="";$.each(e,function(e,n){t+='<div class="suggested_mods" id="'+n.id+'">'+n.name+"</div>"}),$(".popover").length==0?t&&(r.popover({html:!0}),r.attr("data-content",t),r.popover("show"),$(".suggested_mods").click(function(){var e={tag_id:r.attr("data-tag-id"),tag_name:r.attr("data-tag-name"),user_id:$(".suggested_mods").eq(selected_mod).attr("id")};module.socket.emit("request_mod",e,function(e){e?($("#mod_request_sent").text("Request sent"),$("#mod_request_sent").hasClass("base_green_color")||($("#mod_request_sent").removeClass("base_red_color"),$("#mod_request_sent").addClass("base_green_color"))):($("#mod_request_sent").text("Limit reached"),$("#mod_request_sent").hasClass("base_red_color")||($("#mod_request_sent").removeClass("base_green_color"),$("#mod_request_sent").addClass("base_red_color"))),$("#mod_request_sent").show("fade","slow",function(){window.setTimeout(function(){$("#mod_request_sent").hide("fade","slow")},1500)})}),r.focus(),r.popover("destroy"),selected_mod=-1}),selected_mod=-1):t?$(".popover-content").html()!=t&&($(".popover-content").html(t),selected_mod=-1,$(".suggested_mods").off("click"),$(".suggested_mods").click(function(){var e={tag_id:r.attr("data-tag-id"),tag_name:r.attr("data-tag-name"),user_id:$(".suggested_mods").eq(selected_mod).attr("id")};module.socket.emit("request_mod",e,function(e){e?($("#mod_request_sent").text("Request sent"),$("#mod_request_sent").hasClass("base_green_color")||($("#mod_request_sent").removeClass("base_red_color"),$("#mod_request_sent").addClass("base_green_color"))):($("#mod_request_sent").text("Limit reached"),$("#mod_request_sent").hasClass("base_red_color")||($("#mod_request_sent").removeClass("base_green_color"),$("#mod_request_sent").addClass("base_red_color"))),$("#mod_request_sent").show("fade","slow",function(){window.setTimeout(function(){$("#mod_request_sent").hide("fade","slow")},1500)})}),r.focus(),r.popover("destroy"),selected_mod=-1})):(r.popover("destroy"),selected_mod=-1)},error:function(){}})}else $(this).popover("destroy"),selected_mod=-1}),$("#admin_input").on("keydown",function(e){if(e.keyCode==13){if(selected_admin!=-1){var t={tag_id:$(this).attr("data-tag-id"),tag_name:$(this).attr("data-tag-name"),user_id:$(".suggested_admin").eq(selected_admin).attr("id")};module.socket.emit("request_admin",t,function(e){e==1?($("#admin_request_sent").text("Request sent"),$("#admin_request_sent").hasClass("base_green_color")||($("#admin_request_sent").removeClass("base_red_color"),$("#admin_request_sent").addClass("base_green_color"))):($("#admin_request_sent").text("Limit reached"),$("#admin_request_sent").hasClass("base_red_color")||($("#admin_request_sent").removeClass("base_green_color"),$("#admin_request_sent").addClass("base_red_color"))),$("#admin_request_sent").show("fade","slow",function(){window.setTimeout(function(){$("#admin_request_sent").hide("fade","slow")},1500)})}),$(this).popover("destroy"),$(this).focus(),selected_admin=-1}return!1}if(e.keyCode==38)return $(".popover").length!=0&&selected_admin!=0&&(selected_admin+=1,$(".suggested_admin").css("color",""),$(".suggested_admin").eq(selected_admin).css("color","#57bf4b")),!1;if(e.keyCode==40)return $(".popover").length!=0&&selected_admin!=$(".suggested_admin").length-1&&(selected_admin-=1,$(".suggested_admin").css("color",""),$(".suggested_admin").eq(selected_admin).css("color","#57bf4b")),!1}),$("#admin_input").on("keyup",function(e){if(e.keyCode==32||e.keyCode==13)return!1;if(e.keyCode==38||e.keyCode==40)return!1;var t=$(this).val(),n=$(this).attr("data-tag-id");if(t.length>2){var r=$(this);$(this).on("blur",function(){$(".popover").length&&$(this).popover("hide")}),$.ajax({type:"GET",data:{admin:t,tag_id:n},url:"//mutualcog.com/tags/similar-admin",success:function(e){var t="";$.each(e,function(e,n){t+='<div class="suggested_admin" id="'+n.id+'">'+n.name+"</div>"}),$(".popover").length==0?t&&(r.popover({html:!0}),r.attr("data-content",t),r.popover("show"),$(".suggested_admin").click(function(){var e={tag_id:r.attr("data-tag-id"),tag_name:r.attr("data-tag-name"),user_id:$(".suggested_admin").eq(selected_admin).attr("id")};module.socket.emit("request_admin",e,function(e){e?($("#admin_request_sent").text("Request sent"),$("#admin_request_sent").hasClass("base_green_color")||($("#admin_request_sent").removeClass("base_red_color"),$("#admin_request_sent").addClass("base_green_color"))):($("#admin_request_sent").text("Limit reached"),$("#admin_request_sent").hasClass("base_red_color")||($("#admin_request_sent").removeClass("base_green_color"),$("#admin_request_sent").addClass("base_red_color"))),$("#admin_request_sent").show("fade","slow",function(){window.setTimeout(function(){$("#admin_request_sent").hide("fade","slow")},1500)})}),r.focus(),r.popover("destroy"),selected_admin=-1}),selected_admin=-1):t?$(".popover-content").html()!=t&&($(".popover-content").html(t),selected_admin=-1,$(".suggested_admin").off("click"),$(".suggested_admin").click(function(){var e={tag_id:r.attr("data-tag-id"),tag_name:r.attr("data-tag-name"),user_id:$(".suggested_admin").eq(selected_admin).attr("id")};module.socket.emit("request_admin",e,function(e){e?($("#admin_request_sent").text("Request sent"),$("#admin_request_sent").hasClass("base_green_color")||($("#admin_request_sent").removeClass("base_red_color"),$("#admin_request_sent").addClass("base_green_color"))):($("#admin_request_sent").text("Limit reached"),$("#admin_request_sent").hasClass("base_red_color")||($("#admin_request_sent").removeClass("base_green_color"),$("#admin_request_sent").addClass("base_red_color"))),$("#admin_request_sent").show("fade","slow",function(){window.setTimeout(function(){$("#admin_request_sent").hide("fade","slow")},1500)})}),r.focus(),r.popover("destroy"),selected_admin=-1})):(r.popover("destroy"),selected_admin=-1)},error:function(){}})}else $(this).popover("destroy"),selected_admin=-1})