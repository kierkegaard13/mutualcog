function hashHtml(e){return e.replace(/#/,"&#035;")}function emoji(e){var t=["\\&lt\\;3",":\\)",":\\(",":D",":\\&\\#39\\;\\(","spec_face_angr","spec_face_rage",":\\|",":O",":P","T_T"],n={"&lt;3":'<img style="height:18px;" src="//localhost/laravel/app/emoji/heart.png"></img>',":D":'<img style="height:18px;" src="//localhost/laravel/app/emoji/smile.png"></img>',":)":'<img style="height:18px;" src="//localhost/laravel/app/emoji/smiley.png"></img>',":(":'<img style="height:18px;" src="//localhost/laravel/app/emoji/disappointed.png"></img>',":|":'<img style="height:18px;" src="//localhost/laravel/app/emoji/neutral_face.png"></img>',":&#39;(":'<img style="height:18px;" src="//localhost/laravel/app/emoji/cry.png"></img>',":O":'<img style="height:18px;" src="//localhost/laravel/app/emoji/open_mouth.png"></img>',":P":'<img style="height:18px;" src="//localhost/laravel/app/emoji/stuck_out_tongue_closed_eyes.png"></img>',T_T:'<img style="height:18px;" src="//localhost/laravel/app/emoji/sob.png"></img>',spec_face_angr:'<img style="height:18px;" src="//localhost/laravel/app/emoji/angry.png"></img>',spec_face_rage:'<img style="height:18px;" src="//localhost/laravel/app/emoji/rage.png"></img>'},r=new RegExp(t.join("|"),"gi");return e=e.replace(r,function(e){return n[e]}),e}function processMessage(e){var t=/((?:(http|https|Http|Https|rtsp|Rtsp):\/\/(?:(?:[a-zA-Z0-9\$\-\_\.\+\!\*\'\(\)\,\;\?\&\=]|(?:\%[a-fA-F0-9]{2})){1,64}(?:\:(?:[a-zA-Z0-9\$\-\_\.\+\!\*\'\(\)\,\;\?\&\=]|(?:\%[a-fA-F0-9]{2})){1,25})?\@)?)?((?:(?:[a-zA-Z0-9][a-zA-Z0-9\-]{0,64}\.)+(?:(?:aero|arpa|asia|a[cdefgilmnoqrstuwxz])|(?:biz|b[abdefghijmnorstvwyz])|(?:cat|com|coop|c[acdfghiklmnoruvxyz])|d[ejkmoz]|(?:edu|e[cegrstu])|f[ijkmor]|(?:gov|g[abdefghilmnpqrstuwy])|h[kmnrtu]|(?:info|int|i[delmnoqrst])|(?:jobs|j[emop])|k[eghimnrwyz]|l[abcikrstuvy]|(?:mil|mobi|museum|m[acdghklmnopqrstuvwxyz])|(?:name|net|n[acefgilopruz])|(?:org|om)|(?:pro|p[aefghklmnrstwy])|qa|r[eouw]|s[abcdeghijklmnortuvyz]|(?:tel|travel|t[cdfghjklmnoprtvwz])|u[agkmsyz]|v[aceginu]|w[fs]|y[etu]|z[amw]))|(?:(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9])\.(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9]|0)\.(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9]|0)\.(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[0-9])))(?:\:\d{1,5})?)(\/(?:(?:[a-zA-Z0-9\;\/\?\:\@\&\=\#\~\-\.\+\!\*\'\(\)\,\_])|(?:\%[a-fA-F0-9]{2}))*)?(?:\b|$)/gi,n=/(img)(\s)(src\=)/g,r=/\/c\/([^\s]*)(\s*)/g,i=/\/u\/([^\s]*)(\s*)/g,s=/\@([^\s]*)(\s*)/g,o=/\&\#035\;([^\s]*)(\s*)/g,u=new RegExp("^<p>","g"),a=new RegExp("</p>$","g");return e=hashHtml(e),e=e.replace(">:|","spec_face_angr"),e=e.replace(">:(","spec_face_rage"),e=marked(e),e=e.replace(t,"<a class='chat_link' href='//$3$4'>$3$4</a>"),e.length&&(e=e.replace(/^\s+|\s+$/g,""),e=e.replace(u,""),e=e.replace(a,""),e=e.replace(i,"<a class='chat_link' href='//mutualcog.com/u/$1'>/u/$1</a>$2"),e=e.replace(r,"<a class='chat_link' href='//mutualcog.com/c/$1'>/c/$1</a>$2"),e=e.replace(s,"<a class='chat_link' href='//mutualcog.com/u/$1'>@$1</a>$2"),e=e.replace(o,"<a class='chat_link' href='//mutualcog.com/c/$1'>#$1</a>$2"),e=e.replace(n,"$1$2style='max-width:300px;max-height:200px;margin-bottom:5px;' $3")),e=emoji(e),e}function randomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}function startup(){$.each($(".async_img"),function(e,t){$(".async_img").eq(e).attr("src",$(".async_img").eq(e).attr("data-chat-img"))});if(document.URL.indexOf("#")!=-1&&$(".nav-tabs").length!=0){var e=document.URL.substring(document.URL.indexOf("#"));$(".nav-tabs").find('a[href="'+e+'"]').tab("show")}$.each($(".pm_message"),function(e,t){moment().local().format("D:M:YYYY")==moment.utc($(".pm_message").eq(e).attr("title")).local().format("D:M:YYYY")?$(".pm_message").eq(e).attr("title",moment.utc($(".pm_message").eq(e).attr("title")).local().format("[Today at] h:mma")):$(".pm_message").eq(e).attr("title",moment.utc($(".pm_message").eq(e).attr("title")).local().format("M/D/YY [at] h:mma"))}),$.each($(".chat_time"),function(e,t){moment().local().format("D:M:YYYY")==moment.utc($(".chat_time").eq(e).attr("title")).local().format("D:M:YYYY")?$(".chat_time").eq(e).attr("title",moment.utc($(".chat_time").eq(e).attr("title")).local().format("[Today at] h:mma")):$(".chat_time").eq(e).attr("title",moment.utc($(".chat_time").eq(e).attr("title")).local().format("M/D/YY [at] h:mma"))}),$.each($(".time"),function(e,t){moment().local().format("D:M:YYYY")==moment.utc($(".time").eq(e).attr("title")).local().format("D:M:YYYY")?$(".time").eq(e).attr("title",moment.utc($(".time").eq(e).attr("title")).local().format("[Today at] h:mma")):$(".time").eq(e).attr("title",moment.utc($(".time").eq(e).attr("title")).local().format("M/D/YY [at] h:mma"))}),$(".user_tooltip").tooltip(),$(".mutual_tooltip").tooltip(),$(".caret_tooltip").tooltip(),$(".advanced_cog").tooltip(),$(".glyphicon-info-sign").tooltip(),$(".mssg_cont").velocity("transition.slideLeftBigIn")}function newPmChat(e,t,n,r){if(t==0)var i='<div class="pm_cont pm_visible" id="pm_'+r+'_0" style="visibility:hidden;">';else var i='<div class="pm_cont pm_visible" id="pm_'+e+"_"+t+'" style="visibility:hidden;">';return i+='<div class="pm_header"><div class="'+n+' pm_status"></div><div class="glyphicon glyphicon-remove pm_remove"></div><a class="pm_name" href="//mutualcog.com/u/'+r+'">'+r+"</a></div>",i+='<div class="pm_body"><div class="pm_body_mssgs">',i+='</div><div class="pm_body_alerts"> <div class="pm_mssg_alert pm_unseen" style="display:none;">Not seen</div> <div class="pm_mssg_alert pm_typing" style="display:none;">'+r+" is typing...</div> </div></div>",i+='<textarea rows=1 class="pm_text"></textarea>',i+="</div>",i}function validateLogin(e,t,n){var r=$.ajax({type:"GET",data:{username:e,pass:t},url:"//mutualcog.com/profile/validate-login",async:!1}).responseText;return r==1?(n?($("#mobile_user_group").attr("class","form-group"),$("#mobile_pass1_group").attr("class","form-group"),$("#mobile_username").tooltip("destroy")):($("#user_group").attr("class","form-group"),$("#pass1_group").attr("class","form-group"),$("#username").tooltip("destroy")),1):(n?($("#mobile_user_group").attr("class","form-group has-error"),$("#mobile_pass1_group").attr("class","form-group has-error"),$("#mobile_username").attr("data-original-title","Your username or password is incorrect"),$("#mobile_username").tooltip("show")):($("#user_group").attr("class","form-group has-error"),$("#pass1_group").attr("class","form-group has-error"),$("#username").attr("data-original-title","Your username or password is incorrect"),$("#username").tooltip("show")),0)}function validateUser(e){if(e.length<3||e.length>module.max_user_length)return $("#reg_user_group").attr("class","form-group has-error"),$("#reg_username").attr("data-original-title","Username must be between 3 and "+module.max_user_length+" characters"),$("#reg_username").tooltip("show"),0;var t=$.ajax({type:"GET",data:{username:e},url:"//mutualcog.com/profile/validate-username",async:!1}).responseText;return t==2?($("#reg_user_group").attr("class","form-group has-error"),$("#reg_username").attr("data-original-title","That username already exists"),$("#reg_username").tooltip("show"),0):t==3?($("#reg_user_group").attr("class","form-group has-error"),$("#reg_username").attr("data-original-title","Your username must contain at least one character"),$("#reg_username").tooltip("show"),0):t==4?($("#reg_user_group").attr("class","form-group has-error"),$("#reg_username").attr("data-original-title","Your username cannot contain brackets or spaces"),$("#reg_username").tooltip("show"),0):($("#reg_user_group").attr("class","form-group"),$("#reg_username").tooltip("destroy"),1)}function validatePasswords(e,t){return e!=t&&t!=""?($("#reg_pass1_group").attr("class","form-group has-error"),$("#pass2_group").attr("class","form-group has-error"),$("#pass2").tooltip("show"),0):(e.length<6||e.length>30)&&t!=""?($("#reg_pass1_group").attr("class","form-group has-error"),$("#pass2_group").attr("class","form-group has-error"),$("#pass").tooltip("show"),0):($("#reg_pass1_group").attr("class","form-group"),$("#pass2_group").attr("class","form-group"),$("#pass2").tooltip("destroy"),$("#reg_pass").tooltip("destroy"),1)}function validateEmail(e){var t=$.ajax({type:"GET",data:{email:e},url:"//mutualcog.com/profile/validate-email",async:!1}).responseText;return t==0?($("#email_group").attr("class","form-group has-error"),$("#email").tooltip("show"),0):($("#email_group").attr("class","form-group"),$("#email").tooltip("destroy"),1)}function cookiesEnabled(){var e=navigator.cookieEnabled;if(e===!1)return!1;if(!document.cookie&&(e===null||!1)){document.cookie="testcookie=1";if(!document.cookie)return!1;document.cookie="testcookie=; expires="+(new Date(0)).toUTCString()}return!0}function validateCommunity(e){var t=$.ajax({type:"GET",data:{community:e},url:"//mutualcog.com/community/validate-name",async:!1}).responseText;return t==1?1:0}$("body").on("click",".mutual_route",function(){var e=$(this).attr("href"),t=e.replace("//",""),n=$("#main").html(),r=$("#side").html(),i=document.URL,s=$(".highlight_light_blue"),o=$(this);return t=t.slice(t.indexOf("/")),$(".mutual_route").removeClass("highlight_light_blue"),$(this).addClass("highlight_light_blue"),$("#main_cont").html('<div class="spinner"> <div class="bounce1"></div> <div class="bounce2"></div> <div class="bounce3"></div> </div>'),$.ajax({type:"GET",url:e,success:function(e){$("#main").html(e.view),$("#sid").attr("data-sid",e.sid),$("#serial_tracker").text(e.serial),$("#serial_id").text(e.serial_id);if(e.community||e.home)$("#static_post_box").hide(),$("#chat_description_box").hide(),$("#chat_tool_box").hide();e.community?($("#community_sub_box").html($("#community_sub_replacement").html()),$("#community_info_box").html($("#community_info_replacement").html()),$("#community_sub_box").show(),$("#community_info_box").show()):($("#community_sub_box").hide(),$("#community_info_box").hide()),startup(),module.url_state_pntr==-1?(window.history.replaceState({pntr:0},null,document.documentURI),module.url_state.push({html:n,url:i,side:r,nav:s}),module.url_state.push({html:$("#main").html(),url:document.URL,side:$("#side").html(),nav:o}),module.url_state_pntr+=2):(module.url_state.push({html:$("#main").html(),url:document.URL,side:$("#side").html(),nav:o}),module.url_state_pntr++),window.history.pushState({pntr:module.url_state_pntr},null,t),module.chat_id&&(module.socket.emit("leave_room",module.chat_id),module.chat_id=null),module.socket.emit("authorize",{room:module.chat_id,sid:$("#sid").attr("data-sid"),serial:$("#serial_tracker").text()},function(){module.chat_id&&($("#logged_in").text()==1?module.socket.emit("add_user",{new_user:module.user_tracker,serial_id:module.serial_id}):module.socket.emit("add_user",{new_user:module.serial_tracker,serial_id:module.serial_id})),module.socket.emit("seen_chats")})}}),!1}),window.onpopstate=function(e){if(e.state!==null){var t=module.url_state[e.state.pntr];$(".mutual_route").removeClass("highlight_light_blue"),t.nav.addClass("highlight_light_blue"),$("#main").html(t.html),$("#side").html(t.side),startup()}else{var t=module.url_state[0];$(".mutual_route").removeClass("highlight_light_blue"),t.nav.addClass("highlight_light_blue"),$("#main").html(t.html),$("#side").html(t.side),startup()}},marked.setOptions({sanitize:!0,breaks:!0}),updateTimes=function(){$.each($(".time"),function(e,t){$(this).text(moment.utc($(this).attr("id")).fromNow())}),$.each($(".chat_time"),function(e,t){$(this).text(moment.utc($(this).attr("id")).fromNow())}),$.each($(".interaction_time"),function(e,t){$(this).text(moment.utc($(this).attr("id")).fromNow())})},upvoteMssg=function(e){e.stopPropagation();if($("#logged_in").text()==1){var t=$(this).attr("id").replace("mssg_upvote_",""),n="//mutualcog.com/chat/message-upvote",r=parseInt($("#mssg_votes_"+t).text());$("#mssg_downvote_"+t).hasClass("red_color")?($("#mssg_upvote_"+t).addClass("green_color"),$("#mssg_downvote_"+t).removeClass("red_color"),$("#mssg_votes_"+t).text(r+2)):$("#mssg_upvote_"+t).hasClass("green_color")?($("#mssg_upvote_"+t).removeClass("green_color"),$("#mssg_downvote_"+t).removeClass("red_color"),$("#mssg_votes_"+t).text(r-1)):($("#mssg_upvote_"+t).addClass("green_color"),$("#mssg_downvote_"+t).removeClass("red_color"),$("#mssg_votes_"+t).text(r+1)),$.ajax({type:"POST",data:{id:t},url:n,success:function(e){e.status==1||e.status==3?(e.status==1?(module.downvoted.splice(module.downvoted.indexOf(t.toString()),1),module.upvoted.push(t.toString())):module.upvoted.push(t.toString()),$("#mssg_cont_"+t).hasClass("mssg_cont")?module.socket.emit("update_votes",{id:t,response:e,responseto:"global"}):module.socket.emit("update_votes",{id:t,response:e,responseto:$("#message").attr("class")}),$("#mssg_upvote_"+t).addClass("green_color"),$("#mssg_downvote_"+t).removeClass("red_color")):e.status==2?(module.upvoted.splice(module.upvoted.indexOf(t.toString()),1),$("#mssg_cont_"+t).hasClass("mssg_cont")?module.socket.emit("update_votes",{id:t,response:e,responseto:"global"}):module.socket.emit("update_votes",{id:t,response:e,responseto:$("#message").attr("class")}),$("#mssg_upvote_"+t).removeClass("green_color"),$("#mssg_downvote_"+t).removeClass("red_color")):($("#reg_modal_title").text("Sign up to upvote/downvote"),$("#register_modal").modal())},error:function(){}})}else $("#reg_modal_title").text("Sign up to upvote/downvote"),$("#register_modal").modal()},downvoteMssg=function(e){e.stopPropagation();if($("#logged_in").text()==1){var t=$(this).attr("id").replace("mssg_downvote_",""),n="//mutualcog.com/chat/message-downvote",r=parseInt($("#mssg_votes_"+t).text());$("#mssg_downvote_"+t).hasClass("red_color")?($("#mssg_upvote_"+t).removeClass("green_color"),$("#mssg_downvote_"+t).removeClass("red_color"),$("#mssg_votes_"+t).text(r+1)):$("#mssg_upvote_"+t).hasClass("green_color")?($("#mssg_upvote_"+t).removeClass("green_color"),$("#mssg_downvote_"+t).addClass("red_color"),$("#mssg_votes_"+t).text(r-2)):($("#mssg_upvote_"+t).removeClass("green_color"),$("#mssg_downvote_"+t).addClass("red_color"),$("#mssg_votes_"+t).text(r-1)),$.ajax({type:"POST",data:{id:t},url:n,success:function(e){e.status==1||e.status==3?(e.status==1?(module.upvoted.splice(module.downvoted.indexOf(t.toString()),1),module.downvoted.push(t.toString())):module.downvoted.push(t.toString()),$("#mssg_cont_"+t).hasClass("mssg_cont")?module.socket.emit("update_votes",{id:t,response:e,responseto:"global"}):module.socket.emit("update_votes",{id:t,response:e,responseto:$("#message").attr("class")}),$("#mssg_upvote_"+t).removeClass("green_color"),$("#mssg_downvote_"+t).addClass("red_color")):e.status==2?(module.downvoted.splice(module.downvoted.indexOf(t.toString()),1),$("#mssg_cont_"+t).hasClass("mssg_cont")?module.socket.emit("update_votes",{id:t,response:e,responseto:"global"}):module.socket.emit("update_votes",{id:t,response:e,responseto:$("#message").attr("class")}),$("#mssg_upvote_"+t).removeClass("green_color"),$("#mssg_downvote_"+t).removeClass("red_color")):($("#reg_modal_title").text("Sign up to upvote/downvote"),$("#register_modal").modal())},error:function(){}})}else $("#reg_modal_title").text("Sign up to upvote/downvote"),$("#register_modal").modal()},deleteIt=function(e){e.stopPropagation();var t=$(this).parents(".js_mssg").first().attr("id").replace("message_","");$("#logged_in").text()==1?module.socket.emit("delete_message",{id:t,user:module.user_tracker,serial:$(this).attr("data-mssg-serial"),responses:$(this).parent().find(".response_count").text()}):module.socket.emit("delete_message",{id:t,user:module.serial_tracker,serial:$(this).attr("data-mssg-serial"),responses:$(this).parent().find(".response_count").text()})},getResponses=function(e){e.stopPropagation();var t=$(this).attr("id").replace("toggle_","");$(this).hasClass("dropup")?($(this).removeClass("dropup"),$(this).find(".caret").attr("data-original-title","Hide Responses"),$(".response_to_"+t).show()):($(this).addClass("dropup"),$(this).find(".caret").attr("data-original-title","Show Responses"),$(".response_to_"+t).hide())},getStaticResponses=function(e){e.stopPropagation();var t=$(this).attr("id").replace("toggle_","");$(this).hasClass("dropup")?($(this).removeClass("dropup"),$(this).find(".caret").attr("data-original-title","Hide Responses"),$(".response_to_"+t).show()):($(this).addClass("dropup"),$(this).find(".caret").attr("data-original-title","Show Responses"),$(".response_to_"+t).hide())},setClicked=function(e){e.stopPropagation(),module.clicked_on=$(this).attr("id").replace("message_","");var t=$("#permalink").attr("data-page-link");t.split("/").length-1==5?$(".permalink").attr("data-page-link",t+"/"+module.clicked_on):(t=t.substring(0,t.lastIndexOf("/")),$(".permalink").attr("data-page-link",t+"/"+module.clicked_on)),$(".chat_mssg").removeClass("bright_blue_background"),$(".chat_mssg").find(".reply_link").find("strong").text("Reply"),$(this).addClass("bright_blue_background"),$(this).find(".reply_link").find("strong").text("Replying"),$("#message").attr("class",$(this).attr("id").replace("message_","")),module.stop_scroll==0&&($(".stop_scroll").addClass("highlight_red"),$(".stop_scroll").attr("data-original-title","Resume scrolling")),module.scroll_mod_active=0,module.scroll_button_clicked=1,module.stop_scroll=1,$("#message").text()!=""?$("#message").text("Press enter to respond to "+$(this).find(".mssg_op").attr("data-author")+"'s message"):($("#message").val("Press enter to respond to "+$(this).find(".mssg_op").attr("data-author")+"'s message"),$("#message").on("click",function(){$(this).val(""),$(this).off("click")}))},find_top_notifications=function(){var e=Math.min.apply(Math,module.notifications_top_positions),t=module.notifications_top_ids[module.notifications_top_positions.indexOf(e)];module.notifications_top_ids.splice(module.notifications_top_positions.indexOf(e),1),module.notifications_top_positions.splice(module.notifications_top_positions.indexOf(e),1),$(".chat_main").mCustomScrollbar("scrollTo",e,{scrollInertia:0}),setTimeout(function(){$("#message_"+t).addClass("highlight_background","800")},100),setTimeout(function(){$("#message_"+t).removeClass("highlight_background","slow")},800);var n=parseInt($("#notify_text_top").text());n>1?$("#notify_text_top").text(n-1):($("#notify_text_top").text(0),$("#notify_cont_top").hide("blind"))},find_bottom_notifications=function(){var e=Math.min.apply(Math,module.notifications_bottom_positions),t=module.notifications_bottom_ids[module.notifications_bottom_positions.indexOf(e)];module.notifications_bottom_ids.splice(module.notifications_bottom_positions.indexOf(e),1),module.notifications_bottom_positions.splice(module.notifications_bottom_positions.indexOf(e),1),$(".chat_main").mCustomScrollbar("scrollTo",e),setTimeout(function(){$("#message_"+t).addClass("highlight_background","800")},100),setTimeout(function(){$("#message_"+t).removeClass("highlight_background","slow")},800);var n=parseInt($("#notify_text_bottom").text());n>1?$("#notify_text_bottom").text(n-1):($("#notify_text_bottom").text(0),$("#notify_cont_bottom").hide("blind"))},notifyMessage=function(){module.title_blinking=1,setTimeout(function(){module.focused?($("title").html("Mutual Cognizance"),module.title_blinking=0):($("title").html()=="Mutual Cognizance (1)"?$("title").html("New Message"):$("title").html("Mutual Cognizance (1)"),notifyMessage())},800)},generateMssg=function(e,t,n){if(t)if(n)var n="<div class='tmp_chat_mssg_"+module.tmp_mssg_cnt+" response_to_0 mssg_cont y_0 parent_0' id='mssg_cont_"+e.id+"'><div class='chat_mssg js_mssg' id='message_"+e.id+"'>";else var n="<div class='response_to_0 mssg_cont y_0 parent_0' id='mssg_cont_"+e.id+"'><div class='chat_mssg js_mssg' id='message_"+e.id+"'>";else if(n)var n="<div class='tmp_chat_mssg_"+module.tmp_mssg_cnt+" response_to_"+e.responseto+" mssg_cont y_"+e.y_dim+" parent_"+e.parent+" marg_l_20' id='mssg_cont_"+e.id+"'><div class='chat_mssg js_mssg' id='message_"+e.id+"'>";else var n="<div class='response_to_"+e.responseto+" mssg_cont y_"+e.y_dim+" parent_"+e.parent+" marg_l_20' id='mssg_cont_"+e.id+"'><div class='chat_mssg js_mssg' id='message_"+e.id+"'>";n+="<div class='mssg_body_cont'><div class='chat_vote_box'>",module.user_tracker==e.author||module.serial_tracker==e.author?n+='<span class="glyphicon glyphicon-menu-up js_mssg_upvote mssg_upvote green_color" id="mssg_upvote_'+e.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on messages" data-container="body" data-placement="top"></span> <div class="upvote_count" id="mssg_votes_'+e.id+'">0</div> <span class="glyphicon glyphicon-menu-down js_mssg_downvote mssg_downvote" id="mssg_downvote_'+e.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on messages" data-container="body" data-placement="bottom"></span>':n+='<span class="glyphicon glyphicon-menu-up js_mssg_upvote mssg_upvote" id="mssg_upvote_'+e.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on messages" data-container="body" data-placement="top"></span> <div class="upvote_count" id="mssg_votes_'+e.id+'">0</div> <span class="glyphicon glyphicon-menu-down js_mssg_downvote mssg_downvote" id="mssg_downvote_'+e.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on messages" data-container="body" data-placement="bottom"></span>',n+='</div><div class="js_mssg_body mssg_body author_'+e.author+'"><div id="toggle_'+e.id+'" class="toggle_responses"> <span class="caret caret_tooltip" id="caret_'+e.id+'" data-toggle="tooltip" data-original-title="Hide Responses" data-container="body" data-placement="top"></span> </div> ',(module.serial_tracker==e.author||module.user_tracker==e.author)&&e.message!="<i>This message has been deleted</i>"&&(n+="<span id='remove_"+e.id+"' style='margin-right:4px;' class='glyphicon glyphicon-remove mssg_icon' data-mssg-serial='"+e.serial+"' data-toggle='tooltip' title='Delete post' data-container='body' data-placement='top'></span>"),n+="<strong class='mssg_op' data-author='"+e.author+"'><a href='//mutualcog.com/u/"+e.author+"' style='color:"+module.color_arr[e.serial%7]+";'> "+e.author;if(module.serial_id==module.admin||module.user_id==module.admin)n+=" <span class='glyphicon glyphicon-king'></span>";else if(module.serial_id in module.mods||module.user_id in module.mods)n+=" <span class='glyphicon glyphicon-knight'></span>";return n+=" </a></strong> : "+e.message+"<div class='time_box'><div class='reply'><a href='#' class='reply_link' data-mssg-id='"+e.id+"'><strong>Reply</strong></a></div><div class='time' id='"+e.created_at+"'>"+moment.utc(e.created_at).fromNow()+"</div></div></div></div></div></div>",n},module=function(){var e=live=scroll_mod_active=1,t="",n=new Array,r=new Array,i={},s=-1,o=title_blinking=chat_scroll_timer=typ_cnt=connected=recent=banned=stop_scroll=scroll_button_clicked=scroll_top=0,u=-1;if($(".chat_id").length)var a=$(".chat_id").attr("id").replace("chat_","");else var a=null;if($("#up_arr").length)var f=jQuery.parseJSON($("#up_arr").text()),l=jQuery.parseJSON($("#down_arr").text());else var f=new Array,l=new Array;if(typeof io!="undefined")var c=io("http://localhost:3000/");else var c=$("body");var h=new Array("#228d49","#f52103","#2532f2","#f94f06","#5a24d9","#f8b92d","#38cedb","#050a57"),p=new Array;if($("#chat_mods_info").length)var d=$.parseJSON($("#chat_mods_info").text());else var d=new Array;var v=$("#chat_admin_info").text(),m=new Array,g=new Array,y=new Array,b=new Array,w=$("#serial_id").text(),E=$("#serial_tracker").text(),S=$("#user_id").text(),x=$("#user_tracker").text(),T=20,N=300,C=1e4,k=2500,L=100,A=1e4,O=new Array("Use 'who like' to find users with certain interests","Use 'about' to find posts about a certain topic","Type 'here' to search current community","Use 'in' to search communities","Press enter for more results","Search for your interests or specific content");return{url_state_pntr:s,url_state:r,tmp_mssg_cnt:o,search_messages:O,crit_len:n,chat_scroll_timer:chat_scroll_timer,max_title_length:N,max_user_length:T,max_static_length:C,max_chat_mssg_length:k,max_description_length:L,max_info_length:A,pm_scroll_inactive:i,connected:connected,recent:recent,typ_cnt:typ_cnt,pm_info:t,focused:e,live:live,title_blinking:title_blinking,banned:banned,stop_scroll:stop_scroll,scroll_mod_active:scroll_mod_active,scroll_button_clicked:scroll_button_clicked,scroll_top:scroll_top,clicked_on:u,chat_id:a,upvoted:f,downvoted:l,socket:c,color_arr:h,mems:p,mods:d,admin:v,notifications_top_positions:m,notifications_bottom_positions:g,notifications_top_ids:y,notifications_bottom_ids:b,serial_id:w,serial_tracker:E,user_id:S,user_tracker:x}}();var selected_term=-1,keys=new Array,pm_keys=new Array,selected_community=-1,selected_mod=-1,selected_admin=-1;$(window).resize(function(){$(window).width()<768?($(".nav_pad_r").css("padding-right",""),$(".community_search").css("display",""),$(".community_search").css("opacity",""),$("#search_input").css("width","")):($(".community_search").css("display")!="none"&&($(".community_input").width($("#welcome_user").width()-54),$("#logged_in").text()==1?$(".nav_pad_r").css("padding-right",$(".community_search_cont").width()+118):$(".nav_pad_r").css("padding-right",$(".community_search_cont").width())),$(".community_search").css("visibility","visible")),$(".pm_bar").width()>$(window).width()-30?(module.crit_len.push($(window).width()+30),$.each($(".pm_cont"),function(e,t){if($(".pm_cont").eq(e).css("display")!="none"){$(".pm_cont").eq(e).css("display","none"),$(".pm_cont").eq(e).css("visibility","hidden");var n=$(".pm_cont").eq(e),r=n.attr("id").split("_")[1],i=n.attr("id").split("_")[2],s=n.find(".pm_status").attr("class").split(" ")[0],o=n.find(".pm_name").text();return $(".pm_list_footer").length==0?$(".pm_bar").prepend('<div class="dropup pm_list_footer_cont"><div class="pm_list_footer dropdown-toggle" data-toggle="dropdown"><div class="glyphicon glyphicon-comment" style="color:white;float:left;"> ...</div></div><ul class="dropdown-menu pm_dropup" role="menu"><li id="switch_'+r+"_"+i+'"><a class="switch_pm" href="#" data-friend-id="'+r+'" data-friend-name="'+o+'" data-pm-id="'+i+'" data-status="'+s+'">'+o+"</a></li></ul></div>"):$(".pm_dropup").prepend('<li id="switch_'+r+"_"+i+'"><a class="switch_pm" href="#" data-friend-id="'+r+'" data-friend-name="'+o+'" data-pm-id="'+i+'" data-status="'+s+'">'+o+"</a></li>"),!1}})):(module.crit_len.length>0&&$(window).width()>module.crit_len[module.crit_len.length-1]||module.crit_len.length==0&&$(".pm_bar").width()<=$(window).width()-30)&&$(".pm_cont").eq(0).css("display")=="none"&&(module.crit_len.pop(),$.each($(".pm_cont"),function(e,t){if($(".pm_cont").eq(e).css("display")!="none"&&e>0){var n=$(".pm_cont").eq(e-1),r=n.attr("id").split("_")[1],i=n.attr("id").split("_")[2];$("#switch_"+r+"_"+i).remove(),$(".pm_dropup").children().length==0&&$(".pm_list_footer_cont").remove(),$(".pm_cont").eq(e-1).css("display",""),$(".pm_cont").eq(e-1).find(".pm_body").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$(".pm_cont").eq(e-1).css("visibility","")},50)}else if(e==$(".pm_cont").length-1){var n=$(".pm_cont").eq(e),r=n.attr("id").split("_")[1],i=n.attr("id").split("_")[2];$("#switch_"+r+"_"+i).remove(),$(".pm_dropup").children().length==0&&$(".pm_list_footer_cont").remove(),$(".pm_cont").eq(e).css("display",""),$(".pm_cont").eq(e).find(".pm_body").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$(".pm_cont").eq(e).css("visibility","")},50)}}))}),$(document).ready(function(){startup(),module.user_id.length&&(window.setInterval(function(){module.typ_cnt>1?module.typ_cnt--:module.typ_cnt==1&&(module.typ_cnt--,module.socket.emit("not_typing",{pm_id:module.pm_info[2],friend_id:module.pm_info[1],user_id:module.user_id})),module.recent==120&&$.ajax({type:"POST",data:{user_id:module.user_id},url:"//mutualcog.com/profile/update-online-status",success:function(){},error:function(){}}),module.recent++},1e3),$(window).on("mousemove",function(){module.recent>120&&module.socket.emit("seen_chats"),module.recent=0})),$(".pm_body").length&&($(".pm_bar").width()>$(window).width()-30&&$.each($(".pm_cont"),function(e,t){$(".pm_cont").eq(e).css("display","none"),$(".pm_cont").eq(e).removeClass("pm_visible");var n=$(".pm_cont").eq(e),r=n.attr("id").split("_")[1],i=n.attr("id").split("_")[2],s=n.find(".pm_status").attr("class").split(" ")[0],o=n.find(".pm_name").text();$(".pm_list_footer").length==0?$(".pm_bar").prepend('<div class="dropup pm_list_footer_cont"><div class="pm_list_footer dropdown-toggle" data-toggle="dropdown"><div class="glyphicon glyphicon-comment" style="color:white;float:left;"> ...</div></div><ul class="dropdown-menu pm_dropup" role="menu"><li id="switch_'+r+"_"+i+'"><a class="switch_pm" href="#" data-friend-id="'+r+'" data-friend-name="'+o+'" data-pm-id="'+i+'" data-status="'+s+'">'+o+"</a></li></ul></div>"):$(".pm_dropup").prepend('<li id="switch_'+r+"_"+i+'"><a class="switch_pm" href="#" data-friend-id="'+r+'" data-friend-name="'+o+'" data-pm-id="'+i+'" data-status="'+s+'">'+o+"</a></li>");if($(".pm_bar").width()<=$(window).width()-30)return!1}),$(".pm_body").mCustomScrollbar({theme:"light-2",callbacks:{onScroll:function(){var e=$(this),t=e.parent().attr("id"),n=this.mcs.draggerTop+e.find(".mCSB_dragger").height();n==e.height()?module.pm_scroll_inactive[t]=0:module.pm_scroll_inactive[t]=1}}}),$(".pm_body").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$(".pm_visible").css("visibility",""),$.each($(".pm_cont"),function(e,t){$(".pm_cont").eq(e).hasClass("pm_visible")||$(".pm_cont").eq(e).addClass("pm_visible")})},50)),updateTimes,window.setInterval(updateTimes,1e3),$("#mssg_requests").popover({html:!0}),$("#global_requests").popover({html:!0}),$("#friend_requests").popover({html:!0}),$(".pm_cont").resizable({handles:"nw",ghost:!1,maxHeight:450,maxWidth:400,minHeight:330,minWidth:240,resize:function(e,t){var n=t.size.height,r=t.size.width-10;$(this).css("left","0"),$(this).css("top","0"),$(this).find(".pm_header").width(r),$(this).find(".pm_body").height(n-64),$(this).find(".pm_body").width($(this).find(".pm_header").width()+6),$(this).find(".pm_text").width($(this).find(".pm_header").width()-2)}}),$(window).width()>767&&$(".community_search").css("visibility","visible"),$(".chat_main").mCustomScrollbar({theme:"minimal",scrollInertia:100,callbacks:{onScroll:function(){module.scroll_top=this.mcs.draggerTop;var e=this.mcs.draggerTop+$(".chat_main").find(".mCSB_dragger").height();e==$(".chat_main").height()-4?(module.stop_scroll=0,module.scroll_mod_active=1,$(".stop_scroll").removeClass("highlight_red"),$(".stop_scroll").attr("data-original-title","Stop scrollbar")):scroll_mod_active&&(module.stop_scroll=1,module.chat_scroll_timer=10,$(".stop_scroll").hasClass("highlight_red")||($(".stop_scroll").addClass("highlight_red"),$(".stop_scroll").attr("data-original-title","Resume scrolling")))}}}),window.setInterval(function(){module.chat_scroll_timer==0?module.scroll_button_clicked==0&&module.stop_scroll&&($(".stop_scroll").removeClass("highlight_red"),$(".stop_scroll").attr("data-original-title","Stop scrollbar"),module.stop_scroll=0):module.chat_scroll_timer--},1e3)}),module.socket.on("updateVotes",function(e){$("#mssg_votes_"+e.message_id).text(e.response.upvotes)}),module.socket.on("receive_pm",function(e){var t=$("#pm_"+e.friend_id+"_"+e.pm_id);if(e.state==0){var n=$("#friend_"+e.friend_id+"_status").attr("class").replace("friend_status","");$.ajax({type:"GET",data:{pm_id:e.pm_id},url:"//mutualcog.com/chat/pm-log",success:function(r){var i='<div class="pm_cont" id="pm_'+e.friend_id+"_"+e.pm_id+'">';i+='<div class="pm_header"><div class="'+n+' pm_status"></div><div class="glyphicon glyphicon-remove pm_remove"></div><a class="pm_name" href="//mutualcog.com/u/'+e.friend_name+'">'+e.friend_name+"</a></div>",i+='<div class="pm_body"><div class="pm_body_mssgs">',$.each(r,function(e,t){t.author_id==module.user_id?i+='<div class="pm_mssg_cont"> <div class="pm_message pull-right" style="background-color:#eee;margin-left:30px;margin-right:5px;" title="'+moment.utc(t.created_at).local().format("[Today at] h:mma")+'"> '+t.message+" </div> </div>":i+='<div class="pm_mssg_cont"> <div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(t.created_at).local().format("[Today at] h:mma")+'"> '+t.message+" </div> </div>"}),i+='</div><div class="pm_body_alerts"> <div class="pm_mssg_alert pm_unseen" style="display:none;">Not seen</div> <div class="pm_mssg_alert pm_typing" style="display:none;">'+e.friend_name+" is typing...</div> </div></div>",i+='<textarea rows=1 class="pm_text"></textarea>',i+="</div>",$(".pm_bar").prepend(i);var s='<div class="pm_mssg_cont">';s+='<div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(e.time).local().format("[Today at] h:mma")+'">'+e.message+"</div>",s+="</div>",t=$("#pm_"+e.friend_id+"_"+e.pm_id),t.find(".pm_body_mssgs").append(s);if(module.pm_scroll_inactive[t.attr("id")]==0||!(t.attr("id")in module.pm_scroll_inactive)){var o=t.find(".pm_body");window.setTimeout(function(){o.mCustomScrollbar("scrollTo","bottom",{scrollInertia:0})},20)}},error:function(){}})}else if(e.state==2){t.resizable("enable"),t.parent().find(".pm_body").css("display",""),t.parent().find(".pm_text").css("display","");var r='<div class="pm_mssg_cont">';r+='<div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(e.time).local().format("[Today at] h:mma")+'">'+e.message+"</div>",r+="</div>",t.find(".pm_body_mssgs").append(r)}else{var r='<div class="pm_mssg_cont">';r+='<div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(e.time).local().format("[Today at] h:mma")+'">'+e.message+"</div>",r+="</div>",t.find(".pm_body_mssgs").append(r)}if(module.pm_scroll_inactive[t.attr("id")]==0||!(t.attr("id")in module.pm_scroll_inactive)){var i=t.find(".pm_body");window.setTimeout(function(){i.mCustomScrollbar("scrollTo","bottom",{scrollInertia:0})},20)}}),module.socket.on("displayFriendRequests",function(e){var t=$("#friend_requests_count");t.text().length>0?t.text(parseInt(t.text())+1):($("#friend_request_glyph").addClass("pull-left"),t.text("1")),$("#friend_requests").attr("data-content").indexOf("No friend requests")>=0?$("#friend_requests").attr("data-content",e.message):$("#friend_requests").attr("data-content",$("#friend_requests").attr("data-content").prepend(e.message))}),module.socket.on("displayGlobalRequests",function(e){var t=$("#global_requests_count");t.text().length>0?t.text(parseInt(t.text())+1):($("#global_request_glyph").addClass("pull-left"),t.text("1")),$("#global_requests").attr("data-content").indexOf("No global requests")>=0?$("#global_requests").attr("data-content",e.message):$("#global_requests").attr("data-content",$("#global_requests").attr("data-content").prepend(e.message))}),module.socket.on("chat_seen",function(e){var t=$("#pm_"+e.friend_id+"_"+e.pm_id);t.find(".pm_unseen").hide()}),module.socket.on("is_typing",function(e){var t=$("#pm_"+e.friend_id+"_"+e.pm_id);t.find(".pm_typing").show()}),module.socket.on("not_typing",function(e){var t=$("#pm_"+e.friend_id+"_"+e.pm_id);t.find(".pm_typing").hide()}),module.socket.on("softDelete",function(e){if($("#message_"+e.id+".chat_mssg").length){$(".mssg_icon").tooltip("hide"),$(".mssg_icon").tooltip();var t=$("#message_"+e.id+".chat_mssg").find(".js_mssg_body"),n=t.find(".toggle_responses"),r=t.find(".time_box");t.html(""),t.append(n),t.append("<strong class='mssg_op' id='"+e.user+"' style='color:"+module.color_arr[e.mssg_serial%7]+";'>"+e.user+" </strong> : <em>This message has been deleted</em>"),t.append(r)}}),module.socket.on("connect",function(){console.log("Client has connected"),module.connected=1,module.socket.emit("authorize",{room:module.chat_id,sid:$("#sid").attr("data-sid"),serial:$("#serial_tracker").text()},function(){module.chat_id&&($("#logged_in").text()==1?module.socket.emit("add_user",{new_user:module.user_tracker,serial_id:module.serial_id}):module.socket.emit("add_user",{new_user:module.serial_tracker,serial_id:module.serial_id})),module.socket.emit("seen_chats")}),$(".enter_hint").text()=="You are disconnected"&&($(".enter_hint").text("Press Shift+Enter for new line"),$(".response_hint").text("Click on a message to respond to it")),$(".pm_unseen").eq(0).text()=="You are disconnected"&&($(".pm_unseen").text(""),$(".pm_unseen").hide())}),module.socket.on("alertUserToResponse",function(e){if($("#mssg_cont_"+e.mssg_id).parent().css("display")=="none")var t=$("#mssg_cont_"+e.parent).position().top;else var t=$("#mssg_cont_"+e.resp_id).position().top;var n=$("#chat_display").height()/$(".chat_main").height(),r=t-module.scroll_top*n+12;if(!(r>0)){module.notifications_top_positions.push(t),module.notifications_top_ids.push(e.resp_id);var i=parseInt($("#notify_text_top").text());i!=9&&(i+=1),$("#notify_text_top").text(i),$("#notify_cont_top").css("display")=="none"&&$("#notify_cont_top").show("blind")}var s=t-module.scroll_top*n-$("#chat_messages").height();if(s>0){module.notifications_bottom_positions.push(t),module.notifications_bottom_ids.push(e.resp_id);var o=parseInt($("#notify_text_bottom").text());o!=9&&(o+=1),$("#notify_text_bottom").text(o),$("#notify_cont_bottom").css("display")=="none"&&$("#notify_cont_bottom").show("blind")}}),module.socket.on("add_mod_funcs",function(){$("#user_toolbox").append('<span class="glyphicon glyphicon-warning-sign mod_power" id="warn_user" data-toggle="tooltip" data-container="body" data-placement="top" data-original-title="Warn user"></span> <span class="glyphicon glyphicon-remove mod_power" id="kick_user" data-toggle="tooltip" data-container="body" data-placement="top" data-original-title="Kick user"></span> '),$("#warn_user").tooltip(),$("#kick_user").tooltip()}),module.socket.on("remove_mod_funcs",function(){$(".mod_power").remove()}),module.socket.on("remove_mod_confirm",function(e){$("#modified_ident").text(e),$("#modified_message").text("is no longer a mod"),$("#action_confirmed").show("blind",function(){window.setTimeout(function(){$("#action_confirmed").hide("blind")},1500)})}),module.socket.on("pause",function(){module.live=0,$(".chat_paused").remove(),$(".chat_content").append('<div class="chat_paused" id="paused_message">Chat has been paused</div>'),$("#paused_message").show("fade","slow")}),module.socket.on("play",function(){module.live=1,$("#paused_message").hide("fade","slow",function(){$("#paused_message").remove()})}),module.socket.on("warn",function(){$(".chat_paused").remove(),$(".chat_content").append('<div class="chat_paused" id="warned_user">You have been warned</div>'),$("#warned_user").show("fade","slow",function(){window.setTimeout(function(){$("#warned_user").hide("fade","slow")},1500)})}),module.socket.on("warn_confirm",function(e){$("#modified_ident").text(e),$("#modified_message").text("has been warned"),$("#action_confirmed").show("blind",function(){window.setTimeout(function(){$("#action_confirmed").hide("blind")},1500)})}),module.socket.on("kick",function(){module.banned=1,$(".chat_paused").remove(),$(".chat_content").append('<div class="chat_paused" id="banned_user">You have been banned</div>'),$("#banned_user").show("fade","slow")}),module.socket.on("kick_confirm",function(e){$("#modified_ident").text(e),$("#modified_message").text("is now banned"),$("#action_confirmed").show("blind",function(){window.setTimeout(function(){$("#action_confirmed").hide("blind")},1500)})}),module.socket.on("check_live",function(e){e=="1"?$("#paused_message").hide("fade","show",function(){$("#paused_message").remove()}):(module.live=0,$(".chat_content").append('<div class="chat_paused" id="paused_message">Chat has been paused</div>'),$("#paused_message").show("fade","show")),$(".mssg_icon").tooltip(),$("#notify_cont_top").off("click"),$("#notify_cont_bottom").off("click"),$("#notify_cont_top").on("click",find_top_notifications),$("#notify_cont_bottom").on("click",find_bottom_notifications),$("#chat_display").off("click"),$("#chat_display").on("click",".mssg_icon",deleteIt),$("#chat_display").on("click",".js_mssg_upvote",upvoteMssg),$("#chat_display").on("click",".js_mssg_downvote",downvoteMssg),$("body").on("click",".chat_mssg",setClicked),$("#chat_display").on("click",".chat_link",function(e){e.stopPropagation()})}),module.socket.on("publishMessage",function(e){if(e.responseto==0){var t=generateMssg(e,1,0);$("#chat_display").append(t)}else{var t=generateMssg(e,0,0);$("#mssg_cont_"+e.responseto).append(t)}$(".mssg_icon").tooltip(),$(".caret_tooltip").tooltip(),!module.focused&&!module.title_blinking&&notifyMessage(),module.stop_scroll||(module.scroll_mod_active=0,$(".chat_main").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){module.scroll_mod_active=1},100))}),module.socket.on("disconnect",function(){module.connected=0,$(".enter_hint").text(""),$(".response_hint").text(""),$(".enter_hint").text("You are disconnected"),$(".pm_unseen").text("You are disconnected"),$(".pm_unseen").show(),console.log("The client has disconnected!")}),$("body").on("click",".mobile_pm_return",function(){$(this).parents(".mobile_pm_window").velocity("transition.slideLeftBigOut")}),$("body").on("click",".mobile_pm_cont",function(){var e="mobile_"+$(this).attr("id").replace("ident_","");$("#"+e).velocity("transition.slideLeftBigIn"),$("#"+e).find(".mobile_pm_body").mCustomScrollbar({theme:"light-2",callbacks:{onScroll:function(){var e=$(this),t=e.parent().attr("id"),n=this.mcs.draggerTop+e.find(".mCSB_dragger").height();n==e.height()?module.pm_scroll_inactive[t]=0:module.pm_scroll_inactive[t]=1}}}),$("#"+e).find(".mobile_pm_body").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0})}),$("body").on("click",".js_mssg_upvote",upvoteMssg),$("body").on("click",".js_mssg_downvote",downvoteMssg),$("body").on("click",".request_link",function(){var e=$(this);$.ajax({type:"GET",data:{note_id:$(this).attr("data-request-id")},url:"//mutualcog.com/profile/remove-notification",success:function(){window.location.href=e.attr("data-request-link")}})}),$("body").on("click",".accept_request",function(){var e=$(this).attr("id").split("_"),t=e[1],n=e[2];module.socket.emit("request_answered",{type:t,user_id:n,accepted:1})}),$("body").on("click",".decline_request",function(){var e=$(this).attr("id").split("_"),t=e[1],n=e[2];module.socket.emit("request_answered",{type:t,user_id:n,accepted:0})}),$("body").on("click",".pm_remove",function(){$(this).parent().parent().remove();var e=$(this).parent().parent().attr("id").split("_");return module.socket.emit("leave_pm",{pm_id:e[2],friend_id:e[1]}),!1}),$("body").on("click",".mobile_pm_remove",function(){$(this).parent().parent().remove();var e=$(this).parent().parent().attr("id").split("_");return module.socket.emit("leave_pm",{pm_id:e[2],friend_id:e[1]}),!1}),$("body").on("click",".mobile_friend_box",function(){var e=$(this).attr("id").replace("friend_box_for_",""),t=$(this).attr("data-friend-id"),n=$(this).attr("data-pm-chat-id"),r=$(this).find("#friend_"+t+"_status").attr("class").replace("friend_status","");module.socket.emit("join_private_chat",{friend_id:t,friend_name:e,pm_id:n},function(e){window.location.href="//mutualcog.com/chat/live/"+e.pm_id})}),$("body").on("click",".friend_box",function(){var e=$(this).attr("id").replace("friend_box_for_",""),t=$(this).attr("data-friend-id"),n=$(this).attr("data-pm-chat-id"),r=$(this).find("#friend_"+t+"_status").attr("class").replace("friend_status","");if($(".pm_bar").width()<$(window).width()-370&&$("#pm_"+t+"_"+n).length==0)if(n!="0"){var i=newPmChat(t,n,r,e);$(".pm_bar").prepend(i),$.ajax({type:"GET",data:{pm_id:n},url:"//mutualcog.com/chat/pm-log",success:function(r){var i="";$.each(r,function(e,t){t.author_id==module.user_id?i+='<div class="pm_mssg_cont"> <div class="pm_message pull-right" style="background-color:#eee;margin-left:30px;margin-right:5px;" title="'+moment.utc(t.created_at).local().format("[Today at] h:mma")+'"> '+t.message+" </div> </div>":i+='<div class="pm_mssg_cont"> <div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(t.created_at).local().format("[Today at] h:mma")+'"> '+t.message+" </div> </div>"}),$("#pm_"+t+"_"+n).find(".pm_body_mssgs").append(i),module.socket.emit("join_private_chat",{friend_id:t,friend_name:e,pm_id:n},function(e){}),$(".pm_body").eq(0).mCustomScrollbar({theme:"light-2",callbacks:{onScroll:function(){var e=$(this),t=e.parent().attr("id"),n=this.mcs.draggerTop+e.find(".mCSB_dragger").height();n==e.height()?module.pm_scroll_inactive[t]=0:module.pm_scroll_inactive[t]=1}}}),$(".pm_body").eq(0).mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$(".pm_visible").css("visibility",""),$("#pm_"+t+"_"+n).find(".pm_text").focus()},50),$(".pm_cont").eq(0).resizable({handles:"nw",ghost:!1,maxHeight:450,maxWidth:400,minHeight:330,minWidth:240,resize:function(e,t){var n=t.size.height,r=t.size.width-10;$(this).css("left","0"),$(this).css("top","0"),$(this).find(".pm_header").width(r),$(this).find(".pm_body").height(n-64),$(this).find(".pm_body").width($(this).find(".pm_header").width()+6),$(this).find(".pm_text").width($(this).find(".pm_header").width()-2)}})},error:function(){}})}else{var i=newPmChat(t,0,r,e);$(".pm_bar").prepend(i),module.socket.emit("join_private_chat",{friend_id:t,friend_name:e,pm_id:n},function(e){$("#pm_"+e.friend_name+"_0").attr("id","pm_"+e.friend_id+"_"+e.pm_id)}),$(".pm_body").eq(0).mCustomScrollbar({theme:"light-2",callbacks:{onScroll:function(){var e=$(this),t=e.parent().attr("id"),n=this.mcs.draggerTop+e.find(".mCSB_dragger").height();n==e.height()?module.pm_scroll_inactive[t]=0:module.pm_scroll_inactive[t]=1}}}),$(".pm_body").eq(0).mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$(".pm_visible").css("visibility",""),$("#pm_"+t+"_"+n).find(".pm_text").focus()},50),$(".pm_cont").eq(0).resizable({handles:"nw",ghost:!1,maxHeight:450,maxWidth:400,minHeight:330,minWidth:240,resize:function(e,t){var n=t.size.height,r=t.size.width-10;$(this).css("left","0"),$(this).css("top","0"),$(this).find(".pm_header").width(r),$(this).find(".pm_body").height(n-64),$(this).find(".pm_body").width($(this).find(".pm_header").width()+6),$(this).find(".pm_text").width($(this).find(".pm_header").width()-2)}})}else $("#pm_"+t+"_"+n).length==0&&($(".pm_list_footer").length==0?$(".pm_bar").prepend('<div class="dropup pm_list_footer_cont"><div class="pm_list_footer dropdown-toggle" data-toggle="dropdown"><div class="glyphicon glyphicon-comment" style="color:white;float:left;"> ...</div></div><ul class="dropdown-menu pm_dropup" role="menu"><li id="switch_'+t+"_"+n+'"><a class="switch_pm" href="#" data-friend-id="'+t+'" data-friend-name="'+e+'" data-pm-id="'+n+'" data-status="'+r+'">'+e+"</a></li></ul></div>"):$(".pm_dropup").prepend('<li id="switch_'+t+"_"+n+'"><a class="switch_pm" href="#" data-friend-id="'+t+'" data-friend-name="'+e+'" data-pm-id="'+n+'" data-status="'+r+'">'+e+"</a></li>"))}),$("body").on("click",".switch_pm",function(){$(this).remove();var e=$(".pm_cont").first(),t=e.attr("id").split("_")[1],n=e.attr("id").split("_")[2],r=e.find(".pm_status").attr("class").split(" ")[0],i=e.find(".pm_name").text();$(".pm_dropup").prepend('<li id="switch_'+s+"_"+o+'"><a class="switch_pm" href="#" data-friend-id="'+t+'" data-friend-name="'+i+'" data-pm-id="'+n+'" data-status="'+r+'">'+i+"</a></li>"),$(".pm_cont").first().css("display","none"),$(".pm_cont").first().css("visibility","hidden");var s=$(this).attr("data-friend-id"),o=$(this).attr("data-pm-id"),u=$(this).attr("data-status"),a=$(this).attr("data-friend-name");if($("#pm_"+s+"_"+o).length==0){var f=newPmChat(s,o,u,a);$(".pm_cont").first().before(f),$.ajax({type:"GET",data:{pm_id:o},url:"//mutualcog.com/chat/pm-log",success:function(e){var t="";$.each(e,function(e,n){n.author_id==module.user_id?t+='<div class="pm_mssg_cont"> <div class="pm_message pull-right" style="background-color:#eee;margin-left:30px;margin-right:5px;" title="'+moment.utc(n.created_at).local().format("[Today at] h:mma")+'"> '+n.message+" </div> </div>":t+='<div class="pm_mssg_cont"> <div class="pm_message pull-left" style="background-color:#7badfc;margin-right:30px;margin-left:5px;" title="'+moment.utc(n.created_at).local().format("[Today at] h:mma")+'"> '+n.message+" </div> </div>"}),$("#pm_"+s+"_"+o).find(".pm_body_mssgs").append(t),module.socket.emit("join_private_chat",{friend_id:s,friend_name:a,pm_id:o},function(e){}),$("#pm_"+s+"_"+o).find(".pm_body").mCustomScrollbar({theme:"light-2",callbacks:{onScroll:function(){var e=$(this),t=e.parent().attr("id"),n=this.mcs.draggerTop+e.find(".mCSB_dragger").height();n==e.height()?module.pm_scroll_inactive[t]=0:module.pm_scroll_inactive[t]=1}}}),$("#pm_"+s+"_"+o).find(".pm_body").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$("#pm_"+s+"_"+o).css("visibility",""),$("#pm_"+s+"_"+o).find(".pm_text").focus()},50),$("#pm_"+s+"_"+o).resizable({handles:"nw",ghost:!1,maxHeight:450,maxWidth:400,minHeight:330,minWidth:240,resize:function(e,t){var n=t.size.height,r=t.size.width-10;$(this).css("left","0"),$(this).css("top","0"),$(this).find(".pm_header").width(r),$(this).find(".pm_body").height(n-64),$(this).find(".pm_body").width($(this).find(".pm_header").width()+6),$(this).find(".pm_text").width($(this).find(".pm_header").width()-2)}})},error:function(){}})}else{var f=$("#pm_"+s+"_"+o).clone();$("#pm_"+s+"_"+o).remove(),f.css("display",""),$(".pm_cont").first().before(f),$("#pm_"+s+"_"+o).find(".pm_body").mCustomScrollbar({theme:"light-2",callbacks:{onScroll:function(){var e=$(this),t=e.parent().attr("id"),n=this.mcs.draggerTop+e.find(".mCSB_dragger").height();n==e.height()?module.pm_scroll_inactive[t]=0:module.pm_scroll_inactive[t]=1}}}),$("#pm_"+s+"_"+o).find(".pm_body").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$("#pm_"+s+"_"+o).css("visibility",""),$("#pm_"+s+"_"+o).find(".pm_text").focus()},50),$("#pm_"+s+"_"+o).resizable({handles:"nw",ghost:!1,maxHeight:450,maxWidth:400,minHeight:330,minWidth:240,resize:function(e,t){var n=t.size.height,r=t.size.width-10;$(this).css("left","0"),$(this).css("top","0"),$(this).find(".pm_header").width(r),$(this).find(".pm_body").height(n-64),$(this).find(".pm_body").width($(this).find(".pm_header").width()+6),$(this).find(".pm_text").width($(this).find(".pm_header").width()-2)}})}return!1}),$("body").on("click",".pm_header",function(){var e=$(this).parent().attr("id").split("_");$(this).parent().find(".pm_body").css("display")=="none"?(module.socket.emit("maximize_pm",{friend_id:e[1],pm_id:e[2]}),$(this).parent().resizable("enable"),$(this).parent().find(".pm_body").css("display",""),$(this).parent().find(".pm_text").css("display",""),$(this).parent().find(".pm_body").css("visibility","hidden"),$(".pm_body").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){$(".pm_body").css("visibility","")},50)):(module.socket.emit("minimize_pm",{friend_id:e[1],pm_id:e[2]}),$(this).parent().css("height")!=""&&($(this).parent().attr("data-expanded-height",$(this).parent().css("height")),$(this).parent().css("height","")),$(this).parent().resizable("disable"),$(this).parent().find(".pm_body").css("display","none"),$(this).parent().find(".pm_text").css("display","none"))}),$(window).on("click",function(e){$("#community_dropdown").hide(),$("#users_box").hide("blind"),$("#show_users").removeClass("highlighted_dark")}),$("#community_dropdown").on("click",function(e){e.stopPropagation()}),$(".js_upvote").click(function(e){e.stopPropagation();if($("#logged_in").text()==1){var t=$(this).attr("id"),n=$(this).attr("id").replace("upvote_",""),r="//mutualcog.com/chat/upvote",i=parseInt($("#votes_"+n).text());$("#downvote_"+n).hasClass("red_color")?($("#upvote_"+n).addClass("green_color"),$("#downvote_"+n).removeClass("red_color"),$("#votes_"+n).text(i+2)):$("#upvote_"+n).hasClass("green_color")?($("#upvote_"+n).removeClass("green_color"),$("#downvote_"+n).removeClass("red_color"),$("#votes_"+n).text(i-1)):($("#upvote_"+n).addClass("green_color"),$("#downvote_"+n).removeClass("red_color"),$("#votes_"+n).text(i+1)),$.ajax({type:"POST",data:{id:n},url:r,success:function(e){e.status==1||e.status==3?($("#votes_"+n).text(e.upvotes),$("#upvote_"+n).addClass("green_color"),$("#downvote_"+n).removeClass("red_color")):e.status==2?($("#votes_"+n).text(e.upvotes),$("#upvote_"+n).removeClass("green_color"),$("#downvote_"+n).removeClass("red_color")):($("#reg_modal_title").text("Sign up to upvote/downvote"),$("#register_modal").modal())},error:function(){}})}else $("#reg_modal_title").text("Sign up to upvote/downvote"),$("#register_modal").modal()}),$(".js_downvote").click(function(e){e.stopPropagation();if($("#logged_in").text()==1){var t=$(this).attr("id"),n=$(this).attr("id").replace("downvote_",""),r="//mutualcog.com/chat/downvote",i=parseInt($("#votes_"+n).text());$("#downvote_"+n).hasClass("red_color")?($("#upvote_"+n).removeClass("green_color"),$("#downvote_"+n).removeClass("red_color"),$("#votes_"+n).text(i+1)):$("#upvote_"+n).hasClass("green_color")?($("#upvote_"+n).removeClass("green_color"),$("#downvote_"+n).addClass("red_color"),$("#votes_"+n).text(i-2)):($("#upvote_"+n).removeClass("green_color"),$("#downvote_"+n).addClass("red_color"),$("#votes_"+n).text(i-1)),$.ajax({type:"POST",data:{id:n},url:r,success:function(e){e.status==1||e.status==3?($("#votes_"+n).text(e.upvotes),$("#upvote_"+n).removeClass("green_color"),$("#downvote_"+n).addClass("red_color")):e.status==2?($("#votes_"+n).text(e.upvotes),$("#upvote_"+n).removeClass("green_color"),$("#downvote_"+n).removeClass("red_color")):($("#reg_modal_title").text("Sign up to upvote/downvote"),$("#register_modal").modal())},error:function(){}})}else $("#reg_modal_title").text("Sign up to upvote/downvote"),$("#register_modal").modal()}),$(".entry_search_submit").click(function(){return selected_term==-1&&$("#search_input").val().length==0?!1:(selected_term==-1&&$("#search_input").val().length>0?window.location.href="//mutualcog.com/search/result/"+$("#search_input").val():location.assign($("li#search_"+selected_term).children("a").attr("href")),!1)}),$("#request_friend").click(function(){if($("#logged_in").text()!=1)return $("#reg_modal_title").text("Sign up to add friends"),$("#register_modal").modal(),!1;module.socket.emit("request_friend",{user_id:$(this).attr("data-user-id"),user:$(this).attr("data-user-name"),sender_id:module.user_id,sender:module.user_tracker}),$(this).removeClass("btn-primary"),$(this).addClass("btn-success"),$(this).html('<div class="glyphicon glyphicon-check" id="request_glyph"></div> Request Sent'),$(this).off("click")}),$(".mobile_show_friend_requests").click(function(){$(this).css("background-color","#ddd"),$(".mobile_show_mssg_requests").css("background-color",""),$(".mobile_show_global_requests").css("background-color",""),$(".mobile_mssg_requests").hide(),$(".mobile_global_requests").hide(),$(".mobile_friend_requests").velocity("transition.slideLeftBigIn")}),$(".mobile_show_mssg_requests").click(function(){$(this).css("background-color","#ddd"),$(".mobile_show_friend_requests").css("background-color",""),$(".mobile_show_global_requests").css("background-color",""),$(".mobile_friend_requests").hide(),$(".mobile_global_requests").hide(),$(".mobile_mssg_requests").velocity("transition.slideLeftBigIn")}),$(".mobile_show_global_requests").click(function(){$(this).css("background-color","#ddd"),$(".mobile_show_friend_requests").css("background-color",""),$(".mobile_show_mssg_requests").css("background-color",""),$(".mobile_mssg_requests").hide(),$(".mobile_friend_requests").hide(),$(".mobile_global_requests").velocity("transition.slideLeftBigIn")}),$(".mobile_show_friends").click(function(){$(this).css("background-color","#ddd"),$(".mobile_show_open_pms").css("background-color",""),$(".mobile_pms").hide(),$(".mobile_friend_list").velocity("transition.slideLeftBigIn")}),$(".mobile_show_open_pms").click(function(){$(this).css("background-color","#ddd"),$(".mobile_show_friends").css("background-color",""),$(".mobile_friend_list").hide(),$(".mobile_pms").velocity("transition.slideLeftBigIn")}),$("#show_mobile_pms").click(function(){$("#mobile_pms_cont").css("display")=="none"?($(this).addClass("highlight_blue_background"),$("#show_mobile_notifications").removeClass("highlight_blue_background")):$(this).removeClass("highlight_blue_background");var e="transition.slideDownBigIn";$("#mobile_pms_cont").css("display")=="block"?($(".big_content_box").velocity("transition.slideDownBigIn"),e="transition.slideUpBigOut"):$(".big_content_box").velocity("transition.slideUpBigOut"),$("#mobile_pms_cont").velocity(e),$("#mobile_notifications_cont").hide()}),$("#show_mobile_notifications").click(function(){$("#mobile_notifications_cont").css("display")=="none"?($(this).addClass("highlight_blue_background"),$("#show_mobile_pms").removeClass("highlight_blue_background")):$(this).removeClass("highlight_blue_background");var e="transition.slideDownBigIn";$("#mobile_notifications_cont").css("display")=="block"?($(".big_content_box").velocity("transition.slideDownBigIn"),e="transition.slideUpBigOut"):$(".big_content_box").velocity("transition.slideUpBigOut"),$("#mobile_notifications_cont").velocity(e),$("#mobile_pms_cont").hide()}),$(".register_link").click(function(){$("#reg_modal_title").text("Create an account")}),$(".show_friends").click(function(){return $(".left_menu_toggle").html('Friends <strong class="caret" style="color:white;"></strong>'),$(".show_subscriptions").show(),$(".show_recent").show(),$("#friend_box_cont").velocity("transition.slideLeftBigIn"),$("#subscription_cont").hide(),$("#recent_cont").hide(),$(this).hide(),$(this).dropdown("toggle"),$.ajax({type:"GET",data:{status:0},url:"//mutualcog.com/profile/set-status/"+module.user_id,success:function(){}}),!1}),$(".show_subscriptions").click(function(){return $(".left_menu_toggle").html('Subscriptions <strong class="caret" style="color:white;"></strong>'),$(".show_friends").show(),$(".show_recent").show(),$("#friend_box_cont").hide(),$("#recent_cont").hide(),$("#subscription_cont").velocity("transition.slideLeftBigIn"),$(this).hide(),$(this).dropdown("toggle"),$.ajax({type:"GET",data:{status:1},url:"//mutualcog.com/profile/set-status/"+module.user_id,success:function(){}}),!1}),$(".show_recent").click(function(){return $(".left_menu_toggle").html('Recent <strong class="caret" style="color:white;"></strong>'),$(".show_subscriptions").show(),$(".show_friends").show(),$("#friend_box_cont").hide(),$("#subscription_cont").hide(),$("#recent_cont").velocity("transition.slideLeftBigIn"),$(this).hide(),$(this).dropdown("toggle"),$.ajax({type:"GET",data:{status:2},url:"//mutualcog.com/profile/set-status/"+module.user_id,success:function(){}}),!1}),$("body").on("click",".toggle_responses",getResponses),$(".static_chat_content").on("click",".toggle_responses",getStaticResponses),$(".request_btn").on("click",function(){}),$(".pm_bar").on("click",".pm_name",function(e){e.stopPropagation()}),$(".toggle_search").click(function(){if($(".community_search").css("display")=="none"){var e=$("#welcome_user").width();$(".community_search_expand").css("display","none"),$(".community_search_collapse").css("display",""),$(".community_input").width(e-54),$(".community_input").attr("placeholder",module.search_messages[randomInt(0,module.search_messages.length-1)]),$(".nav_pad_r").css("padding-right",e+100),$(".community_search_cont").velocity("transition.slideRightBigIn"),$(".community_search").velocity("transition.slideRightBigIn",{display:"inline-block"}),console.log($(".community_search").find("input")),window.setTimeout(function(){$(".community_search").find("input").get(0).focus()},800)}else $(".community_search_expand").css("display",""),$(".community_search_collapse").css("display","none"),$(".community_search").velocity("transition.slideRightBigOut",500,function(){$(".nav_pad_r").css("padding-right",$(".community_search_cont").width())});$(".community_input").focus()}),$("#community_dropdown").on("click",".search_link",function(){return $("#keywords_modal").modal(),!1}),$("#main").on("click",".edit_chat_link",function(e){var t=$(this).parents(".chat_title_box");return $("#Title_v3").val(t.find(".chat_title_str").text()),$("#Link_v3").val(t.find(".chat_link_str").text()),$("#Communities_v3").val(t.find(".chat_community_str").text()),$("#description_v3").val(t.find(".chat_desc_str").text()),$("#form_chat_id").val(t.find(".chat_id_str").text()),t.find(".chat_live_str").text()==1?$("#live_status_v3").attr("checked",!0):$("#live_status_v3").attr("checked",!1),t.find(".chat_nsfw_str").text()==1?$("#nsfw_v3").attr("checked",!0):$("#nsfw_v3").attr("checked",!1),$("#edit_modal").modal(),!1}),$("#side").on("click",".edit_chat_link",function(e){var t=$(this).parents(".chat_title_cont");return $("#Title_v3").val(t.find(".chat_title_str").text()),$("#Link_v3").val(t.find(".chat_link_str").text()),$("#Communities_v3").val(t.find(".chat_community_str").text()),$("#description_v3").val(t.find(".chat_desc_str").text()),$("#form_chat_id").val(t.find(".chat_id_str").text()),t.find(".chat_live_str").text()==1?$("#live_status_v3").attr("checked",!0):$("#live_status_v3").attr("checked",!1),t.find(".chat_nsfw_str").text()==1?$("#nsfw_v3").attr("checked",!0):$("#nsfw_v3").attr("checked",!1),$("#edit_modal").modal(),!1}),$("#chat_messages").click(function(){module.scroll_mod_active==0&&(module.stop_scroll==1&&($(".stop_scroll").removeClass("highlight_red"),$(".stop_scroll").attr("data-original-title","Stop scrollbar")),module.scroll_mod_active=1,module.scroll_button_clicked=0,module.stop_scroll=0),$("#message").attr("class","global"),$(".chat_mssg").removeClass("bright_blue_background"),$(".chat_mssg").find(".reply_link").find("strong").text("Reply");var e=$("#permalink").attr("data-page-link");e.split("/").length-1!=5&&(e=e.substring(0,e.lastIndexOf("/")),$(".permalink").attr("data-page-link",e)),module.clicked_on=-1,$("#message").text()!=""?$("#message").text("Press enter to send a message to all"):($("#message").val("Press enter to send a message to all"),$("#message").on("click",function(){$(this).val(""),$(this).off("click")}))}),$(".permalink").click(function(e){window.location.href=$(this).attr("data-page-link")}),$("#message").click(function(){$(".enter_hint").text(""),$(".response_hint").text(""),$(this).text("")}),$(window).on("click",function(e){$("#community_dropdown").hide()}),$(".show_users").click(function(e){var t=$(this).attr("data-chat-id");$.ajax({type:"GET",url:"//mutualcog.com/chat/chat-users",data:{chat_id:t},success:function(e){var t="";$.each(e,function(n,r){n==e.length-1?t+='<div class="chat_member">':t+='<div class="chat_member light_divider_bottom">',r.pivot.active=="1"?t+='<a class="dark_link" href="//mutualcog.com/u/'+r.name+'">'+r.name+"</a>":t+='<a class="grey_link" href="//mutualcog.com/u/'+r.name+'">'+r.name+"</a>",r.id!=module.user_id&&(t+='<button class="btn btn-primary pull-right" style="margin-top:-6px;" id="request_friend" data-user-id="'+r.id+'" data-user-name="'+r.name+'"><div class="glyphicon glyphicon-plus" id="request_glyph"> </div> Friend</button>'),r.id==module.user_id||module.user_tracker!=$("#chat_admin").attr("data-admin-name")&&module.serial_tracker!=$("#chat_admin").attr("data-admin-name")||r.pivot.is_mod!="0"?r.id!=module.user_id&&(module.user_tracker==$("#chat_admin").attr("data-admin-name")||module.serial_tracker==$("#chat_admin").attr("data-admin-name"))&&r.pivot.is_mod=="1"&&(t+='<button class="btn btn-default pull-right mod_user" id="mod_user_'+r.id+'" style="margin-top:-6px;margin-right:5px;" data-user-id="'+r.id+'" data-user-name="'+r.name+'" data-is-mod="1"><div class="glyphicon glyphicon-tower"> </div> Unmod</button>'):t+='<button class="btn btn-default pull-right mod_user" id="mod_user_'+r.id+'" style="margin-top:-6px;margin-right:5px;" data-user-id="'+r.id+'" data-user-name="'+r.name+'" data-is-mod="0"><div class="glyphicon glyphicon-tower"> </div> Mod</button>',t+="</div>"}),$(".chat_member_cont").html(t),$("#members_modal").modal()},error:function(){$(".chat_member_cont").html("Couldn't retrieve chat members"),$("#members_modal").modal()}})}),$(".pause_chat").click(function(){$(this).hasClass("pause")?(module.socket.emit("pause_all"),$(this).removeClass("pause"),$(this).removeClass("glyphicon-pause"),$(this).addClass("glyphicon-play"),$(this).addClass("play"),$(this).attr("data-original-title","Play chat")):(module.socket.emit("play_all"),$(this).removeClass("play"),$(this).removeClass("glyphicon-play"),$(this).addClass("glyphicon-pause"),$(this).addClass("pause"),$(this).attr("data-original-title","Pause chat"))}),$(".warn_user").click(function(){var e=$("#mssg_cont_"+module.clicked_on).find(".mssg_op").attr("data-author");if(e==module.user_tracker||module.clicked_on==-1)return!1;module.socket.emit("warn",{user:e})}),$(".kick_user").click(function(){var e=$("#mssg_cont_"+module.clicked_on).find(".mssg_op").attr("data-author");if(e==module.user_tracker||module.clicked_on==-1)return!1;module.socket.emit("kick",{user:e})}),$(".stop_scroll").click(function(){$(this).hasClass("highlight_red")?(module.stop_scroll=0,module.scroll_button_clicked=0,module.scroll_mod_active=1,$(this).removeClass("highlight_red"),$(this).attr("data-original-title","Stop scrollbar")):(module.stop_scroll=1,module.scroll_button_clicked=1,module.scroll_mod_active=0,$(this).addClass("highlight_red"),$(this).attr("data-original-title","Resume scrolling"))}),$(".chat_member_cont").on("click",".mod_user",function(){var e=$("#show_users").attr("data-chat-id");module.socket.emit("mod_user",{id:$(this).attr("data-user-id"),chat_id:e,name:$(this).attr("data-user-name"),is_mod:$(this).attr("data-is-mod")},function(e){e.is_mod=="0"?($("#mod_user_"+e.user_id).html('<div class="glyphicon glyphicon-tower"> </div> Unmod'),$("#mod_user_"+e.user_id).attr("data-is-mod","1")):($("#mod_user_"+e.user_id).html('<div class="glyphicon glyphicon-tower"> </div> Mod'),$("#mod_user_"+e.user_id).attr("data-is-mod","0"))})}),$(".chat_content").on("click",".mssg_icon",deleteIt),$(".static_chat_content").on("click",".mssg_icon",deleteIt),$("body").on("click",".p_chat_mssg",function(){var e=$(this).find(".p_mssg_body").attr("class").split(" ")[0].split("_")[2],t=$(this).attr("id");window.location.href="//mutualcog.com/chat/static/"+e+"/"+t}),$("#message_user_form").submit(function(){return $(this).find("#message_body").val()!=""?($(this).attr("action",$(this).attr("action")+$(".profile_name").attr("id")),!0):!1}),$("#main").on("click",".toggle_description",function(){var e=$(this).parent().parent().find(".description_cont");return e.css("display")=="none"?($(this).html("Hide description"),e.show()):($(this).html("Show description"),e.hide()),!1}),$(".load_more").on("click",function(){var e=$(this).attr("href"),t=$(this).parent(),n=$(this);return $.ajax({type:"GET",url:e,success:function(e){var r=e.length,i=e.upvoted,s=e.downvoted,o=0;delete e.upvoted,delete e.downvoted,n.remove();var u="";$.each(e,function(e,t){u+='<div class="response_to_'+t.responseto+" static_mssg_cont y_"+t.y_dim+" parent_"+t.parent+' pad_l_10" id="static_mssg_cont_'+t.id+'">',u+='<div class="static_mssg_cont_inner"><div class="static_mssg js_mssg" id="message_'+t.id+'"> <div class="row" style="margin:0;"> <div class="mssg_body_cont"> <div class="static_vote_box">',i.indexOf(t.id)!=-1?u+='<span class="glyphicon glyphicon-menu-up js_mssg_upvote static_mssg_upvote" id="mssg_upvote_'+t.id+'" style="color:#57bf4b" data-toggle="tooltip" data-original-title="You must be logged in to vote on responses" data-container="body" data-placement="top"></span> <div class="upvote_count" id="mssg_votes_'+t.id+'">'+(t.upvotes-t.downvotes)+'</div> <span class="glyphicon glyphicon-menu-down js_mssg_downvote static_mssg_downvote" id="mssg_downvote_'+t.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on responses" data-container="body" data-placement="bottom"></span></div>':s.indexOf(t.id)!=-1?u+='<span class="glyphicon glyphicon-menu-up js_mssg_upvote static_mssg_upvote" id="mssg_upvote_'+t.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on responses" data-container="body" data-placement="top"></span> <div class="upvote_count" id="mssg_votes_'+t.id+'">'+(t.upvotes-t.downvotes)+'</div> <span class="glyphicon glyphicon-menu-down js_mssg_downvote static_mssg_downvote" id="mssg_downvote_'+t.id+'" style="color:red;" data-toggle="tooltip" data-original-title="You must be logged in to vote on responses" data-container="body" data-placement="bottom"></span></div>':u+='<span class="glyphicon glyphicon-menu-up js_mssg_upvote static_mssg_upvote" id="mssg_upvote_'+t.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on responses" data-container="body" data-placement="top"></span> <div class="upvote_count" id="mssg_votes_'+t.id+'">'+(t.upvotes-t.downvotes)+'</div> <span class="glyphicon glyphicon-menu-down js_mssg_downvote static_mssg_downvote" id="mssg_downvote_'+t.id+'" data-toggle="tooltip" data-original-title="You must be logged in to vote on responses" data-container="body" data-placement="bottom"></span></div>',u+='<div class="static_mssg_body js_mssg_body author_'+t.author+'">',u+='<div id="toggle_'+t.id+'" class="toggle_responses"> <span class="caret caret_tooltip" id="caret_'+t.id+'" data-toggle="tooltip" data-original-title="Hide Responses" data-container="body" data-placement="top"></span> </div>',t.message!="This response has been deleted"&&(module.serial_tracker==t.author||module.user_tracker==t.author)&&(u+='<span id="remove_'+t.id+'" class="glyphicon glyphicon-remove mssg_icon" data-mssg-serial="'+t.serial+'" style="margin-right:5px;" data-toggle="tooltip" title="Delete post" data-container="body" data-placement="top"></span>'),u+='<strong class="mssg_op" data-author="'+t.author+'"><a href="//mutualcog.com/u/'+t.author+'" style="color:'+module.color_arr[t.serial%7]+'"> '+t.author,t.author==$("#chat_admin_info").text()?u+='<span class="glyphicon glyphicon-king"></span>':t.author in module.mods&&(u+='<span class="glyphicon glyphicon-knight"></span>'),u+="</a></strong> : "+t.message,u+='<div class="time_box">',$(".chat_status_indicator").hasClass("glyphicon-pause")&&(u+='<div class="static_reply"><a href="#" class="reply_link" data-mssg-id="'+t.id+'"><strong>Reply</strong></a></div>'),u+='<div class="static_tool"><a href="//mutualcog.com/profile/save/message/'+t.id+'"><strong>Save</strong></a></div>',t.user_id==module.user_id&&(u+='<div class="static_tool"><a class="js_edit_message" href="#" data-toggle="modal" data-target="#edit_message_modal"><strong>Edit</strong></a></div>'),u+='<div class="time" id="'+t.created_at+'" title="'+t.created_at+' UTC">'+moment.utc(t.created_at).fromNow()+"</div></div>",u+="</div></div></div></div>";if(t.responses==0)if(t.y_dim==o||e==0)u+="</div></div>";else for(var n=0;n<o-t.y_dim;n++)u+="</div></div>";o=t.y_dim}),t.append(u)},error:function(){}}),!1}),$("#side").on("click","#subscribe_btn",function(){return $("#logged_in").text()==1?!0:($("#reg_modal_title").text("Sign up to subscribe to communities"),$("#register_modal").modal(),!1)}),$("button#message_friend").click(function(){return $("#logged_in").text()==1?!0:($("#reg_modal_title").text("Sign up to message users"),$("#register_modal").modal(),!1)}),$("#create_community").click(function(){return $("#logged_in").text()==1?!0:($("#reg_modal_title").text("Sign up to create communities"),$("#register_modal").modal(),!1)}),$("#side").on("click","#community_edit",function(e){var t=$(this).parents(".side_content");return $("#input_community_id").val(t.find("#community_id_str").text()),$("#edit_community_info").val(t.find("#community_info_str").text()),$("#input_community_desc").val(t.find("#community_desc_str").text()),$("#community_edit_modal").modal(),!1}),$("#mobile_community_edit").click(function(e){var t=$("#community_edit").parents(".side_content");return $("#input_community_id").val(t.find("#community_id_str").text()),$("#edit_community_info").val(t.find("#community_info_str").text()),$("#input_community_desc").val(t.find("#community_desc_str").text()),$("#community_edit_modal").modal(),!1}),$(".remove_mod").click(function(e){var t=$(this).attr("id").split("_")[3],n=$(this).attr("id").split("_")[2];window.location.href="//mutualcog.com/community/remove-mod/"+n+"/"+t}),$("#main").on("click",".remove_chat_link",function(e){return $("#remove_modal").modal(),$("#remove_chat_final").attr("href",$(this).attr("data-remove-link")),!1}),$(".js_edit_message").on("click",function(){var e=$(this).parents(".js_mssg").find(".js_raw_mssg_content").text(),t=$(this).parents(".js_mssg").attr("id").replace("message_","");$("#form_mssg_id").val(t),$("#form_mssg_content").val(e)}),$(".recover_account").on("click",function(){$("#register_modal").modal("hide"),$("#recover_modal").modal()}),$("#search_input").on("keydown",function(e){if(e.keyCode==13)return selected_term==-1?window.location.href="//mutualcog.com/search/result/"+$("#search_input").val():location.assign($("li#search_"+selected_term).children("a").attr("href")),!1;if(e.keyCode==38)return selected_term!=0&&(selected_term--,$(".community_results").css("background-color",""),$("li#search_"+selected_term).css("background-color","#ddd")),!1;if(e.keyCode==40)return selected_term!=$(".community_results").length-1&&(selected_term++,$(".community_results").css("background-color",""),$("li#search_"+selected_term).css("background-color","#ddd")),!1}),$("#search_input").on("keyup",function(e){var t=$(this).val();if(e.keyCode==13)return!1;e.keyCode!=38&&e.keyCode!=40&&(t.length>2?$.ajax({type:"GET",data:{community:t},url:"//mutualcog.com/search/similar-entity",success:function(e){var t="",n=0,r=0,i=0;$.each(e,function(e,s){s.type=="community"?(r==0&&(t+='<div class="search_res_type"><strong>Communities</strong></div>',r++),t+='<li id="search_'+e+'" class="community_results"><a href="//mutualcog.com/c/'+s.name+'">'+s.name+"</a></li>"):s.type=="post"?(i==0&&(t+='<div class="search_res_type"><strong>Posts</strong></div>',i++),s.live==1?t+='<li id="search_'+e+'" class="community_results"><a href="//mutualcog.com/chat/live/'+s.id+'">'+s.name+"</a></li>":t+='<li id="search_'+e+'" class="community_results"><a href="//mutualcog.com/chat/static/'+s.id+'">'+s.name+"</a></li>"):(n==0&&(t+='<div class="search_res_type"><strong>Users</strong></div>',n++),t+='<li id="search_'+e+'" class="community_results"><a href="//mutualcog.com/u/'+s.name+'">'+s.name+"</a></li>")}),t+='<div class="search_hint_cont"><div class="search_hint"><strong>Press enter for more results</strong></div></div>',t+='<li><a class="search_link" href="#" ><strong>List of advanced search keywords</strong></a></li>',t?($("#community_dropdown").show(),$("#community_dropdown").html()!=t&&($("#community_dropdown").html(t),selected_term=-1)):($("#community_dropdown").hide(),selected_term=-1)},error:function(){}}):$("#community_dropdown").html(""))}),$("body").on("cut",".pm_text",function(e){var t=$(this),n=this;window.setTimeout(function(){t.height(0),t.height(n.scrollHeight-10)},0)}),$("body").on("paste",".pm_text",function(e){var t=$(this),n=this;window.setTimeout(function(){t.height(0),t.height(n.scrollHeight-10)},0)}),$("body").on("keydown",".pm_text",function(e){pm_keys.push(e.which);var t=$(this),n=this;if(e.which==13&&$(this).val().trim()=="")return!1;window.setTimeout(function(){(e.which!=13||pm_keys.indexOf(16)!=-1)&&t.val().trim()!=""&&(t.height(0),t.height(n.scrollHeight-10))},0)}),$("body").on("keyup",".pm_text",function(e){module.pm_info=$(this).parent().attr("id").split("_");var t=$(this).parents(".pm_cont");module.user_id.length&&(module.recent>120&&module.socket.emit("seen_chats"),module.recent=0);if(e.which==13)if(pm_keys.indexOf(16)==-1){pm_keys.splice(pm_keys.indexOf(e.which),1),module.typ_cnt>0&&module.socket.emit("not_typing",{pm_id:module.pm_info[2],friend_id:module.pm_info[1],user_id:module.user_id});if($(this).val().trim()=="")return!1;var n=processMessage($(this).val()),r=$(this).val();$(this).css("height","");var i='<div class="pm_mssg_cont tmp_message_'+module.tmp_mssg_cnt+'">';i+='<div class="pm_message pull-right" style="background-color:#eee;margin-left:30px;margin-right:5px;" title="'+moment().format("hh:mma")+'">'+n+"</div>",i+="</div>",$(this).val(""),$("#pm_"+module.pm_info[1]+"_"+module.pm_info[2]).find(".pm_body_mssgs").append(i),module.socket.emit("send_pm",{message:r,pm_id:module.pm_info[2],friend_id:module.pm_info[1],user_id:module.user_id,tmp_mssg_cnt:module.tmp_mssg_cnt},function(e){var t=$("#pm_"+e.friend_id+"_"+e.pm_id),n=t.find(".tmp_message_"+e.tmp_mssg_cnt);n.find(".pm_message").html(e.message),n.attr("class",n.attr("class").replace("tmp_message_"+e.tmp_mssg_cnt,"")),e.unseen&&t.find(".pm_unseen").show()}),module.tmp_mssg_cnt++;if(module.pm_scroll_inactive[t.attr("id")]==0||!(t.attr("id")in module.pm_scroll_inactive)){var s=t.find(".pm_body");window.setTimeout(function(){s.mCustomScrollbar("scrollTo","bottom",{scrollInertia:0})},20)}module.typ_cnt=0}else module.typ_cnt==0&&module.socket.emit("is_typing",{pm_id:module.pm_info[2],friend_id:module.pm_info[1],user_id:module.user_id}),pm_keys.splice(keys.indexOf(e.which),1),module.typ_cnt=4;else module.typ_cnt==0&&module.socket.emit("is_typing",{pm_id:module.pm_info[2],friend_id:module.pm_info[1],user_id:module.user_id}),pm_keys.splice(pm_keys.indexOf(e.which),1),module.typ_cnt=4;return!0}),$("body").on("cut",".mobile_pm_text",function(e){var t=$(this),n=this;window.setTimeout(function(){t.height(0),t.height(n.scrollHeight-20)},0)}),$("body").on("paste",".mobile_pm_text",function(e){var t=$(this),n=this;window.setTimeout(function(){t.height(0),t.height(n.scrollHeight-20)},0)}),$("body").on("keydown",".mobile_pm_text",function(e){pm_keys.push(e.which);var t=$(this),n=this;if(e.which==13&&$(this).val().trim()=="")return!1;window.setTimeout(function(){(e.which!=13||pm_keys.indexOf(16)!=-1)&&t.val().trim()!=""&&(t.height(0),t.height(n.scrollHeight-20))},0)}),$("body").on("keyup",".mobile_pm_text",function(e){module.pm_info=$(this).parent().attr("id").split("_");var t=$(this).parents(".mobile_pm_window");module.user_id.length&&(module.recent>120&&module.socket.emit("seen_chats"),module.recent=0);if(e.which==13)if(pm_keys.indexOf(16)==-1){pm_keys.splice(pm_keys.indexOf(e.which),1),module.typ_cnt>0&&module.socket.emit("not_typing",{pm_id:module.pm_info[3],friend_id:module.pm_info[2],user_id:module.user_id});if($(this).val().trim()=="")return!1;var n=processMessage($(this).val()),r=$(this).val();$(this).css("height","");var i='<div class="pm_mssg_cont tmp_message_'+module.tmp_mssg_cnt+'">';i+='<div class="pm_message pull-right" style="background-color:#eee;margin-left:30px;margin-right:5px;" title="'+moment().format("hh:mma")+'">'+n+"</div>",i+="</div>",$(this).val(""),$("#mobile_pm_"+module.pm_info[2]+"_"+module.pm_info[3]).find(".pm_body_mssgs").append(i),module.socket.emit("send_pm",{message:r,pm_id:module.pm_info[3],friend_id:module.pm_info[2],user_id:module.user_id,tmp_mssg_cnt:module.tmp_mssg_cnt},function(e){var t=$("#mobile_pm_"+e.friend_id+"_"+e.pm_id),n=t.find(".tmp_message_"+e.tmp_mssg_cnt);n.find(".pm_message").html(e.message),n.attr("class",n.attr("class").replace("tmp_message_"+e.tmp_mssg_cnt,"")),e.unseen&&t.find(".pm_unseen").show()}),module.tmp_mssg_cnt++;if(module.pm_scroll_inactive[t.attr("id")]==0||!(t.attr("id")in module.pm_scroll_inactive)){var s=t.find(".mobile_pm_body");window.setTimeout(function(){s.mCustomScrollbar("scrollTo","bottom",{scrollInertia:0})},20)}module.typ_cnt=0}else module.typ_cnt==0&&module.socket.emit("is_typing",{pm_id:module.pm_info[3],friend_id:module.pm_info[2],user_id:module.user_id}),pm_keys.splice(keys.indexOf(e.which),1),module.typ_cnt=4;else module.typ_cnt==0&&module.socket.emit("is_typing",{pm_id:module.pm_info[3],friend_id:module.pm_info[2],user_id:module.user_id}),pm_keys.splice(pm_keys.indexOf(e.which),1),module.typ_cnt=4;return!0}),$(".communities_input").on("keydown",function(e){if(e.keyCode==13){if(selected_community!=-1){var t=$(this).val().split(" ");return t.pop(),t.push("#"+$(".suggested_communities").eq(selected_community).text()),$(this).val(t.join(" ")+" #"),$(this).focus(),!1}return!1}if(e.keyCode==38){if($(".popover").length!=0)return selected_community!=0&&(selected_community-=1,$(".suggested_communities").css("color",""),$(".suggested_communities").eq(selected_community).css("color","#57bf4b")),!1}else if(e.keyCode==40&&$(".popover").length!=0)return selected_community!=$(".suggested_communities").length-1&&(selected_community+=1,$(".suggested_communities").css("color",""),$(".suggested_communities").eq(selected_community).css("color","#57bf4b")),!1}),$(".communities_input").on("keyup",function(e){if(e.keyCode==32)if($(this).val().length==1)$(this).val("");else{var t=$(this).val().split(" "),n=new Array;$.each(t,function(e,t){t=t.replace("#",""),n.push("#"+t)}),$(this).val(n.join(" ")),$(this).popover("destroy"),selected_community=-1}else if(e.keyCode!=38&&e.keyCode!=40){var r=$(this).val().split(" ");r=r.pop().replace("#","");if(r.length>2){var i=$(this);$(this).on("blur",function(){$(".popover").length&&$(this).popover("hide")}),$.ajax({type:"GET",data:{community:r.slice(0,-1)},url:"//mutualcog.com/community/similar-community",success:function(e){var t="";$.each(e,function(e,n){t+='<div class="suggested_communities" id="'+n.id+'">'+n.name+"</div>"}),$(".popover").length==0?t&&(i.popover({html:!0}),i.attr("data-content",t),i.popover("show"),$(".suggested_communities").click(function(){var e=$(".communities_input").val().split(" ");e.pop(),e.push("#"+$(this).text()),i.val(e.join(" ")+" #"),i.focus(),i.popover("destroy"),selected_community=-1}),selected_community=-1):t?$(".popover-content").html()!=t&&($(".popover-content").html(t),selected_community=-1,$(".suggested_communities").off("click"),$(".suggested_communities").click(function(){var e=$(".communities_input").val().split(" ");e.pop(),e.push("#"+$(this).text()),i.val(e.join(" ")+" #"),i.focus(),i.popover("destroy"),selected_community=-1})):(i.popover("destroy"),selected_community=-1)},error:function(){}})}else $(this).popover("destroy"),selected_community=-1}}),$("#mod_input").on("keydown",function(e){if(e.keyCode==13){if(selected_mod!=-1){var t={community_id:$(this).attr("data-community-id"),community_name:$(this).attr("data-community-name"),user_id:$(".suggested_mods").eq(selected_mod).attr("id")};module.socket.emit("request_mod",t,function(e){e==1?($("#mod_request_sent").text("Request sent"),$("#mod_request_sent").hasClass("base_green_color")||($("#mod_request_sent").removeClass("base_red_color"),$("#mod_request_sent").addClass("base_green_color"))):($("#mod_request_sent").text("Limit reached"),$("#mod_request_sent").hasClass("base_red_color")||($("#mod_request_sent").removeClass("base_green_color"),$("#mod_request_sent").addClass("base_red_color"))),$("#mod_request_sent").show("fade","slow",function(){window.setTimeout(function(){$("#mod_request_sent").hide("fade","slow")},1500)})}),$(this).popover("destroy"),$(this).focus(),selected_mod=-1}return!1}if(e.keyCode==38)return $(".popover").length!=0&&selected_mod!=0&&(selected_mod+=1,$(".suggested_mods").css("color",""),$(".suggested_mods").eq(selected_mod).css("color","#57bf4b")),!1;if(e.keyCode==40)return $(".popover").length!=0&&selected_mod!=$(".suggested_mods").length-1&&(selected_mod-=1,$(".suggested_mods").css("color",""),$(".suggested_mods").eq(selected_mod).css("color","#57bf4b")),!1}),$("#mod_input").on("keyup",function(e){if(e.keyCode==32||e.keyCode==13)return!1;if(e.keyCode==38||e.keyCode==40)return!1;var t=$(this).val(),n=$(this).attr("data-community-id");if(t.length>2){var r=$(this);$(this).on("blur",function(){$(".popover").length&&$(this).popover("hide")}),$.ajax({type:"GET",data:{mod:t,community_id:n},url:"//mutualcog.com/community/similar-mod",success:function(e){var t="";$.each(e,function(e,n){t+='<div class="suggested_mods" id="'+n.id+'">'+n.name+"</div>"}),$(".popover").length==0?t&&(r.popover({html:!0}),r.attr("data-content",t),r.popover("show"),$(".suggested_mods").click(function(){var e={community_id:r.attr("data-community-id"),community_name:r.attr("data-community-name"),user_id:$(".suggested_mods").eq(selected_mod).attr("id")};module.socket.emit("request_mod",e,function(e){e?($("#mod_request_sent").text("Request sent"),$("#mod_request_sent").hasClass("base_green_color")||($("#mod_request_sent").removeClass("base_red_color"),$("#mod_request_sent").addClass("base_green_color"))):($("#mod_request_sent").text("Limit reached"),$("#mod_request_sent").hasClass("base_red_color")||($("#mod_request_sent").removeClass("base_green_color"),$("#mod_request_sent").addClass("base_red_color"))),$("#mod_request_sent").show("fade","slow",function(){window.setTimeout(function(){$("#mod_request_sent").hide("fade","slow")},1500)})}),r.focus(),r.popover("destroy"),selected_mod=-1}),selected_mod=-1):t?$(".popover-content").html()!=t&&($(".popover-content").html(t),selected_mod=-1,$(".suggested_mods").off("click"),$(".suggested_mods").click(function(){var e={community_id:r.attr("data-community-id"),community_name:r.attr("data-community-name"),user_id:$(".suggested_mods").eq(selected_mod).attr("id")};module.socket.emit("request_mod",e,function(e){e?($("#mod_request_sent").text("Request sent"),$("#mod_request_sent").hasClass("base_green_color")||($("#mod_request_sent").removeClass("base_red_color"),$("#mod_request_sent").addClass("base_green_color"))):($("#mod_request_sent").text("Limit reached"),$("#mod_request_sent").hasClass("base_red_color")||($("#mod_request_sent").removeClass("base_green_color"),$("#mod_request_sent").addClass("base_red_color"))),$("#mod_request_sent").show("fade","slow",function(){window.setTimeout(function(){$("#mod_request_sent").hide("fade","slow")},1500)})}),r.focus(),r.popover("destroy"),selected_mod=-1})):(r.popover("destroy"),selected_mod=-1)},error:function(){}})}else $(this).popover("destroy"),selected_mod=-1}),$("#admin_input").on("keydown",function(e){if(e.keyCode==13){if(selected_admin!=-1){var t={community_id:$(this).attr("data-community-id"),community_name:$(this).attr("data-community-name"),user_id:$(".suggested_admin").eq(selected_admin).attr("id")};module.socket.emit("request_admin",t,function(e){e==1?($("#admin_request_sent").text("Request sent"),$("#admin_request_sent").hasClass("base_green_color")||($("#admin_request_sent").removeClass("base_red_color"),$("#admin_request_sent").addClass("base_green_color"))):($("#admin_request_sent").text("Limit reached"),$("#admin_request_sent").hasClass("base_red_color")||($("#admin_request_sent").removeClass("base_green_color"),$("#admin_request_sent").addClass("base_red_color"))),$("#admin_request_sent").show("fade","slow",function(){window.setTimeout(function(){$("#admin_request_sent").hide("fade","slow")},1500)})}),$(this).popover("destroy"),$(this).focus(),selected_admin=-1}return!1}if(e.keyCode==38)return $(".popover").length!=0&&selected_admin!=0&&(selected_admin+=1,$(".suggested_admin").css("color",""),$(".suggested_admin").eq(selected_admin).css("color","#57bf4b")),!1;if(e.keyCode==40)return $(".popover").length!=0&&selected_admin!=$(".suggested_admin").length-1&&(selected_admin-=1,$(".suggested_admin").css("color",""),$(".suggested_admin").eq(selected_admin).css("color","#57bf4b")),!1}),$("#admin_input").on("keyup",function(e){if(e.keyCode==32||e.keyCode==13)return!1;if(e.keyCode==38||e.keyCode==40)return!1;var t=$(this).val(),n=$(this).attr("data-community-id");if(t.length>2){var r=$(this);$(this).on("blur",function(){$(".popover").length&&$(this).popover("hide")}),$.ajax({type:"GET",data:{admin:t,community_id:n},url:"//mutualcog.com/community/similar-admin",success:function(e){var t="";$.each(e,function(e,n){t+='<div class="suggested_admin" id="'+n.id+'">'+n.name+"</div>"}),$(".popover").length==0?t&&(r.popover({html:!0}),r.attr("data-content",t),r.popover("show"),$(".suggested_admin").click(function(){var e={community_id:r.attr("data-community-id"),community_name:r.attr("data-community-name"),user_id:$(".suggested_admin").eq(selected_admin).attr("id")};module.socket.emit("request_admin",e,function(e){e?($("#admin_request_sent").text("Request sent"),$("#admin_request_sent").hasClass("base_green_color")||($("#admin_request_sent").removeClass("base_red_color"),$("#admin_request_sent").addClass("base_green_color"))):($("#admin_request_sent").text("Limit reached"),$("#admin_request_sent").hasClass("base_red_color")||($("#admin_request_sent").removeClass("base_green_color"),$("#admin_request_sent").addClass("base_red_color"))),$("#admin_request_sent").show("fade","slow",function(){window.setTimeout(function(){$("#admin_request_sent").hide("fade","slow")},1500)})}),r.focus(),r.popover("destroy"),selected_admin=-1}),selected_admin=-1):t?$(".popover-content").html()!=t&&($(".popover-content").html(t),selected_admin=-1,$(".suggested_admin").off("click"),$(".suggested_admin").click(function(){var e={community_id:r.attr("data-community-id"),community_name:r.attr("data-community-name"),user_id:$(".suggested_admin").eq(selected_admin).attr("id")};module.socket.emit("request_admin",e,function(e){e?($("#admin_request_sent").text("Request sent"),$("#admin_request_sent").hasClass("base_green_color")||($("#admin_request_sent").removeClass("base_red_color"),$("#admin_request_sent").addClass("base_green_color"))):($("#admin_request_sent").text("Limit reached"),$("#admin_request_sent").hasClass("base_red_color")||($("#admin_request_sent").removeClass("base_green_color"),$("#admin_request_sent").addClass("base_red_color"))),$("#admin_request_sent").show("fade","slow",function(){window.setTimeout(function(){$("#admin_request_sent").hide("fade","slow")},1500)})}),r.focus(),r.popover("destroy"),selected_admin=-1})):(r.popover("destroy"),selected_admin=-1)},error:function(){}})}else $(this).popover("destroy"),selected_admin=-1}),$("#message").keydown(function(e){keys.push(e.which);if(e.which==13&&keys.indexOf(16)==-1)return!1}),$("#message").keyup(function(e){if(module.live&&module.banned==0){$(".enter_hint").text("");if(e.which==13)if(keys.indexOf(16)==-1){keys.splice(keys.indexOf(e.which),1);var t=$("#message").val(),n=processMessage(t);if(n.trim()!="")if(module.connected){$("#message").val("");if($("#message").attr("class")=="global"){if($("#logged_in").text()==1)var r=generateMssg({id:0,author:module.user_tracker,responseto:0,y_dim:0,serial:module.serial_tracker,created_at:moment.utc(moment.utc().format()).fromNow(),message:n},1,1);else var r=generateMssg({id:0,author:module.serial_tracker,responseto:0,y_dim:0,serial:module.serial_tracker,created_at:moment.utc(moment.utc().format()).fromNow(),message:n},1,1);$(".tmp_message").remove(),$("#chat_display").append(r),$(".mssg_icon").tooltip(),$(".caret_tooltip").tooltip(),$(".enter_hint").text("Sending..."),module.socket.emit("message_sent",{message:t,responseto:0,y_dim:0,parent:0,tmp_mssg_cnt:module.tmp_mssg_cnt},function(e){$(".enter_hint").text("Sent");var t=$("#chat_display").find(".tmp_chat_mssg_"+e.tmp_mssg_cnt);t.removeClass("tmp_chat_mssg_"+e.tmp_mssg_cnt),t.attr("id","mssg_cont_"+e.id),t.find(".js_mssg").attr("id","message_"+e.id),t.find(".js_mssg_upvote").attr("id","mssg_upvote_"+e.id),t.find(".upvote_count").attr("id","mssg_votes_"+e.id),t.find(".js_mssg_downvote").attr("id","mssg_downvote_"+e.id),t.find(".toggle_responses").attr("id","toggle_"+e.id),t.find(".glyphicon-remove").attr("id","remove_"+e.id),t.find(".reply_link").attr("data-mssg-id",e.id)}),module.tmp_mssg_cnt++}else{var i=$("#message").attr("class").replace("message_",""),s=parseInt($("#mssg_cont_"+i).attr("class").split(" ")[2].replace("y_",""))+1;if($("#mssg_cont_"+i).attr("class").split(" ")[3].replace("parent_","")==0)var o=i;else var o=$("#mssg_cont_"+i).parents(".mssg_cont").last().attr("id").replace("mssg_cont_","");if($("#logged_in").text()==1)var r=generateMssg({id:0,author:module.user_tracker,responseto:i,y_dim:s,serial:module.serial_tracker,created_at:moment.utc(moment.utc().format()).fromNow(),message:n},0,1);else var r=generateMssg({id:0,author:module.serial_tracker,responseto:i,y_dim:s,serial:module.serial_tracker,created_at:moment.utc(moment.utc().format()).fromNow(),message:n},0,1);$(".tmp_message").remove(),$("#mssg_cont_"+i).append(r),$(".mssg_icon").tooltip(),$(".caret_tooltip").tooltip(),$(".enter_hint").text("Sending..."),module.socket.emit("message_sent",{message:t,responseto:i,y_dim:s,parent:o,tmp_mssg_cnt:module.tmp_mssg_cnt},function(e){$(".enter_hint").text("Sent");var t=$("#chat_display").find(".tmp_chat_message_"+e.tmp_mssg_cnt);t.removeClass("tmp_chat_mssg_"+e.tmp_mssg_cnt),t.attr("id","mssg_cont_"+e.id),t.find(".js_mssg").attr("id","message_"+e.id),t.find(".js_mssg_upvote").attr("id","mssg_upvote_"+e.id),t.find(".upvote_count").attr("id","mssg_votes_"+e.id),t.find(".js_mssg_downvote").attr("id","mssg_downvote_"+e.id),t.find(".toggle_responses").attr("id","toggle_"+e.id),t.find(".glyphicon-remove").attr("id","remove_"+e.id),t.find(".reply_link").attr("data-mssg-id",e.id)}),module.tmp_mssg_cnt++}module.stop_scroll||(module.scroll_mod_active=0,$(".chat_main").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),window.setTimeout(function(){module.scroll_mod_active=1},100))}else $(".enter_hint").text("You are disconnected")}else keys.splice(keys.indexOf(e.which),1);else keys.splice(keys.indexOf(e.which),1)}else keys.splice(keys.indexOf(e.which),1)}),$(".modal").on("hide.bs.modal",function(){$(".form-control").tooltip("destroy")}),$("#search_input").on("focus",function(e){e.stopPropagation(),$("#search_input").val()==""&&$("#community_dropdown").html(""),$(this).dropdown(),$("#community_dropdown").show()}),$("#reg_username").blur(function(){var e=$("#reg_username").val();if(e.length>0)var t=validateUser(e)}),$("#pass2").blur(function(){var e=$("#reg_pass").val(),t=$("#pass2").val();if(e.length>0&&t.length>0)var n=validatePasswords(e,t)}),$(window).on("blur",function(){module.focused=0,module.user_id.length&&(module.recent+=110)}),$(window).on("focus",function(){module.focused=1,module.user_id.length&&(module.recent>120&&module.socket.emit("seen_chats"),module.recent=0)}),$("#mssg_requests").blur(function(){$(this).popover("hide")}),$("#global_requests").blur(function(){$(this).popover("hide")}),$("#friend_requests").blur(function(){$(this).popover("hide")}),$("#login_form").submit(function(){var e=$("#username").val(),t=$("#pass").val();if(e.length>0&&t.length>0){var n=validateLogin(e,t,0);return n?!0:!1}return!1}),$("#mobile_login_form").submit(function(){var e=$("#mobile_username").val(),t=$("#mobile_pass").val();if(e.length>0&&t.length>0){var n=validateLogin(e,t,1);return n?!0:!1}return!1}),$("#register_form").submit(function(){var e=$("#reg_username").val(),t=$("#reg_pass").val(),n=$("#pass2").val(),r=$("#email").val();if(e.length>0&&t.length>0&&n.length>0){var i=validateUser(e);if(!i)return!1;var i=validatePasswords(t,n);if(!i)return!1;if(r.length>0){var i=validateEmail(r);if(!i)return!1}return!0}return e.length==0&&$("#reg_user_group").attr("class","form-group has-error"),t.length==0&&$("#reg_pass1_group").attr("class","form-group has-error"),n.length==0&&$("#pass2_group").attr("class","form-group has-error"),$("#reg_username").attr("data-original-title","Please enter both a username and a confirmed password"),$("#reg_username").tooltip("show"),!1}),$("#home_form_v3").submit(function(){var e=$("#Title_v3").val(),t=$("#Link_v3").val(),n=$("#Communities_v3").val(),r=$("#description_v3").val();return $(".form_error").hide(),$(".form-group").attr("class","form-group"),e.length<5||e.length>module.max_title_length?($("#Title_v3").attr("data-original-title","Title must be between 5 and "+module.max_title_length+" characters"),$("#Title_v3").tooltip("show"),$("#title_group_v3").attr("class","form-group has-error"),!1):n.split(" ")[0]==""||n.split(" ").length>5?($("#communities_group_v3").attr("class","form-group has-error"),$("#Communities_v3").attr("data-original-title","Must have at least 1 community but less than 6"),$("#Communities_v3").tooltip({placement:"bottom",trigger:"focus"}),$("#Communities_v3").tooltip("show"),!1):(n=n.split(" "),$.each(n,function(e,t){t=t.replace("#","");if((t.length<3||t.length>20)&&t.length!=0)return $("#communities_group_v3").attr("class","form-group has-error"),$("#Communities_v3").attr("data-original-title","Communities must be between 3 and 20 characters"),$("#Communities_v3").tooltip({placement:"bottom",trigger:"focus"}),$("#Communities_v3").tooltip("show"),!1}),r.length>module.max_static_length&&($("#description_group_v3").attr("class","form-group has-error"),$("#description_v3").tooltip("show")),$("#home_form_v3").append('<input type="hidden" name="js_key" value="js_enabled" id="js_key">'),!0)}),$("#home_form_v2").submit(function(){if(cookiesEnabled()){var e=$("#Title_v2").val(),t=$("#Link_v2").val(),n=$("#Communities_v2").val(),r=$("#description").val();return $(".form_error").hide(),$(".form-group").attr("class","form-group"),e.length<5||e.length>module.max_title_length?($("#Title_v2").attr("data-original-title","Title must be between 5 and "+module.max_title_length+" characters"),$("#Title_v2").tooltip("show"),$("#title_group_v2").attr("class","form-group has-error"),!1):n.split(" ")[0]==""||n.split(" ").length>5?($("#communities_group_v2").attr("class","form-group has-error"),$("#Communities_v2").attr("data-original-title","Must have at least 1 community but less than 6"),$("#Communities_v2").tooltip({placement:"bottom",trigger:"focus"}),$("#Communities_v2").tooltip("show"),!1):(n=n.split(" "),$.each(n,function(e,t){t=t.replace("#","");if((t.length<3||t.length>20)&&t.length!=0)return $("#communities_group_v2").attr("class","form-group has-error"),$("#Communities_v2").attr("data-original-title","Communities must be between 3 and 20 characters"),$("#Communities_v2").tooltip({placement:"bottom",trigger:"focus"}),$("#Communities_v2").tooltip("show"),!1}),r.length>module.max_static_length&&($("#description_group").attr("class","form-group has-error"),$("#description").tooltip("show")),$("#home_form_v2").append('<input type="hidden" name="js_key" value="js_enabled" id="js_key">'),!0)}return $("#Title_v2").attr("data-original-title","You must enable cookies to post chats"),$("#Title_v2").tooltip("show"),!1}),$("#community_edit_form").submit(function(){var e=$("#edit_community_desc").val(),t=$("#edit_community_info").val();return e.length>module.max_static_length?($("#community_desc_group").attr("class","form-group has-error"),$("#edit_community_desc").tooltip("show"),!1):t.length>module.max_info_length?($("#community_info_group").attr("class","form-group has-error"),$("#edit_community_info").tooltip("show"),!1):!0}),$("#community_create_form").submit(function(){var e=$("#create_community_name").val(),t=$("#create_community_desc").val(),n=$("#create_community_info").val();return e.length<3||e.length>20?($("#create_name_group").attr("class","form-group has-error"),$("#create_community_name").attr("data-original-title","Communities must be between 3 and 20 characters"),$("#create_community_name").tooltip("show"),!1):validateCommunity(e)?t.length>module.max_static_length?($("#create_desc_group").attr("class","form-group has-error"),$("#create_community_desc").tooltip("show"),!1):n.length>module.max_info_length?($("#create_info_group").attr("class","form-group has-error"),$("#create_community_info").tooltip("show"),!1):!0:($("#create_name_group").attr("class","form-group has-error"),$("#create_community_name").attr("data-original-title","Communities must be unique"),$("#create_community_name").tooltip("show"),!1)}),$("body").on("submit",".reply_forms",function(){var e=$(this).parent().find(".mssg_op").attr("data-author");e!==module.user_tracker&&e.match(/[a-zA-Z]/g)&&module.socket.emit("notify_response",$(this).children("#reply_to").val())})